import{ad as k,ag as v,ah as I,ai as h,aj as P,ae as F,ak as L,at as B,al as m,N as x,am as N,an as R,aE as G,aD as w}from"./index.b078bf5f.js";class K extends k{canControlSingleKey=!1;defaultVendorSleepTime=500;type="keyboard";defaultMatrix=[];defaultFnMatrix=[];defaultFnMacMatrix=[];getPrecisionEnum=async()=>{};findIndexInDefaultMatrix=(t,e=0)=>{const n=v.hidToMatrix(t);let i=0;for(let s=0;s<this.defaultMatrix.length;s+=4)if(I(n,this.defaultMatrix.slice(s,s+4))){if(e===i)return s/4;i++}};findHidWithIndexInMatrix=t=>{const e=this.defaultMatrix.slice(t*4,t*4+4);return v.matrixToHid(e)};configsToMatrix=t=>{const e=[...this.defaultMatrix];for(const n of t){const i=v.configToMatrix(n),s=this.findIndexInDefaultMatrix(n.original);s!==void 0&&i.map((a,r)=>e[s*4+r]=a)}return e};FEA_CMD_SET_MACRO=11;_setMacro=async(t,e)=>{const n=new Uint8Array(8);n[0]=this.FEA_CMD_SET_MACRO,n[1]=e;let i=0;for(let s=0;s<5;s++)t.slice(s*56,56+s*56).some(r=>r!==0)&&i++;for(let s=0;s<i;s++){n[2]=s,n[3]=56,n[4]=s===i-1?1:0;let a=t.slice(s*56,56+s*56);a.length<56&&(a=a.concat(new Array(56-a.length).fill(0)));const r=new Uint8Array([...n,...a]);if(!await this.sendMsg(r,h.Bit7))return!1}return await this.vendorSleep(),!0};setMacro=async(t,e)=>{const n=t.macro,i=new Uint8Array(256);let s=0;i.set([t.repeatCount&255,t.repeatCount>>8],0),s+=2;for(let a=0;a<n.length;a+=2){const r=n.slice(a,a+2),o=r[0],c=r[1];if(o.type==="delay"||c.type!=="delay")return!1;const l=P.macroEventToByte(o,c);i.set(l,s),s+=l.length}return await this._setMacro([...i],e)};FEA_CMD_GET_MACRO=139;buffToMacroEvents=t=>{const e=[],n=new DataView(t.buffer).getUint16(0,!0);let i=2,s=t.slice(i,i+4);for(i+=4;i<t.length;){if(s[0]===249){const a=new Int8Array(s.buffer);e.push({type:"mouse_move",dx:a[2],dy:a[3]});let r=0;if(s[1]!==0)r=s[1]>>1;else{const o=t.slice(i,i+2);i+=2,r=new DataView(o.buffer).getUint16(0,!0)}e.push({type:"delay",value:r})}else{if(s[0]<=239&&s[0]>=4)e.push({type:"keyboard",action:s[1]<=127?"up":"down",value:s[0]});else{let r;switch(s[0]){case 240:r=F.Left;break;case 241:r=F.Right;break;case 242:r=F.Middle;break;case 243:r=F.Back;break;case 244:r=F.Forward;break}r!==void 0&&e.push({type:"mouse_button",action:s[1]<=127?"up":"down",value:r})}let a=0;s[1]&127?(a=s[1]&127,i-=2):a=new DataView(s.buffer).getUint16(2,!0),e.push({type:"delay",value:a})}if(s=t.slice(i,i+4),I([...s],[0,0,0,0]))break;i+=4}return{macroEvents:e.filter(a=>!(a.type==="delay"&&a.value===0)),repeatCount:n}};getMacro=async t=>{let e=new Uint8Array(0);const n=new Uint8Array(64);n[0]=this.FEA_CMD_GET_MACRO,n[1]=t;for(let i=0;i<4;i++){n[2]=i;const s=await this.commonMsg(n,h.Bit7);if(s===void 0)return;if(e=new Uint8Array([...e,...s]),Z([...s]))break}return this.buffToMacroEvents(e)};FEA_CMD_GET_REV=128;getUSBVersion=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_REV]),h.Bit7);if(t!==void 0)return t[2]<<8|t[1]};FEA_CMD_SET_PROFILE=5;setCurrentProfile=async(t=0)=>{const e=await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_PROFILE,t]),h.Bit7);return await this.vendorSleep(),e};FEA_CMD_GET_PROFILE=133;getCurrentProfile=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_PROFILE]),h.Bit7);return t===void 0?void 0:t[1]};FEA_CMD_SET_DEBOUNCE=17;setDeBounce=async t=>await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_DEBOUNCE,0,t]),h.Bit7)?(await this.vendorSleep(),!0):!1;FEA_CMD_GET_DEBOUNCE=145;getDeBounce=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_DEBOUNCE]),h.Bit7);if(t!==void 0)return t[2]};FEA_CMD_SET_USERPIC=12;_setLightPic=async(t,e)=>{const n=new Uint8Array(8);n[0]=this.FEA_CMD_SET_USERPIC,n[1]=0;const s=64*Math.floor(this.defaultMatrix.length/4*3/64);n[2]=s&255,n[3]=s>>8;for(let a=0;a<7;a++){n[4]=a;let r=t.slice(a*56,(a+1)*56);if(r.length<56&&(r=[...r,...new Array(56-r.length).fill(0)]),!await this.sendMsg(new Uint8Array([...n,...r]),h.Bit7))return!1}return await this.vendorSleep(),!0};setLightPic=async(t,e)=>{const n=Math.ceil(this.defaultMatrix.length/4),i=new Array(n*3).fill(0),s=t.map(a=>this.findIndexInDefaultMatrix(a.hid,a.index));for(let a=0;a<s.length;a++){const r=s[a];if(r===void 0)continue;const o=L.numToRgb(t[a].rgb);i[r*3]=o.r,i[r*3+1]=o.g,i[r*3+2]=o.b}return await this._setLightPic(i,e)};FEA_CMD_GET_USERPIC=140;_getLightPic=async t=>{const e=new Uint8Array(8);e[0]=this.FEA_CMD_GET_USERPIC,e[1]=0;let n=[];for(let i=0;i<6;i++){e[2]=i;const s=await this.commonMsg(e,h.Bit7);s===void 0?n=[...n,...new Array(64).fill(0)]:n=[...n,...s]}return n};getLightPic=async t=>{const e=await this._getLightPic(t);let n=[];for(let i=0;i<e.length;i+=3){const s=L.rgbToNum(e[i],e[i+1],e[i+2]),a=this.findHidWithIndexInMatrix(Math.floor(i/3)),r=n.filter(o=>o.hid===a);a===0||a===void 0||n.push({hid:a,rgb:s,index:r.length})}return n};FEA_CMD_SET_KEYMATRIX=9;_setKeyConfig=async(t,e,n)=>{const i=new Uint8Array(8);i[0]=this.FEA_CMD_SET_KEYMATRIX,i[1]=e??0,i[2]=248,i[3]=1;const s=9;for(let a=0;a<s;a++){let r=t.slice(a*56,56+a*56);i[4]=a,r.length<56&&(r=r.concat(new Array(56-r.length).fill(0)));const o=new Uint8Array([...i,...r]);if(!await this.sendMsg(o,h.Bit7))return!1}return!0};setKeyConfig=async(t,e,n)=>{const i=this.configsToMatrix(t);for(const a of t)a.type=="ConfigMacro"&&a.macroIndex!==void 0&&await this.setMacro(a,a.macroIndex);const s=await this._setKeyConfig(i,e,n);return await this.vendorSleep(),s};FEA_CMD_GET_KEYMATRIX=137;async _getKeyMatrix(t,e){const n=new Uint8Array(64);n[0]=this.FEA_CMD_GET_KEYMATRIX,n[1]=t;let i=[];for(let s=0;s<8;s++){n[2]=s;const a=await this.commonMsg(n,h.Bit7);a===void 0?i=[...i,...new Array(64).fill(0)]:i=[...i,...a]}return i}matrixToConfigValues=async t=>{if(t.length!==this.defaultMatrix.length)return[];const e=v.matrixToConfigs(this.defaultMatrix,t);for(let n=0;n<e.length;n++){let i=e[n];if(i.type!=="ConfigMacro"||i.macroIndex===void 0)continue;let s;const a=await this.getMacro(i.macroIndex);a!==void 0&&(s=a),i={...i,macro:s===void 0?[]:s.macroEvents,repeatCount:s===void 0?0:s.repeatCount},e[n]=i}return e};getKeyConfig=async(t,e)=>{const n=await this._getKeyMatrix(t,e);if(n!==void 0)return await this.matrixToConfigValues([...n])};FEA_CMD_SET_FN=16;_setFnKeyConfig=async(t,e,n)=>{const i=new Uint8Array(8);i[0]=this.FEA_CMD_SET_FN,i[1]=e,i[2]=248,i[3]=1;for(let s=0;s<9;s++){i[4]=s;let a=t.slice(s*56,56+s*56);a.length<56&&(a=a.concat(new Array(56-a.length).fill(0)));const r=new Uint8Array([...i,...a]);if(!await this.sendMsg(r,h.Bit7))return!1}return await this.vendorSleep(),!0};setFnKeyConfig=async(t,e,n)=>{const i=this.configsToMatrix(t);if(i!==void 0){for(let s=0;s<t.length;s++){const a=t[s];a.type=="ConfigMacro"&&a.macroIndex!==void 0&&await this.setMacro(a,a.macroIndex)}return await this._setFnKeyConfig(i,e,n)}};FEA_CMD_GET_FN=144;async _getFnKeyMatrix(t,e){const n=new Uint8Array(64);n[0]=this.FEA_CMD_GET_FN,n[1]=t;let i=[];for(let s=0;s<8;s++){n[2]=s;const a=await this.commonMsg(n,h.Bit7);a===void 0?i=[...i,...new Array(64).fill(0)]:i=[...i,...a]}return i}getFnKeyConfig=async(t,e)=>{const n=await this._getFnKeyMatrix(t,e);if(n!==void 0)return await this.matrixToConfigValues(n)};setKBOption=async t=>!1;getKBOption=async()=>{};FEA_CMD_GET_KBOPTION=134;setOldKBOption=async(t,e)=>!1;getKeyboardOption=async t=>{};getKbPowerSaveMode=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_KBOPTION,0]),h.Bit7);if(t!==void 0)return!!t[4]};MAXSPEED=5;DAZZLE=6;NORMAL=7;COMMONCOLOR={0:16711680,1:65280,2:255,3:16732160,4:16711935,5:16776960,6:16777215};LIGHTLIST={0:"LightOff",1:"LightAlwaysOn",2:"LightBreath",3:"LightNeon",4:"LightWave",5:"LightRipple",6:"LightRaindrop",7:"LightSnake",8:"LightPressAction",9:"LightConverage",10:"LightSineWave",11:"LightKaleidoscope",12:"LightLineWave",13:"LightUserPicture",14:"LightLaser",15:"LightCircleWave",16:"LightDazzing",17:"LightRainDown",18:"LightMeteor",19:"LightPressActionOff",20:"LightMusicFollow3",21:"LightScreenColor",22:"LightMusicFollow2",23:"LightTrain",24:"LightFireWorks"};FEA_CMD_SET_LEDPARAM=7;setLightSetting=async t=>{const e=new Uint8Array(64);e[0]=this.FEA_CMD_SET_LEDPARAM;const n=B(this.LIGHTLIST,t.type)??0;let i=t.dazzle;const s=i?this.DAZZLE:this.NORMAL,a=i?0:4;let r=t.option<<4|s;if(t.type==="LightUserPicture"&&(r=t.option<<4),(t.type==="LightMusicFollow3"||t.type==="LightMusicFollow2")&&(r=t.option<<4|a),t.type==="LightScreenColor"&&(r=0),e[1]=n,e[2]=this.MAXSPEED-t.speed,e[3]=t.bright,e[4]=r,"rgb"in t&&t.rgb!==void 0){let c=t.rgb;c===16777215&&(c=16449530);const l=L.numToRgb(c);e[5]=l.r,e[6]=l.g,e[7]=l.b}t.type==="LightUserPicture"&&(e[5]=0,e[6]=200,e[7]=200);const o=await this.sendMsg(e,h.Bit8);return await this.vendorSleep(),!!o};FEA_CMD_GET_LEDPARAM=135;getLightSetting=async()=>{const t=new Uint8Array(64);t[0]=this.FEA_CMD_GET_LEDPARAM;const e=await this.commonMsg(t,h.Bit7);if(e===void 0)return;const n=e[1],i=this.MAXSPEED-e[2],s=e[3],a=e[4];let r=L.rgbToNum(e[5],e[6],e[7]);const o=a>>4,c=a&15,l=u=>{if(u===this.DAZZLE||u===this.NORMAL)return;const d=this.COMMONCOLOR[u];d!==void 0&&(r=d)},E=c===this.DAZZLE,g=c===0;r===16449530&&(r=16777215);const M=this.LIGHTLIST[n];return M===void 0?void 0:(l(c),{type:M,option:o,bright:s,speed:i,rgb:r,dazzle:M==="LightMusicFollow"||M==="LightMusicFollow2"||M==="LightMusicFollow3"?g:E})};FEA_CMD_SET_RESERT=2;reset=async(t=!0)=>{const e=await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_RESERT]),h.Bit7);return t&&e?(await this.vendorSleep(1e3*4),!0):!1};getDeviceIsBoot=async()=>!1;boot_usb=async()=>{if(this.deviceType.connect!=="usb")return;if(this.deviceType.isBoot)return this.deviceType.devAddr.toString();await this.sendMsg(new Uint8Array([127,85,170,85,170,0,0,130]),h.Bit7),await m(1e3*1);let t=0,e;for(;e===void 0&&t<100;)await m(500),e=x.devlistList.find(n=>n.oneofDev.oneofKind==="dev"&&n.oneofDev.dev.devType===N.YZWBoot),t++;if(!(e===void 0||e.oneofDev.oneofKind!=="dev"))return e.oneofDev.dev.path};upgrade=async(t,e)=>{const n=await this.boot_usb();if(n===void 0)return!1;e(0);const i=t.slice(65536),s=64,a=Math.ceil(i.length/s),r=new Uint8Array(2);r[0]=a&255,r[1]=a>>8;const o=new Uint8Array(4);o[0]=i.length&255,o[1]=(i.length&65280)>>8,o[2]=(i.length&16711680)>>16,o[3]=(i.length&4278190080)>>24;const c=[186,192];r.map(u=>c.push(u)),o.slice(0,3).map(u=>c.push(u));let l,E=0;for(;l===void 0&&E<10;)l=await this.commonMsgByPath(new Uint8Array(c),h.None,n),E++,await m(1e3);if(l===void 0)return!1;for(let u=0;u<a;u++){const d=u*s>i.length?s-(u*s-i.length):s,D=i.slice(u*s,u*s+d);if(!await this.sendMsgByPath(D,h.None,n))return!1;e(u/a)}const g=R([...i]),M=new Uint8Array(4);M[0]=g&255,M[1]=(g&65280)>>8,M[2]=(g&16711680)>>16,M[3]=(g&4278190080)>>24;const _=[186,194];return r.map(u=>_.push(u)),M.map(u=>_.push(u)),o.map(u=>_.push(u)),await this.commonMsgByPath(new Uint8Array(_),h.None,n,10,100),e(1),!0};rfUpgrade=async(t,e)=>!1;mledUpgrade=async(t,e)=>!1;oledUpgrade=async(t,e)=>!1;flashUpgrade=async(t,e)=>!1;getRFVersion=async()=>{};getMledVersion=async()=>{};getOledVersion=async()=>{};getDongleUSBVersion=async()=>{};getDongleRFVersion=async()=>{};get磁轴行程步进倍数=()=>0;setSleepTime=async t=>!1;getSleepTime=async()=>({time_bt:120,time_24:120,deepTime_bt:28*60,deepTime_24:28*60});setTFTLCDDataRGBImg=async(t,e,n)=>!1;getTFTLCDDataRGBImg=async(t,e,n)=>!1;setOLEDClock=async()=>!1;setOLEDSysInfo=async t=>!1;setOLEDLanguageSwitch=async t=>!1;setFlashChipErase=async()=>!1;setKeyConfigSimple=async(t,e,n,i)=>!1;getMultiMagnetismInfo=async()=>{};setMultiMagnetismInfo=async t=>!1;setMagnetismInfoSimple=async(t,e)=>!1;setSnapKeySimple=async(t,e)=>!1;setKeyMagnetismReport=async t=>!1;getJiaoZhunXinXiLoop=async(t,e)=>{};setJiaoZhunKaiGuan=async(t,e)=>{};setFnKeyConfigSimple=async(t,e,n)=>{};setReportRate=async t=>!1;getReportRate=async()=>{};setAutoOsen=async t=>!1;getAutoOsen=async()=>!1;setSideLightSetting=async t=>!1;getSideLightSetting=async()=>{};skuCount=0;setSku=async t=>!1;getSku=async()=>0;skuToText=t=>"";getKeyMagnetismMode=async()=>{};setKeyMagnetismMode=async t=>!1;setUserGifStart=async()=>!1;setUserGif=async(t,e)=>!1}const Z=C=>{for(let t=0;t<=C.length-4;t++)if(C[t]===0&&C[t+1]===0&&C[t+2]===0&&C[t+3]===0)return!0;return!1};class X extends K{DAZZLE=8;NORMAL=7;COMMONCOLOR={0:16711680,1:16744448,2:16776960,3:65280,4:65535,5:255,6:16711935};FEA_CMD_SET_SLEEPTIME=18;setSleepTime=async t=>{const e=new Uint8Array(64);e[0]=this.FEA_CMD_SET_SLEEPTIME;const n=t.time_bt;e[8]=n-(n>>8<<8),e[9]=n>>8;const i=t.time_24;e[10]=i-(i>>8<<8),e[11]=i>>8;const s=t.deepTime_bt;e[12]=s-(s>>8<<8),e[13]=s>>8;const a=t.deepTime_24;return e[14]=a-(a>>8<<8),e[15]=a>>8,await this.sendMsg(e,h.Bit7)?(await this.vendorSleep(),!0):!1};FEA_CMD_GET_SLEEPTIME=146;getSleepTime=async()=>{const t=new Uint8Array(8);t[0]=this.FEA_CMD_GET_SLEEPTIME;const e=await this.commonMsg(t,h.Bit7),n={time_bt:120,time_24:120,deepTime_bt:28*60,deepTime_24:28*60};if(e===void 0)return n;const i=e[2]<<8|e[1],s=e[4]<<8|e[3],a=e[6]<<8|e[5],r=e[8]<<8|e[7];return n.time_bt=i,n.time_24=s,n.deepTime_bt=a,n.deepTime_24=r,n};SIDELIGHTLIST={0:"LightOff",1:"LightAlwaysOn",2:"LightBreath",3:"LightNeon",4:"LightWave",5:"LightSnake",20:"LightMusicFollow3",21:"LightScreenColor",22:"LightMusicFollow2"};FEA_CMD_SET_SLEDPARAM=8;setSideLightSetting=async t=>{const e=new Uint8Array(64);e[0]=this.FEA_CMD_SET_SLEDPARAM;const n=G(this.SIDELIGHTLIST,t.type)??0;let i=t.dazzle;const s=i?this.DAZZLE:this.NORMAL,a=i?0:4;let r=t.option<<4|s;if((t.type==="LightMusicFollow3"||t.type==="LightMusicFollow2")&&(r=t.option<<4|a),t.type==="LightScreenColor"&&(r=0),t.type==="LightNeon"&&(r=8),e[1]=n,e[2]=t.speed,e[3]=t.bright,e[4]=r,"rgb"in t&&t.rgb!==void 0){let c=t.rgb;c===16777215&&(c=16449530);const l=L.numToRgb(c);e[5]=l.r,e[6]=l.g,e[7]=l.b}const o=await this.sendMsg(e,h.Bit8);return await this.vendorSleep(),!!o};FEA_CMD_GET_SLEDPARAM=136;getSideLightSetting=async()=>{const t=new Uint8Array(64);t[0]=this.FEA_CMD_GET_SLEDPARAM;const e=await this.commonMsg(t,h.Bit7);if(e===void 0)return;const n=e[1],i=e[2],s=e[3],a=e[4];let r=L.rgbToNum(e[5],e[6],e[7]);const o=a>>4,c=a&15,l=u=>{if(u===this.DAZZLE||u===this.NORMAL)return;const d=this.COMMONCOLOR[u];d!==void 0&&(r=d)},E=c===this.DAZZLE,g=c===0;r===16449530&&(r=16777215);const M=this.SIDELIGHTLIST[n];return M===void 0?void 0:(l(c),{type:M,option:o,bright:s,speed:i,rgb:r,dazzle:M==="LightMusicFollow2"||M==="LightMusicFollow3"?g:E})};FEA_CMD_SET_KBOPTION=6;setOldKBOption=async(t,e)=>{const n=new Uint8Array(64);n[0]=this.FEA_CMD_SET_KBOPTION,n[1]=t;const i=Number(e.winKeyLockControl),s=Number(e.system),a=Number(e.wasdKeyAndArrowKeyExchange),r=Number(e.ledOff),o=Number(e.sLedOff),c=Number(e.keyboardMode),l=Number(e.keyboardLockControl),E=Number(e.keyboardFnKeyMatrix),g=Number(e.powerSaveMode);return n[2]=i|0|s<<2|a<<3|r<<4|o<<5|c<<6|l<<7,n[3]=E,n[4]=g,await this.sendMsg(n,h.Bit7)};getOldKBOption=async t=>{const e=new Uint8Array(64);e[0]=this.FEA_CMD_GET_KBOPTION,e[1]=t;const n=await this.commonMsg(e,h.Bit7);if(n===void 0)return;const i=n[2],s=n[3],a=n[4];return{winKeyLockControl:!!(i&1),system:i&2?"mac":"win",wasdKeyAndArrowKeyExchange:!!(i&8),ledOff:!!(i&16),sLedOff:!!(i&32),keyboardMode:!!(i&64),keyboardLockControl:!!(i&128),keyboardFnKeyMatrix:!!(s&1),powerSaveMode:!!a}};defaultMatrix=[0,0,0,0,0,0,41,0,0,0,43,0,0,0,57,0,0,0,225,0,0,0,224,0,0,0,0,0,0,0,30,0,0,0,20,0,0,0,4,0,0,0,100,0,0,0,0,0,0,0,0,0,0,0,31,0,0,0,26,0,0,0,22,0,0,0,29,0,0,0,227,0,0,0,0,0,0,0,32,0,0,0,8,0,0,0,7,0,0,0,27,0,0,0,226,0,0,0,0,0,0,0,33,0,0,0,21,0,0,0,9,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,34,0,0,0,23,0,0,0,10,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,35,0,0,0,28,0,0,0,11,0,0,0,5,0,0,0,44,0,0,0,0,0,0,0,36,0,0,0,24,0,0,0,13,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,37,0,0,0,12,0,0,0,14,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0,18,0,0,0,15,0,0,0,54,0,0,0,230,0,0,0,0,0,0,0,39,0,0,0,19,0,0,0,51,0,0,0,55,0,10,1,0,0,0,0,0,0,0,0,45,0,0,0,47,0,0,0,52,0,0,0,56,0,0,0,228,0,0,0,0,0,0,0,46,0,0,0,48,0,0,0,0,0,0,0,229,0,0,0,80,0,0,0,0,0,0,0,42,0,0,0,49,0,0,0,40,0,0,0,82,0,0,0,81,0,0,0,0,0,0,0,53,0,0,0,76,0,0,0,75,0,0,0,78,0,0,0,79,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];defaultFnMatrix=[0,0,0,0,13,1,3,1,0,0,0,0,10,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,58,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,59,0,0,0,0,0,0,0,0,0,10,24,0,0,10,3,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,0,0,10,24,1,0,0,0,0,0,0,0,0,0,0,0,61,0,0,0,0,0,10,13,0,0,10,24,2,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,0,0,0,0,0,0,10,24,3,0,0,0,0,0,0,0,0,0,0,0,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,8,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65,0,0,0,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,66,0,0,0,0,0,3,0,35,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,67,0,0,0,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,68,0,0,0,74,0,0,0,0,0,3,0,146,1,0,0,0,0,0,0,0,0,0,0,69,0,0,0,77,0,0,0,0,0,3,0,148,1,13,3,1,0,0,0,0,0,10,9,0,0,13,1,0,0,13,5,1,0,13,2,1,0,13,2,2,0,0,0,0,0,13,1,3,13,3,0,226,0,3,0,233,0,3,0,234,0,13,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}class H extends X{LightList={0:"LightOff",1:"LightAlwaysOn",2:"LightBreath",3:"LightNeon",4:"LightWave",5:"LightRipple",6:"LightRaindrop",7:"LightSnake",8:"LightPressAction",9:"LightConverage",10:"LightSineWave",11:"LightKaleidoscope",12:"LightLineWave",13:"LightUserPicture",14:"LightLaser",15:"LightCircleWave",16:"LightDazzing",17:"LightRainDown",18:"LightMeteor",19:"LightPressActionOff",20:"LightMusicFollow3",21:"LightScreenColor",22:"LightMusicFollow2",23:"LightTrain",24:"LightFireWorks",66:"LightUserColor"};FEA_CMD_SET_LEDPARAM=7;setLightSetting=async t=>{const e=new Uint8Array(64);e[0]=this.FEA_CMD_SET_LEDPARAM;const n=B(this.LightList,t.type)??0;let i=t.dazzle;const s=i?this.DAZZLE:this.NORMAL,a=i?0:4;let r=t.option<<4|s;if(t.type==="LightUserPicture"&&(r=t.option<<4),(t.type==="LightMusicFollow3"||t.type==="LightMusicFollow2")&&(r=t.option<<4|a),t.type==="LightScreenColor"&&(r=0),e[1]=n,e[2]=this.MAXSPEED-t.speed,e[3]=t.bright,e[4]=r,"rgb"in t&&t.rgb!==void 0){let c=t.rgb;c===16777215&&(c=16449530);const l=L.numToRgb(c);e[5]=l.r,e[6]=l.g,e[7]=l.b}t.type==="LightUserPicture"&&(e[5]=0,e[6]=200,e[7]=200);const o=await this.sendMsg(e,h.Bit8);return await this.vendorSleep(),!!o};FEA_CMD_GET_LEDPARAM=135;getLightSetting=async()=>{const t=new Uint8Array(64);t[0]=this.FEA_CMD_GET_LEDPARAM;const e=await this.commonMsg(t,h.Bit7);if(e===void 0)return;const n=e[1],i=this.MAXSPEED-e[2],s=e[3],a=e[4];let r=L.rgbToNum(e[5],e[6],e[7]);const o=a>>4,c=a&15,l=u=>{if(u===this.DAZZLE||u===this.NORMAL)return;const d=this.COMMONCOLOR[u];d!==void 0&&(r=d)},E=c===this.DAZZLE,g=c===0;r===16449530&&(r=16777215);const M=this.LightList[n];return M===void 0?void 0:(l(c),{type:M,option:o,bright:s,speed:i,rgb:r,dazzle:M==="LightMusicFollow"||M==="LightMusicFollow2"||M==="LightMusicFollow3"?g:E})};isMagnetism=!!(this.deviceType.type==="keyboard"&&this.deviceType.magnetism);async _getKeyMatrix(t,e){const n=new Uint8Array(64);n[0]=this.FEA_CMD_GET_KEYMATRIX,n[1]=this.isMagnetism?t*4+(e??0):t;let i=[];for(let s=0;s<8;s++){n[2]=s;const a=await this.commonMsg(n,h.Bit7);a===void 0?i=[...i,...new Array(64).fill(0)]:i=[...i,...a]}return i}checkIsSupportMagnetism=()=>this.deviceType.type!=="keyboard"||!this.deviceType.magnetism?!1:this.deviceType.version.usb!==void 0&&this.deviceType.version.usb>=512;checkIsMagnetismDevice=()=>this.deviceType.type!=="keyboard"?!1:this.deviceType.magnetism;get磁轴行程步进倍数=()=>10;FEA_CMD_SET_PROFILE=5;setCurrentProfile=async(t=0)=>{const e=this.checkIsMagnetismDevice()?t*4:t,n=await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_PROFILE,e]),h.Bit7);return await this.vendorSleep(),n};FEA_CMD_GET_PROFILE=133;getCurrentProfile=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_PROFILE]),h.Bit7);if(t===void 0)return;const e=t[1];return this.checkIsMagnetismDevice()?Math.floor(e/4):e};FEA_CMD_GETMLED_VERSION=174;getMledVersion=async()=>{if(this.deviceType.connect==="bt")return;const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GETMLED_VERSION]),h.Bit7,10,100);if(!(t===void 0||t[0]!==this.FEA_CMD_GETMLED_VERSION))return t[2]<<8|t[1]};FEA_CMD_GETOLED_VERSION=173;getOledVersion=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GETOLED_VERSION]),h.Bit7,10,100);if(t===void 0||t[0]!==this.FEA_CMD_GETOLED_VERSION)return;const e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{oledVersion:e.getUint16(1,!0),flashVersion:e.getUint16(3,!0)}};FEA_CMD_SET_CMD_AUTOOSEN=23;setAutoOsen=async t=>await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_CMD_AUTOOSEN,t?1:0]),h.Bit7)?(await this.vendorSleep(),!0):!1;FEA_CMD_GET_CMD_AUTOOSEN=151;getAutoOsen=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_CMD_AUTOOSEN]),h.Bit7);return t===void 0||t[0]!==this.FEA_CMD_GET_CMD_AUTOOSEN?!1:t[1]===1};_setKeyConfig=async(t,e=0,n)=>{const i=new Uint8Array(8);i[0]=this.FEA_CMD_SET_KEYMATRIX,i[1]=this.checkIsMagnetismDevice()?e*4+(n??0):e,i[2]=248,i[3]=1;const s=9;for(let a=0;a<s;a++){let r=t.slice(a*56,56+a*56);i[4]=a,r.length<56&&(r=r.concat(new Array(56-r.length).fill(0)));const o=new Uint8Array([...i,...r]);if(!await this.sendMsg(o,h.Bit7))return!1}return!0};FEA_CMD_SET_KEYMATRIX_SIMPLE=19;setKeyConfigSimple=async(t,e,n)=>{const i=this.findIndexInDefaultMatrix(t.original,t.index);if(i===void 0||i>127)return!1;const s=v.configToMatrix(t);if(s===void 0)return!1;const a=new Uint8Array(64);a[0]=this.FEA_CMD_SET_KEYMATRIX_SIMPLE,a[1]=this.checkIsMagnetismDevice()?e*4+(n??0):e,a[2]=i,a[8]=s[0],a[9]=s[1],a[10]=s[2],a[11]=s[3];const r=await this.sendMsg(a,h.Bit7);return await this.vendorSleep(),t.type==="ConfigMacro"&&t.macroIndex!==void 0&&await this.setMacro(t,t.macroIndex),r};FEA_CMD_SET_FN_SIMPLE=21;setFnKeyConfigSimple=async(t,e)=>{const n=this.findIndexInDefaultMatrix(t.original,t.index);if(n===void 0)return;const i=new Uint8Array(64);i[0]=this.FEA_CMD_SET_FN_SIMPLE,i[1]=e,i[2]=n;let s=v.configToMatrix(t);if(s===void 0)return;const a=this.defaultFnMatrix;if(t.type==="combo"&&t.original===t.key&&t.original===t.key2&&t.original===t.skey&&(s=a.slice(n*4,4+n*4)),i[8]=s[0],i[9]=s[1],i[10]=s[2],i[11]=s[3],!!await this.sendMsg(i,h.Bit7))return await this.vendorSleep(),t.type==="combo"&&t.original===t.key&&t.original===t.key2&&t.original===t.skey?v.changeArrToConfig(a.slice(n*4,n*4+4),t.original,t.index):(t.type==="ConfigMacro"&&t.macroIndex!==void 0&&(await this.setMacro(t,t.macroIndex),await this.vendorSleep()),t)};FEA_CMD_SET_MACRO=22;FEA_CMD_SET_USERGIFSTART=24;setUserGifStart=async()=>await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_USERGIFSTART]),h.Bit7);FEA_CMD_SET_USERGIF=25;setUserGif=async(t,e)=>{const n=new Array(8);n[0]=this.FEA_CMD_SET_USERGIF,n[2]=t.currentFrame,n[3]=t.frameNum,n[4]=t.frameDelay;const i=new Array(Math.ceil(this.defaultMatrix.length/4)*3).fill(0);for(const s of t.picArr){const a=L.numToRgb(s.rgb),r=this.findIndexInDefaultMatrix(s.hid,s.index);r!==void 0&&(i[r*3]=a.r,i[r*3+1]=a.g,i[r*3+2]=a.b)}for(let s=0;s<i.length;s+=56){e!==void 0&&e((s+56)/i.length),n[1]=s/56;const a=i.slice(s,s+56),r=n.concat(a),o=new Uint8Array(r);if(!await this.sendMsg(o,h.Bit7,1))return!1}return e!==void 0&&e(1),!0};FEA_CMD_GETTFTLCDDATA=165;FEA_CMD_GET_SCREEN_24BITDATA=169;getTFTLCDDataRGBImg=async(t,e,n)=>{const i=new Uint8Array(64);i[0]=t==="16"?this.FEA_CMD_GETTFTLCDDATA:this.FEA_CMD_GET_SCREEN_24BITDATA,i[1]=e.currentFrame,i[2]=e.frameNum,i[3]=e.frameDelay;const s=e.data.length;i[4]=s&255,i[5]=(s&65535)>>8,i[6]=0,i[8]=e.left&255,i[9]=e.top&255,i[10]=e.right&255,i[11]=e.bottom&255,i[12]=e.left>>8,i[13]=e.top>>8,i[14]=e.right>>8,i[15]=e.bottom>>8,i[16]=(s&16777215)>>16,i[17]=(s&4294967295)>>24,i[18]=n??0;let a=await this.commonMsg(i,h.Bit7,10,100),r=0;for(;(a===void 0||a[1]===0)&&r<10;)await m(100),r++,a=await this.commonMsg(i,h.Bit7,10,100);return await m(100),a!==void 0&&a[1]===1};FEA_CMD_SETTFTLCDDATA=37;FEA_CMD_SET_SCREEN_24BITDATA=41;setTFTLCDDataRGBImg=async(t,e,n)=>{const i=Math.ceil(e.data.length/56),s=new Uint8Array(8);s[0]=t==="16"?this.FEA_CMD_SETTFTLCDDATA:this.FEA_CMD_SET_SCREEN_24BITDATA,s[1]=e.currentFrame,s[2]=e.frameNum,s[3]=e.frameDelay;for(let a=0;a<i;a++){let r=[...e.data.slice(a*56,a*56+56)];const o=r.length;o<56&&(r=[...r,...new Array(56-r.length).fill(0)]),s[4]=a&255,s[5]=a>>8,s[6]=o;const c=new Uint8Array([...s,...r]),l=await this.sendMsg(c,h.Bit7,1);if(n&&n(a/i),!l)return!1}return n&&n(1),!0};FEA_CMD_SET_OLEDCLOCK=40;setOLEDClock=async()=>{const t=new Uint8Array(64);t[0]=this.FEA_CMD_SET_OLEDCLOCK;const e=new Date,n=e.getFullYear();return t[8]=n>>8,t[9]=n&255,t[10]=e.getMonth()+1,t[11]=e.getDate(),t[12]=e.getHours(),t[13]=e.getMinutes(),t[14]=e.getSeconds(),await this.sendMsg(t,h.Bit7,0)};FEA_CMD_SET_OLEDOPTION=34;setOLEDSysInfo=async t=>{const e=Math.round(Number(t.diskSpceAvailable)/1024/1024/1024),n=Math.round(Number(t.diskSpaceTotal)/1024/1024/1024),i=Math.round(Number(t.memUsed)/1024/1024/1024),s=Math.round(Number(t.memTotal)/1024/1024/1024),a=t.cpuUsage,r=t.cpuTemperater,o=Math.round(Number(t.netWorkTotalUp)/1024/1024/1024),c=Math.round(Number(t.netWorkTotalDown)/1024/1024/1024),l=new Uint8Array(64);return l[0]=this.FEA_CMD_SET_OLEDOPTION,l[8]=e&255,l[9]=e>>8,l[10]=n&255,l[11]=n>>8,l[12]=i&255,l[13]=i>>8,l[14]=s&255,l[15]=s>>8,l[16]=a,l[17]=r,l[18]=o&255,l[19]=o>>8,l[20]=c&255,l[21]=c>>8,await this.sendMsg(l,h.Bit7)};FEA_CMD_SET_OLEDLUANGAGE=39;setOLEDLanguageSwitch=async t=>await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_OLEDLUANGAGE,t?1:0]),h.Bit7)?(await this.vendorSleep(),!0):!1;FEA_CMD_SET_FLASHCHIPERASSE=172;setFlashChipErase=async()=>{const t=new Uint8Array(64);t[0]=this.FEA_CMD_SET_FLASHCHIPERASSE;const e=await this.commonMsg(t,h.Bit7);return e===void 0?!1:e[0]===this.FEA_CMD_SET_FLASHCHIPERASSE&&e[1]===170&&e[2]===170&&e[3]===85&&e[4]===85};FEA_CMD_SET_MAGNETISM_REPOR=27;setKeyMagnetismReport=async t=>{const e=new Uint8Array(8);e[0]=this.FEA_CMD_SET_MAGNETISM_REPOR,e[1]=Number(t);const n=await this.sendMsg(e,h.Bit7);return await this.vendorSleep(),n};FEA_CMD_SET_MAGNETISM_CAL=28;_setZuiXiaoXingChengJiaoZhun=async t=>{const e=new Uint8Array(8);e[0]=this.FEA_CMD_SET_MAGNETISM_CAL,e[1]=Number(t);const n=await this.sendMsg(e,h.Bit7);return await this.vendorSleep(),n};FEA_CMD_SET_MAGNETISM_MAXIMUM_CALIBRATION=30;_setZuiDaXingChengJiaoZhun=async t=>{const e=new Uint8Array(8);e[0]=this.FEA_CMD_SET_MAGNETISM_MAXIMUM_CALIBRATION,e[1]=Number(t);const n=await this.sendMsg(e,h.Bit7);return await this.vendorSleep(),n};FEA_CMD_GET_MAGNETISM_CALMAX=158;FEA_CMD_GET_MAGNETISM_CAL=156;_getMagnetismCalibrationValue=async()=>{const t=[],e=[],n=new Uint8Array(64);n[0]=this.FEA_CMD_GET_MAGNETISM_CALMAX;for(let a=0;a<4;a++){n[1]=a;let r=await this.commonMsg(n,h.Bit7,0,0)??new Uint8Array(new Array(64).fill(0));for(let o=0;o<32;o++)t.push(r[o*2+1]<<8|r[o*2])}const i=new Uint8Array(64);i[0]=this.FEA_CMD_GET_MAGNETISM_CAL;for(let a=0;a<4;a++){i[1]=a;let r=await this.commonMsg(i,h.Bit7,0,0)??new Uint8Array(new Array(64).fill(0));for(let o=0;o<32;o++)e.push(r[o*2+1]<<8|r[o*2])}const s=[];return t.forEach((a,r)=>{const o=Math.abs(a-e[r])/400;s.push(o>1?1:o<0?0:o)}),s};_getJiaoZhunXinXi=async()=>{const t=new Array(this.defaultMatrix.length/4).fill(0),e=await this._getMagnetismCalibrationValue();if(t.length!==e.length)return;const n=new Array;for(let i=0;i<this.defaultMatrix.length;i+=4){const s=this.defaultMatrix.slice(i,i+4),a=v.matrixToHid(s);if(a===void 0)continue;const r=i/4,o=n.filter(c=>c.original===a).length;n.push({磁通量:t[r],行程值:e[r],original:a,index:o})}return n};_callbackJiaoZhunXinXiMark=!1;_stateJiaoZhunXinXi="end";getJiaoZhunXinXiLoop=async(t,e)=>{if(this._callbackJiaoZhunXinXiMark=t,t)for(;this._callbackJiaoZhunXinXiMark;){this._stateJiaoZhunXinXi="ing";const n=await this._getJiaoZhunXinXi();e&&e(n),this._stateJiaoZhunXinXi="end"}};setJiaoZhunKaiGuan=async(t,e)=>{for(this._callbackJiaoZhunXinXiMark=!1;this._stateJiaoZhunXinXi==="ing";)await m(10);t?(await this._setZuiXiaoXingChengJiaoZhun(!0),await this._setZuiXiaoXingChengJiaoZhun(!1),await this._setZuiDaXingChengJiaoZhun(!0)):await this._setZuiDaXingChengJiaoZhun(!1),this.getJiaoZhunXinXiLoop(t,e)};FEA_CMD_GET_MULTI_MAGNETISM=229;_getMulitMagnetismCMD=async(t,e,n=10,i=10)=>{const s=new Uint8Array(8);s[0]=this.FEA_CMD_GET_MULTI_MAGNETISM,s[1]=t,s[2]=1;let a=[];for(let r=0;r<e;r++){s[3]=r;const o=await this.commonMsg(s,h.Bit7,n,i);o===void 0?(this._callbackJiaoZhunXinXiMark=!1,a=[...a,...new Array(64).fill(0)]):a=[...a,...o]}return a};_decodeMagnetismKeyModes=t=>{const e=[];for(let n=0;n<t.length;n++){const i=this.findHidWithIndexInMatrix(n);if(i===0)continue;const s=t[n],a=(s&128)===128,r=s&127,o=e.filter(l=>l.original===i),c={original:i,index:o.length,pos:n};switch(r){case 0:e.push({...c,option:"normal",fire:a});break;case 2:e.push({...c,option:"dks",fire:a});break;case 3:e.push({...c,option:"mt",fire:a});break;case 4:e.push({...c,option:"tgl_hold",fire:a});break;case 5:e.push({...c,option:"tgl_dots",fire:a});break;case 7:e.push({...c,option:"snap",fire:a});break}}return e};getMultiMagnetismInfo=async()=>{const t=Math.ceil(this.defaultMatrix.length/4),e=await this._getMulitMagnetismCMD(7,2),n=this._decodeMagnetismKeyModes(e),i=await this._getMulitMagnetismCMD(0,2),s=await this._getMulitMagnetismCMD(1,2),a=await this._getMulitMagnetismCMD(6,2);let r=new Array(t).fill(0),o=new Array(t).fill(0);n.some(u=>"fire"in u&&u.fire)&&(r=await this._getMulitMagnetismCMD(2,2),r=await this._getMulitMagnetismCMD(3,2));let c=new Array(t).fill(0),l=new Array(t*4).fill(0);n.some(u=>u.option==="dks")&&(c=await this._getMulitMagnetismCMD(4,2),l=await this._getMulitMagnetismCMD(10,8));let E=new Array(t).fill(0);n.some(u=>u.option==="mt")&&(E=await this._getMulitMagnetismCMD(5,2));let g=new Array(t).fill(0);n.some(u=>u.option==="snap")&&(g=await this._getMulitMagnetismCMD(9,2));const M=[],_=this.get磁轴行程步进倍数();for(let u=0;u<n.length;u++){const d=n[u],D=(r[d.pos]+1)/_,f=(o[d.pos]+1)/_,y=d.fire,T={original:d.original,index:d.index};switch(d.option){case"normal":M.push({...T,fire:y,firePressTravel:D,fireLiftTravel:f,mode:"normal",option:"normal",travel:(i[d.pos]+1)/_,liftTravel:(s[d.pos]+1)/_,deadZoneTravel:(40-(a[d.pos]+1))/_});break;case"dks":const A=[0,0,0,0];for(let S=0;S<4;S++){const U=l.slice(S*128,(S+1)*128);A[S]=U[d.pos]}M.push({...T,fire:y,firePressTravel:D,fireLiftTravel:f,mode:"normal",option:"dks",dynamicTravel:(c[d.pos]+2)/_,triggerModes:A});break;case"mt":M.push({...T,fire:y,firePressTravel:D,fireLiftTravel:f,mode:"normal",option:"mt",mt_time:E[d.pos]*10});break;case"tgl_hold":M.push({...T,fire:y,firePressTravel:D,fireLiftTravel:f,mode:"normal",option:"tgl_hold"});break;case"tgl_dots":M.push({...T,fire:y,firePressTravel:D,fireLiftTravel:f,mode:"normal",option:"tgl_dots"});break;case"snap":const p=g[d.pos],b=this.defaultMatrix.slice(p*4,p*4+4),O=v.matrixToHid(b);M.push({...T,fire:y,firePressTravel:D,fireLiftTravel:f,mode:"normal",option:"snap",travel:(i[d.pos]+1)/_,liftTravel:(s[d.pos]+1)/_,deadZoneTravel:(40-(a[d.pos]+1))/_,bindKeyOriginal:O,bindKeyIndex:0});break}}return M};FEA_CMD_SET_MULTI_MAGNETISM=101;_sendMagnetismInfoSimpleCMD=async(t,e,n,i)=>{const s=new Uint8Array(8);s[0]=this.FEA_CMD_SET_MULTI_MAGNETISM,s[1]=t,s[2]=0,s[3]=e,s[4]=n?1:0;const a=new Uint8Array([...s,...i]);return!!await this.sendMsg(a,h.Bit7)};_magnetismModesOptionToNum=(t,e)=>{let n=0;switch(t){case"normal":n=0;break;case"dks":n=2;break;case"mt":n=3;break;case"tgl_hold":n=4;break;case"tgl_dots":n=5;break;case"snap":n=7;break}return e?n|128:n};_磁轴UIdataTo固件Data=t=>{const e=this.get磁轴行程步进倍数(),n=t*e-1;return n<0?0:n};setSnapKeySimple=async(t,e)=>{const n=this.findIndexInDefaultMatrix(t.original,t.index),i=this.findIndexInDefaultMatrix(t.bindKeyOriginal,t.bindKeyIndex);return n===void 0||i===void 0?!1:(await this._sendMagnetismInfoSimpleCMD(7,n,!1,[this._magnetismModesOptionToNum("snap","fire"in t&&t.fire)]),await this._sendMagnetismInfoSimpleCMD(7,i,!1,[this._magnetismModesOptionToNum("snap",e===void 0?!1:"fire"in e&&e.fire)]),await this._sendMagnetismInfoSimpleCMD(9,n,!1,[i]),await this._sendMagnetismInfoSimpleCMD(9,i,!0,[n]),!0)};setMagnetismInfoSimple=async(t,e)=>{const n=this.findIndexInDefaultMatrix(t.original,t.index);if(n===void 0||n>127)return!1;const i=[];if(e===void 0?("travel"in t&&i.push(0),"liftTravel"in t&&i.push(1),"deadZoneTravel"in t&&i.push(6),"firePressTravel"in t&&t.fire&&i.push(2),"fireLiftTravel"in t&&t.fire&&i.push(3),"dynamicTravel"in t&&i.push(4),"triggerModes"in t&&i.push(8),"mt_time"in t&&i.push(5)):("travel"in t&&("travel"in e&&t.travel!==e.travel||!("travel"in e))&&i.push(0),"liftTravel"in t&&("liftTravel"in e&&t.liftTravel!==e.liftTravel||!("liftTravel"in e))&&i.push(1),"deadZoneTravel"in t&&("deadZoneTravel"in e&&t.deadZoneTravel!==e.deadZoneTravel||!("deadZoneTravel"in e))&&i.push(6),"firePressTravel"in t&&"firePressTravel"in e&&t.firePressTravel!==e.firePressTravel&&i.push(2),"fireLiftTravel"in t&&"fireLiftTravel"in e&&t.fireLiftTravel!==e.fireLiftTravel&&i.push(3),"dynamicTravel"in t&&("dynamicTravel"in e&&t.dynamicTravel!==e.dynamicTravel||!("dynamicTravel"in e))&&i.push(4),"triggerModes"in t&&("triggerModes"in e&&!I(t.triggerModes??[],e.triggerModes??[])||!("triggerModes"in e))&&i.push(8),"mt_time"in t&&("mt_time"in e&&t.mt_time!==e.mt_time||!("mt_time"in e))&&i.push(5)),t.option!==e?.option||t.fire!==e?.fire){const a=this._magnetismModesOptionToNum(t.option,"fire"in t&&t.fire);if(!await this._sendMagnetismInfoSimpleCMD(7,n,i.length===0,[a]))return!1;i.length===0&&await this.vendorSleep()}const s=this.get磁轴行程步进倍数();for(let a=0;a<i.length;a++){const r=i[a];let o=[];if(r===0&&"travel"in t&&(o=[this._磁轴UIdataTo固件Data(t.travel)]),r===1&&"liftTravel"in t&&(o=[this._磁轴UIdataTo固件Data(t.liftTravel)]),r===6&&"deadZoneTravel"in t&&(o=[40-(t.deadZoneTravel??0)*s-1]),r===2&&"firePressTravel"in t&&(o=[this._磁轴UIdataTo固件Data(t.firePressTravel)]),r===3&&"fireLiftTravel"in t&&(o=[this._磁轴UIdataTo固件Data(t.fireLiftTravel)]),r===4&&"dynamicTravel"in t&&(o=[t.dynamicTravel*s-2]),r===8&&"triggerModes"in t&&(o=t.triggerModes??[0,0,0,0]),r===5&&"mt_time"in t&&(o=[t.mt_time/10]),!await this._sendMagnetismInfoSimpleCMD(r,n,a===i.length-1,o))return!1}return await this.vendorSleep(),!0};上一笔的磁轴数据={options:new Array,travels:new Array,liftTravels:new Array,firePressTravels:new Array,fireLiftTravels:new Array,deadZoneTravels:new Array,dynamicTravels:new Array,mt_times:new Array,bindKeyOriginals:new Array,dksList:new Array};setMultiMagnetismInfo=async t=>{const e=async(f,y,T)=>{const A=new Uint8Array(8);A[0]=this.FEA_CMD_SET_MULTI_MAGNETISM,A[1]=f,A[2]=1;const p=Math.ceil(T.length/56);for(let b=0;b<p;b++){const O=T.slice(b*56,(b+1)*56);A[3]=b,A[4]=Number(y&&b===p-1);const S=new Uint8Array([...A,...O]);if(!await this.sendMsg(S,h.Bit7))return!1}return!0},n=new Array(this.defaultMatrix.length/4).fill({mode:"normal",option:"normal",fire:!1,fireLiftTravel:0,firePressTravels:0,index:0,original:0,liftTravel:0,deadZoneTravel:0,travel:0});for(const f of t){const y=this.findIndexInDefaultMatrix(f.original,f.index);y!==void 0&&(n[y]=f)}const i=this.get磁轴行程步进倍数(),s=[],a=n.map(f=>this._magnetismModesOptionToNum(f.option,"fire"in f&&f.fire)),r=n.map(f=>"travel"in f?this._磁轴UIdataTo固件Data(f.travel):0),o=n.map(f=>"liftTravel"in f?this._磁轴UIdataTo固件Data(f.liftTravel):0),c=n.map(f=>"firePressTravel"in f?this._磁轴UIdataTo固件Data(f.firePressTravel):0),l=n.map(f=>"fireLiftTravel"in f?this._磁轴UIdataTo固件Data(f.fireLiftTravel):0),E=n.map(f=>"deadZoneTravel"in f?40-(f.deadZoneTravel??0)*i-1:0),g=n.map(f=>"dynamicTravel"in f?this._磁轴UIdataTo固件Data(f.dynamicTravel??0):0);w(a,this.上一笔的磁轴数据?.options)||s.push({op:0,data:a}),w(r,this.上一笔的磁轴数据?.travels)||s.push({op:0,data:r}),w(o,this.上一笔的磁轴数据?.liftTravels)||s.push({op:1,data:o}),w(c,this.上一笔的磁轴数据?.firePressTravels)||s.push({op:2,data:c}),w(l,this.上一笔的磁轴数据?.fireLiftTravels)||s.push({op:3,data:l}),w(E,this.上一笔的磁轴数据?.deadZoneTravels)||s.push({op:6,data:E}),w(g,this.上一笔的磁轴数据?.dynamicTravels)||s.push({op:4,data:g});const M=n.map(f=>"mt_time"in f?f.mt_time/10:0),_=n.map(f=>"bindKeyOriginal"in f?f.bindKeyOriginal:0);if(w(M,this.上一笔的磁轴数据?.mt_times)||s.push({op:5,data:M}),!w(_,this.上一笔的磁轴数据?.bindKeyOriginals)){const f=new Array(_.length).fill(0);for(let y=0;y<_.length;y++){const T=_[y];if(T===0)continue;const A=this.findIndexInDefaultMatrix(T,0);A!==void 0&&(f[y]=A)}s.push({op:9,data:f})}const u=t.filter(f=>f.option==="dks"),d=!w(u,this.上一笔的磁轴数据?.dksList),D=(f,y)=>{const T=Math.ceil(this.defaultMatrix.length/4),A=new Array(T).fill(f);for(let p=0;p<T;p++)A[p]=y[p];return A};for(let f=0;f<s.length;f++){const y=s[f],T=f===s.length-1&&!d;let A=0;switch(y.op){case 0:A=200;break;case 1:A=280;break;case 6:A=30;break;default:A=0;break}if(!await e(y.op,T,D(A,y.data)))return!1}if(d)for(let f=0;f<u.length;f++){const y=u[f],T=this.findIndexInDefaultMatrix(y.original,y.index);if(T===void 0)continue;if(!await this._sendMagnetismInfoSimpleCMD(8,T,f===u.length-1,y.triggerModes??[0,0,0,0]))return!1}return this.上一笔的磁轴数据={options:a,travels:r,liftTravels:o,firePressTravels:c,fireLiftTravels:l,deadZoneTravels:E,dynamicTravels:g,mt_times:M,bindKeyOriginals:_,dksList:u},await this.vendorSleep(),!0};FEA_CMD_SET_KEY_MAGNETISM_MODE=29;setKeyMagnetismMode=async t=>{const e=new Uint8Array(8);switch(e[0]=this.FEA_CMD_SET_KEY_MAGNETISM_MODE,t){case"comfort":e[1]=0;break;case"sensitive":e[1]=1;break;case"gaming":e[1]=2;break;case"custom":e[1]=3;break}return await this.sendMsg(e,h.Bit7)?(await this.vendorSleep(),!0):!1};FEA_CMD_GET_KEY_MAGNETISM_MODE=157;getKeyMagnetismMode=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_KEY_MAGNETISM_MODE]),h.Bit7);if(!(t===void 0||t[0]!==this.FEA_CMD_GET_KEY_MAGNETISM_MODE))switch(t[1]){case 0:return"comfort";case 1:return"sensitive";case 2:return"gaming";case 3:return"custom";default:return}};rfUpgrade=async(t,e)=>!1;findSameDevPath=async t=>{let e=0,n;for(;n===void 0&&e<20;){await m(500);const i=x.devlistList.find(s=>s.oneofDev.oneofKind==="dev"&&(s.oneofDev.dev.path===this.deviceType.devAddr||s.oneofDev.dev.id===this.deviceType.id||t!==void 0&&s.oneofDev.dev.id===t));n=i?.oneofDev.oneofKind==="dev"?i.oneofDev.dev.path:void 0,e++}if(n!==void 0)return n};FEA_CMD_SET_OLEDBOOTLOADER=48;FEA_CMD_GET_OLEDBOOTLOADER=176;FEA_CMD_SET_OLEDBOOTSTART=49;FEA_CMD_GET_OLEDBOOTCHECKSUM=177;oledUpgrade=async(t,e)=>{e(0);const n=await this.findSameDevPath();if(n===void 0||!await this.sendMsgByPath(new Uint8Array([this.FEA_CMD_SET_OLEDBOOTLOADER,85,170,85,170,0,0,0]),h.Bit7,n))return!1;let s=0,a=!1;for(;!a&&s<5;){await m(1e3*3);const _=await this.commonMsgByPath(new Uint8Array([this.FEA_CMD_GET_OLEDBOOTLOADER]),h.Bit7,n,10,100);a=_!==void 0&&_[0]===this.FEA_CMD_GET_OLEDBOOTLOADER,s++}const r=t.slice(65536),o=64,c=Math.ceil(r.length/o),l=new Uint8Array(2);l[0]=c&255,l[1]=c>>8,await this.sendMsgByPath(new Uint8Array([this.FEA_CMD_SET_OLEDBOOTSTART,...l]),h.Bit7,n);let E=0;for(let _=0;_<c;_++){const u=_*o>r.length?o-(_*o-r.length):o,d=r.slice(_*o,_*o+u),D=await this.sendMsgByPath(d,h.None,n);for(let f=0;f<d.length;f++)E+=d[f];if(D)e(_/c);else return e(1),!1}const g=new Uint8Array(4);g[0]=E&255,g[1]=(E&65280)>>8,g[2]=(E&16711680)>>16,g[3]=(E&4278190080)>>24;const M=await this.commonMsgByPath(new Uint8Array([this.FEA_CMD_GET_OLEDBOOTCHECKSUM,...g]),h.Bit7,n,10,1e3*1);return e(1),M!==void 0&&M[1]===85};FEA_CMD_SET_MLEDBOOTLOADER=64;FEA_CMD_GET_MLEDBOOTLOADER=192;FEA_CMD_SET_MLEDBOOTSTART=65;FEA_CMD_GET_MLEDBOOTCHECKSUM=193;mledUpgrade=async(t,e)=>{e(0);const n=await this.findSameDevPath();if(n===void 0||!await this.sendMsgByPath(new Uint8Array([this.FEA_CMD_SET_MLEDBOOTLOADER,85,170,85,170,0,0,0]),h.Bit7,n))return!1;await m(1e3*3);let s=!1,a=0;for(;!s&&a<5;){const _=await this.commonMsgByPath(new Uint8Array([this.FEA_CMD_GET_MLEDBOOTLOADER]),h.Bit7,n);s=_!==void 0&&_[0]===this.FEA_CMD_GET_MLEDBOOTLOADER,a++,await m(100)}if(!s)return!1;const r=t.slice(65536),o=64,c=Math.ceil(r.length/o),l=new Uint8Array(2);l[0]=c&255,l[1]=c>>8,await m(100),await this.sendMsgByPath(new Uint8Array([this.FEA_CMD_SET_MLEDBOOTSTART,...l]),h.Bit7,n),await m(100);for(let _=0;_<c;_++){const u=_*o>r.length?o-(_*o-r.length):o,d=r.slice(_*o,_*o+u);if(await this.sendMsgByPath(d,h.None,n))e(_/c);else return!1}const E=R([...r]),g=new Uint8Array(4);g[0]=E&255,g[1]=(E&65280)>>8,g[2]=(E&16711680)>>16,g[3]=(E&4278190080)>>24;let M=!1;for(a=0;!M&&a<5;){await m(500);const _=await this.commonMsgByPath(new Uint8Array([this.FEA_CMD_GET_MLEDBOOTCHECKSUM,...g]),h.Bit7,n);M=_!==void 0&&_[1]===85,a++}return e(1),M};FEA_CMD_SETTFTFLASHDATA=50;FEA_CMD_GETTFTFLASHDATA=178;flashUpgrade=async(t,e)=>{e(0);const n=await this.findSameDevPath();if(n===void 0)return!1;const i=t,s=56,a=Math.ceil(i.length/s),r=await this.commonMsgByPath(new Uint8Array([this.FEA_CMD_GETTFTFLASHDATA]),h.Bit7,n);if(r===void 0||r[0]!==this.FEA_CMD_GETTFTFLASHDATA||r[1]!==1)return!1;for(let o=0;o<a;o++){let c=s;(o+1)*s>i.length&&(c=s-((o+1)*s-i.length));const l=o*s,E=o*s+c,g=i.slice(l,E),M=new Uint8Array([this.FEA_CMD_SETTFTFLASHDATA,o&255,o>>8,g.length,0,0,0,0,...g]);if(!await this.sendMsgByPath(M,h.Bit7,n))return!1;await m(2),e(o/a)}return!1};defaultMatrix=[0,0,41,0,0,0,53,0,0,0,43,0,0,0,57,0,0,0,225,0,0,0,224,0,0,0,58,0,0,0,30,0,0,0,20,0,0,0,4,0,0,0,100,0,0,0,0,0,0,0,59,0,0,0,31,0,0,0,26,0,0,0,22,0,0,0,29,0,0,0,227,0,0,0,60,0,0,0,32,0,0,0,8,0,0,0,7,0,0,0,27,0,0,0,226,0,0,0,61,0,0,0,33,0,0,0,21,0,0,0,9,0,0,0,6,0,0,0,0,0,0,0,62,0,0,0,34,0,0,0,23,0,0,0,10,0,0,0,25,0,0,0,0,0,0,0,63,0,0,0,35,0,0,0,28,0,0,0,11,0,0,0,5,0,0,0,44,0,0,0,64,0,0,0,36,0,0,0,24,0,0,0,13,0,0,0,17,0,0,0,0,0,0,0,65,0,0,0,37,0,0,0,12,0,0,0,14,0,0,0,16,0,0,0,0,0,0,0,66,0,0,0,38,0,0,0,18,0,0,0,15,0,0,0,54,0,0,0,230,0,0,0,67,0,0,0,39,0,0,0,19,0,0,0,51,0,0,0,55,0,10,1,0,0,0,0,68,0,0,0,45,0,0,0,47,0,0,0,52,0,0,0,56,0,0,0,228,0,0,0,69,0,0,0,46,0,0,0,48,0,0,0,50,0,0,0,229,0,0,0,80,0,0,0,76,0,0,0,42,0,0,0,49,0,0,0,40,0,0,0,82,0,0,0,81,0,3,0,226,0,0,0,74,0,0,0,75,0,0,0,78,0,0,0,0,0,0,0,79,0,3,0,234,0,3,0,233,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];defaultFnMatrix=[10,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,112,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,111,0,14,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,10,3,0,0,0,0,227,7,14,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,227,43,14,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,227,55,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,182,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,205,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,181,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,226,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,234,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,233,0,0,0,0,0,10,12,0,0,0,0,0,0,0,0,0,0,13,3,1,0,0,0,0,0,10,8,0,0,13,1,0,0,13,5,1,0,13,2,1,0,13,2,2,0,19,3,0,0,0,0,0,0,0,0,70,0,0,0,77,0,0,0,0,0,13,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}export{H as CommonKbYc500};
