import{r as f,u as x,d as o,G as S,ar as F,a9 as D,ao as w,j as C,V as H}from"./index.b078bf5f.js";const q=d=>f.memo(()=>{x(!0);const l=o.state_行程校准,v=o.getCurrentDevice().deviceType.version?.rf??o.getCurrentDevice().deviceType.version?.usb,b=S();F(b);const p=f.useCallback(t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),t.returnValue=!1;const e=t.code;return l.当前按下按键_开校准=e,!1},[l]);f.useEffect(()=>{if(l.显示行程校准弹窗)return document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p),l.当前按下按键_开校准=null}},[l.显示行程校准弹窗,p]);const m=f.useMemo(()=>({初始值字典:{},keyElements:new Map,svgHeights:new Map,heightFactorsForCalibration:new Map}),[]),A=f.useCallback((t,e,a)=>{const{初始值字典:i,keyElements:n,svgHeights:u,heightFactorsForCalibration:s}=m;if(!o.keyboardState.keys[t]){e.style.display="none";return}const h=e.querySelector("text");h&&(i[t]=h.querySelector("tspan")?.textContent||"");const c=e.querySelector("rect[id]");if(!c)return;n.set(t,{node:e,rect:c,fill:e.querySelector("rect[id]"),texts:Array.from(e.querySelectorAll("text"))});const g=D.getRect(c).h;u.set(t,g);const y=300;s.set(t,g/y);const r=n.get(t);if(!r)return;r.fill.setAttribute("height","0"),r.fill.setAttribute("opacity","0.3"),o.calibratedKeyCodeSet.has(t)?(r.fill.setAttribute("height",`${u.get(t)}`),r.fill.setAttribute("opacity","0.8")):(r.fill.setAttribute("height","0"),r.fill.setAttribute("opacity","0.3"))},[m]),E=f.useCallback((t,e,a,i,n,u)=>{const{fill:s}=a;if(i.磁轴按键校准事件!=="none_调用结束"){const h=o.calibratedKeyCodeSet.has(t),c=n.get(t)||0,g=e?e*(u.get(t)||0):0,r=v&&v<768?1:300;h?(s.setAttribute("height",`${n.get(t)}`),s.setAttribute("opacity","0.8")):e&&e>0?(s.setAttribute("height",`${Math.min(c,g)}`),s.setAttribute("opacity",e>=r?"0.8":"0.3"),e>=r&&o.calibratedKeyCodeSet.add(t)):(s.setAttribute("height","0"),s.setAttribute("opacity","0.3"))}},[]);return w({ref:b,onInit:t=>{const e=d(t);e.hideAll(),e.show(i=>i.calibration);const a=e.status.calibration;return Object.entries(a?.id||{}).forEach(([i,n])=>{A(i,n,a)}),{ui:e,...m}},onRefresh:({ui:t,keyElements:e,svgHeights:a,heightFactorsForCalibration:i})=>{const n=o.getCurrentDevice().磁轴.磁轴按键校准数组;e.forEach((u,s)=>{const{行程值:h}=n.find(c=>c.code===s)||{};E(s,h,u,l,a,i)})}}),C.jsx(H,{divRef:b})});export{q as c};
