import{ad as F,ak as D,ai as a,ae as p,af as y,ag as d,ah as f,aj as m,al as S,an as L,N as w,am as R}from"./index.b078bf5f.js";class U extends F{FEA_CMD_GET_REV=128;FEA_CMD_SET_WIRELESS_SYNC=1;FEA_CMD_SET_RESERT=2;FEA_CMD_SET_REPORT=4;FEA_CMD_GET_REPORT=132;FEA_CMD_SET_PROFILE=5;FEA_CMD_GET_PROFILE=133;FEA_CMD_SET_KBOPTION=6;FEA_CMD_GET_KBOPTION=134;FEA_CMD_SET_LEDPARAM=7;FEA_CMD_GET_LEDPARAM=135;FEA_CMD_SET_SLEDPARAM=8;FEA_CMD_GET_SLEDPARAM=136;FEA_CMD_SET_KEYMATRIX=9;FEA_CMD_GET_KEYMATRIX=137;FEA_CMD_SET_KEYENABLE=10;FEA_CMD_GET_KEYENABLE=138;FEA_CMD_SET_MACRO=11;FEA_CMD_GET_MACRO=139;FEA_CMD_SET_USERPIC=12;FEA_CMD_GET_USERPIC=140;FEA_CMD_SET_AUDIO=13;FEA_CMD_SET_WINDOS=14;FEA_CMD_GET_INFOR=143;FEA_CMD_SET_FN=16;FEA_CMD_GET_FN=144;FEA_CMD_SET_DEBOUNCE=17;FEA_CMD_GET_DEBOUNCE=145;FEA_CMD_SET_SLEEPTIME=18;FEA_CMD_GET_SLEEPTIME=146;FEA_CMD_SET_KEYMATRIX_SIMPLE=19;FEA_CMD_GET_KEYMATRIX_SIMPLE=147;FEA_CMD_SET_USERPIC_SIMPLE=20;FEA_CMD_GET_USERPIC_SIMPLE=148;FEA_CMD_SET_FN_SIMPLE=21;FEA_CMD_GET_FN_SIMPLE=149;FEA_CMD_SET_MACRO_SIMPLE=22;FEA_CMD_GET_MACRO_SIMPLE=150;FEA_CMD_SET_AUTOOS_EN=23;FEA_CMD_GET_AUTOOS_EN=151;FEA_CMD_SET_USERGIFSTART=24;FEA_CMD_SET_USERGIF=25;FEA_CMD_SET_OLEDPICINDEX=32;FEA_CMD_GET_OLEDPICINDEX=160;FEA_CMD_SET_OLEDPICDATA=33;FEA_CMD_GET_OLEDPICDATA=161;FEA_CMD_SET_OLEDOPTION=34;FEA_CMD_GET_OLEDOPTION=162;FEA_CMD_SET_KEYSTROKE=35;FEA_CMD_GET_KEYSTROKE=163;FEA_CMD_SET_OLEDGIFDATA=36;FEA_CMD_GET_OLEDGIFDATA=164;FEA_CMD_SETTFTLCDDATA=37;FEA_CMD_GETTFTLCDDATA=165;FEA_CMD_SET_OLEDGIFINDEX=38;FEA_CMD_GET_OLEDGIFINDEX=166;FEA_CMD_SET_OLEDLUANGAGE=39;FEA_CMD_SET_OLEDCLOCK=40;FEA_CMD_SET_SCREEN_24BITDATA=41;FEA_CMD_SET_OLEDWEATHER=42;FEA_CMD_SET_OLEDEFFECT=43;FEA_CMD_GET_OLEDEFFECT=171;FEA_CMD_SET_FLASHCHIPERASSE=44;FEA_CMD_GET_FLASHCHIPERASSE=172;FEA_CMD_GETOLED_VERSION=173;FEA_CMD_SET_OLED_BOOT=48;FEA_CMD_GET_OLED_BOOT=176;FEA_CMD_SET_OLED_BOOTSTART=49;FEA_CMD_GET_OLED_BOOTSTART=177;FEA_CMD_MOUSE_SET_KEYMATRIX=80;FEA_CMD_MOUSE_GET_KEYMATRIX=208;FEA_CMD_MOUSE_SET_FNMATRIX=81;FEA_CMD_MOUSE_GET_FNMATRIX=209;FEA_CMD_MOUSE_SET_USERPIC=82;FEA_CMD_MOUSE_GET_USERPIC=210;FEA_CMD_MOUSE_SET_OPTIONPARAM0=83;FEA_CMD_MOUSE_GET_OPTIONPARAM0=211;FEA_CMD_MOUSE_SET_OPTIONPARAM1=84;FEA_CMD_MOUSE_GET_OPTIONPARAM1=212;FEA_CMD_GET_SCREEN_24BITDATA=169;FEA_CMD_SET_DOWNCOUNT=85;FEA_CMD_SET_CONTROLRECOIL=96;FEA_CMD_GET_CONTROLRECOIL=224;FEA_CMD_GET_CLEARBLUEINFRO=97;FEA_CMD_GET_DOWNCOUNT=85;type="mousePan1080";defaultMatrix=[1,0,240,0,1,0,241,0,1,0,242,0,1,0,244,0,1,0,243,0,20,0,0,0,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,249,1,1,0,249,255,1,0,245,1,1,0,245,255];_decodedReportRate=t=>{switch(t){case 129:return 8e3;case 130:return 4e3;case 132:return 2e3;case 1:return 1e3;case 2:return 500;case 4:return 250;case 8:return 125;default:return}};_encodeReportRate=t=>{switch(t){case 8e3:return 129;case 4e3:return 130;case 2e3:return 132;case 1e3:return 1;case 500:return 2;case 250:return 4;case 125:return 8;default:return 0}};MAXSPEED=4;NORMAL=7;DAZZLE=8;COMMONCOLOR={0:16711680,1:16744448,2:16776960,3:65280,4:65535,5:255,6:16711935};_decodedLightBuf=t=>{const e=t[0],n=this.MAXSPEED-t[1],s=t[2],i=t[3];let o=D.rgbToNum(t[4],t[5],t[6]);const r=i>>4,_=i&15,E=T=>{if(T===this.DAZZLE||T===this.NORMAL)return;const u=this.COMMONCOLOR[T];u!==void 0&&(o=u)},c=_===this.DAZZLE,l=_===0;o===16449530&&(o=16777215);const M={0:{type:"LightOff",option:0},1:{type:"LightAlwaysOn",option:0},2:{type:"LightBreath",option:0},3:{type:"LightNeon",option:r},4:{type:"LightWave",option:r},5:{type:"LightDazzing",option:0},6:{type:"LightLaser",option:0},7:{type:"LightMusicFollow",option:r},8:{type:"LightScreenColor",option:0},9:{type:"LightMusicFollow2",option:r}}[e];if(M!==void 0)return E(_),{...M,option:r,bright:s,speed:n,rgb:o,dazzle:M.type==="LightMusicFollow"||M.type==="LightMusicFollow2"?l:c}};_encodeLight=t=>{const e=new Uint8Array(8);if(t===void 0)return e;let n=0,s=t.dazzle;const i=s?this.DAZZLE:this.NORMAL,o=s?0:4;let r=t.option<<4|i;switch(t.type){case"LightOff":n=0;break;case"LightAlwaysOn":n=1;break;case"LightBreath":n=2;break;case"LightNeon":n=3;break;case"LightWave":n=4;break;case"LightDazzing":n=5;break;case"LightLaser":n=6;break;case"LightMusicFollow":n=7,r=t.option<<4|o;break;case"LightScreenColor":n=8;break;case"LightMusicFollow2":n=9,r=t.option<<4|o;break}if(e[0]=n,e[1]=this.MAXSPEED-t.speed,e[2]=t.bright,e[3]=r,"rgb"in t&&t.rgb!==void 0){let _=t.rgb;_===16777215&&(_=16449530);const E=D.numToRgb(_);e[4]=E.r,e[5]=E.g,e[6]=E.b}return t.type==="LightUserPicture"&&(e[4]=0,e[5]=200,e[6]=200),e};_decodedLogoLightBuf=t=>{};_encodeLogoLight=t=>new Uint8Array(8).fill(0);_decodedSleepBuf=t=>{const e={time_bt:120,time_24:120,deepTime_bt:1680,deepTime_24:1680},n=t[1]<<8|t[0],s=t[3]<<8|t[2],i=t[5]<<8|t[4],o=t[7]<<8|t[6];return e.time_bt=n,e.time_24=i,e.deepTime_bt=s,e.deepTime_24=o,e};_encodeSleep=t=>{const e=new Uint8Array(8);return e[0]=t.time_bt&255,e[1]=t.time_bt>>8,e[2]=t.deepTime_bt&255,e[3]=t.deepTime_bt>>8,e[4]=t.time_24&255,e[5]=t.time_24>>8,e[6]=t.deepTime_24&255,e[7]=t.deepTime_24>>8,e};setMouseOption0=async t=>{const e=new Uint8Array(64);e[0]=this.FEA_CMD_MOUSE_SET_OPTIONPARAM0,e[8]=t.profile,e[9]=this._encodeReportRate(t.currentReportRate),e[10]=t.debounce,e[11]=0;const n=t.mp?.lightOff?0:1,s=(t.mp?.wheelLightOff?1:0)<<1,i=(t.mp?.smooth?1:0)<<2,o=(t.mp?.ledSelect?1:0)<<3,_=(t.mp?.powerSaveMode?1:0)<<4|o|i|s|n;e[12]=_&255,e[13]=_>>8,e[14]=t.mp?.buttonChange??1,e[15]=t.mp?.wheelToButton??10,e[16]=t.mp?.buttonToWheel??10,e[17]=255,e[18]=8;const E=this._encodeLight(t.light);e.set(E,24);const c=this._encodeLogoLight(t.logoLight);e.set(c,32);const l=this._encodeSleep(t.sleep);e.set(l,40),e[50]=t.mp.xSensitivity??100,e[51]=t.mp.ySensitivity??100,e[52]=t.mp.liftCutOff??0,e[53]=t.mp.angelSnap?1:0;for(let M=0;M<t.batteryColors.length;M++){const T=D.numToRgb(t.batteryColors[M]);e[54+M*3]=T.r,e[55+M*3]=T.g,e[56+M*3]=T.b}e[54]=t.mp.FPS?1:0,e[60]=t.chargingSwitch?1:0;const h=await this.sendMsg(e,a.Bit7);return h&&await this.vendorSleep(),h};getMouseOption0=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_MOUSE_GET_OPTIONPARAM0]),a.Bit7);if(t===void 0)return;const e=t[8],n=this._decodedReportRate(t[9])??125,s=t[10],i=t[13]<<8|t[12],o={lightOff:!(i&1),wheelLightOff:!!(i&2),smooth:!!(i&4),ledSelect:!!(i&8),powerSaveMode:!!(i&16),buttonChange:t[14],wheelToButton:t[15],buttonToWheel:t[16],xSensitivity:t[50],ySensitivity:t[51],liftCutOff:t[52],angelSnap:t[53]===1,FPS:t[54]===1},r=this._decodedLightBuf(t.slice(24,32)),_=this._decodedLogoLightBuf(t.slice(32,40)),E=this._decodedSleepBuf(t.slice(40,48)),c=[];for(let h=0;h<2;h++){const M=t[54+h*3],T=t[55+h*3],u=t[56+h*3],C=D.rgbToNum(M,T,u);c.push(C)}const l=t[60]===1;return{profile:e,currentReportRate:n,mp:o,light:r,logoLight:_,debounce:s,sleep:E,batteryColors:c,chargingSwitch:l}};getMouseOption1=async t=>{const e=await this.commonMsg(new Uint8Array([this.FEA_CMD_MOUSE_GET_OPTIONPARAM1,t]),a.Bit7);if(e===void 0)return;const n=e[2]>8?0:e[2],s=e[3],i=[];for(let o=0;o<s;o++){const r=e[8+o*2]|e[9+o*2]<<8,_=e[24+o*2]|e[25+o*2]<<8,E=e[40+o*3]<<16|e[41+o*3]<<8|e[42+o*3];i.push({x:r,y:_,rgb:E})}return{current:n,dpis:i}};setMouseOption1=async(t,e,n)=>{const s=new Uint8Array(64);s[0]=this.FEA_CMD_MOUSE_SET_OPTIONPARAM1,s[1]=t,s[2]=e>8?0:e;const i=n.length;s[3]=i;for(let r=0;r<i;r++){const _=n[r].x;s[8+r*2]=_&255,s[9+r*2]=_>>8;const E=n[r].y;s[24+r*2]=E&255,s[25+r*2]=E>>8;const c=n[r].rgb,l=D.numToRgb(c);s[40+r*3]=l.r,s[41+r*3]=l.g,s[42+r*3]=l.b}const o=await this.sendMsg(s,a.Bit7);return o&&await this.vendorSleep(),o};setReportRate=async(t,e)=>{let n;switch(e){case 1e3:n=1;break;case 500:n=2;break;case 250:n=4;break;case 125:n=8;break;default:n=0;break}const s=new Uint8Array(8);s[0]=this.FEA_CMD_SET_REPORT,s[1]=t,s[2]=n;const i=await this.sendMsg(s,a.Bit7);return i&&await this.vendorSleep(),i};setCurrentProfile=async t=>{const e=new Uint8Array(8);e[0]=this.FEA_CMD_SET_PROFILE,e[1]=t;const n=await this.sendMsg(e,a.Bit7);return n&&await this.vendorSleep(),n};findIndexInDefaultMatrix=t=>{const e=Object.values(p);let n;e.includes(t)?n=y[t]:n=d.hidToMatrix(t);for(let s=0;s<this.defaultMatrix.length;s+=4)if(f(n,this.defaultMatrix.slice(s,s+4)))return s/4};setKeyConfigSimple=async(t,e,n)=>{const s=this.findIndexInDefaultMatrix(t.original);if(s===void 0)return!1;const i=d.configToMatrix(t),o=new Uint8Array(64);o[0]=this.FEA_CMD_MOUSE_SET_KEYMATRIX,o[1]=e,o[2]=s,o[8]=i[0],o[9]=i[1],o[10]=i[2],o[11]=i[3];const r=await this.sendMsg(o,a.Bit7);return r&&await this.vendorSleep(),r};configsToMatrix=(t,e)=>{const n=JSON.parse(JSON.stringify(e));for(let s of t){const i=this.findIndexInDefaultMatrix(s.original);if(i===void 0)continue;const o=d.configToMatrix(s);n[i*4+0]=o[0],n[i*4+1]=o[1],n[i*4+2]=o[2],n[i*4+3]=o[3]}return n};setKeyConfig=async(t,e,n)=>{const s=this.configsToMatrix(t,this.defaultMatrix);Math.ceil(s.length/56);const i=new Uint8Array(8);i[0]=this.FEA_CMD_SET_KEYMATRIX,i[1]=e,i[2]=64,i[3]=0;for(let o=0;o<2;o++){i[4]=o;let r=s.slice(o*56,(o+1)*56);if(r.length<56&&(r=[...r,...new Uint8Array(56-r.length)]),!await this.sendMsg(new Uint8Array([...i,...r]),a.Bit7))return!1}return await this.vendorSleep(),!0};_getKeyMatrix=async t=>{const e=new Uint8Array(8);e[0]=this.FEA_CMD_MOUSE_GET_KEYMATRIX,e[1]=t;const n=await this.commonMsg(e,a.Bit7);if(n!==void 0)return[...n]};getKeyConfig=async(t,e)=>{const n=await this._getKeyMatrix(t);return n===void 0?[]:d.matrixToConfigs(this.defaultMatrix,n)};_setMacro=async(t,e)=>{const n=new Uint8Array(8);n[0]=this.FEA_CMD_SET_MACRO_SIMPLE,n[1]=e;let s=0;for(let i=0;i<5;i++)t.slice(i*56,56+i*56).some(r=>r!==0)&&s++;for(let i=0;i<s;i++){n[2]=i,n[3]=56,n[4]=i===s-1?1:0;let o=t.slice(i*56,56+i*56);o.length<56&&(o=o.concat(new Array(56-o.length).fill(0)));const r=new Uint8Array([...n,...o]);if(!await this.sendMsg(r,a.Bit7))return!1}return await this.vendorSleep(),!0};setMacro=async(t,e)=>{const n=t.macro,s=new Uint8Array(256);let i=0;s.set([t.repeatCount&255,t.repeatCount>>8],0),i+=2;for(let o=0;o<n.length;o+=2){const r=n.slice(o,o+2),_=r[0],E=r[1];if(_.type==="delay"||E.type!=="delay")return!1;const c=m.macroEventToByte(_,E);s.set(c,i),i+=c.length}return await this._setMacro([...s],e)};buffToBulletValue=t=>{const e=[];let n=0,s=new Uint8Array(t.slice(n,n+3));for(n+=3;n<t.length&&(f([...s],[0,0,0])||e.push({delay:s[0],x:s[1],y:s[2]}),s=new Uint8Array(t.slice(n,n+3)),!f([...s],[0,0,0]));)n+=3;return e};_setGun=async(t,e)=>{const n=new Uint8Array(8);n[0]=this.FEA_CMD_SET_CONTROLRECOIL,n[1]=e;const s=Math.ceil(t.length/56);let i=1;for(let _=0;_<s;_++)t.slice(_*56,56+_*56).findIndex(l=>l!==0)!==-1&&(i=_+1);const o=[...t].slice((i-1)*56,(i-1)*56+56);let r=0;o.map((_,E)=>{_!==0&&(r=E+1)});for(let _=0;_<i;_++){n[2]=_,_===i-1&&(n[4]=1);let E=[...t].slice(_*56,56+_*56);E.length<56&&(E=E.concat(new Array(56-E.length).fill(0)));const c=Math.ceil(r/3)*3;n[3]=i>1&&_<i-1?56:_===0?c:c+1;const l=new Uint8Array([...n,...E]);if(!await this.sendMsg(l,a.Bit7))return!1}return await this.vendorSleep(),!0};setGun=async(t,e)=>{const n=new Uint8Array(256);let s=0;for(let i=0;i<t.length;i++){const o=t[i];n[s]=o.delay,s++,n[s]=o.x,s++,n[s]=o.y,s++}return await this._setGun(n,e)};getGun=async t=>{const e=new Uint8Array(64);e[0]=this.FEA_CMD_GET_CONTROLRECOIL,e[1]=t;let n=new Uint8Array;for(let s=0;s<4;s++){e[2]=s;const i=await this.commonMsg(e,a.Bit7);if(i===void 0)return;n=new Uint8Array([...n,...i])}return this.buffToBulletValue(n)};getUSBVersion=async()=>{const t=await this.commonMsg(new Uint8Array([this.FEA_CMD_GET_REV]),a.Bit7);if(t!==void 0)return t[2]<<8|t[1]};getRFVersion=async()=>{};getMledVersion=async()=>{};getOledVersion=async()=>{};setLightSetting(t){throw new Error("Method not implemented.")}getLightSetting(){throw new Error("Method not implemented.")}reset=async(t=!0)=>{if(t){const e=await this.sendMsg(new Uint8Array([this.FEA_CMD_SET_RESERT]),a.Bit7);return e&&await this.vendorSleep(),e}return!0};setCountDown=async t=>{const e=new Uint8Array(24);e[0]=this.FEA_CMD_SET_DOWNCOUNT,e[8]=t;const n=await this.sendMsg(e,a.Bit7);return n&&await this.vendorSleep(),n};getDeviceIsBoot=async()=>{if(this.deviceType.connect!=="usb")return!1;const t=await this.commonMsg(new Uint8Array([247]),a.Bit7);return t!==void 0&&t[7]===1&&t[8]===1};rfUpgrade=async(t,e)=>!1;mledUpgrade=async(t,e)=>!1;oledUpgrade=async(t,e)=>!1;flashUpgrade=async(t,e)=>!1;upgrade_dev=async(t,e,n,s)=>{const i=t.slice(n),o=64,r=Math.ceil(i.length/o),_=new Uint8Array(2);_[0]=r&255,_[1]=r>>8;const E=new Uint8Array(4);E[0]=i.length&255,E[1]=(i.length&65280)>>8,E[2]=(i.length&16711680)>>16,E[3]=(i.length&4278190080)>>24;const c=[186,192];_.map(A=>c.push(A)),E.slice(0,3).map(A=>c.push(A));let l,h=0;for(;l===void 0&&h<10;)l=await this.commonMsgByPath(new Uint8Array(c),a.None,e),h++,await S(1e3);if(l===void 0)return!1;for(let A=0;A<r;A++){const g=A*o>i.length?o-(A*o-i.length):o,O=i.slice(A*o,A*o+g);if(!await this.sendMsgByPath(O,a.None,e))return!1;s(A/r)}const M=L([...i]),T=new Uint8Array(4);T[0]=M&255,T[1]=(M&65280)>>8,T[2]=(M&16711680)>>16,T[3]=(M&4278190080)>>24;const u=[186,194];_.map(A=>u.push(A)),T.map(A=>u.push(A)),E.map(A=>u.push(A));const C=await this.commonMsgByPath(new Uint8Array(u),a.None,e,10,100);return C!==void 0&&C[4]===85};BOOT_INFOS=[{vid:12625,pid:16421}];boot_usb=async()=>{if(this.BOOT_INFOS.some(n=>n.vid===this.deviceType.vid&&n.pid===this.deviceType.pid))return this.deviceType.devAddr.toString();await this.sendMsg(new Uint8Array([127,85,170,85,170]),a.Bit7),await S(1e3*1);let t=0,e;for(;e===void 0&&t<100;)await S(500),e=w.devlistList.find(n=>n.oneofDev.oneofKind==="dev"&&n.oneofDev.dev.devType===R.YZWBoot),t++;if(!(e===void 0||e.oneofDev.oneofKind!=="dev"))return e.oneofDev.dev.path};upgrade=async(t,e)=>{e(0);const n=await this.boot_usb();if(n===void 0)return!1;const s=await this.upgrade_dev(t,n,65536,e);return e(1),s};getWangBaReset=async()=>{}}export{U as CommonMsPan1080};
