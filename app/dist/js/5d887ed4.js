import{s as B,V as i,u as W,a as L,r as c,c as n,i as j,d as f,y as d,j as e,e as s,k as O,f as I,l as M,U as A,m as ie,n as oe,o as ne,p as se,q as ae,t as le,v as pe,w as de,x as ce,z as fe,A as xe,C as ue}from"./index.b078bf5f.js";import{F as ge}from"./1021e8b2.js";import"./532dcef2.js";import"./0a36fd0f.js";const me=B(i)`
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`,ye=B(i)`
  @keyframes scaleIn {
    from {
      transform: scale(0.9);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
`,he=B.img`
  @keyframes fadeInZoom {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  animation: fadeInZoom 0.3s ease-in-out;
  max-width: 95%;
  max-height: 95%;
  object-fit: contain;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease;

  // &:hover {
  //   transform: scale(1.01);
  // }
`,we=B(i)`
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  animation: fadeIn 0.3s ease-in-out;
`,U=(t,C)=>{const x=t.split("."),u=C.split(".");if(x.length!==u.length||x.length<3)return!1;const k=Number(x[0])*1e5+Number(x[1])*1e3+Number(x[2]),F=Number(u[0])*1e5+Number(u[1])*1e3+Number(u[2]);return k>F},ke=()=>{W();const t=L(),[C,x]=c.useState(""),[u,k]=c.useState(""),[F,r]=c.useState(!1),[z,y]=c.useState(!1),[g,T]=c.useState(1),E=7,p=n.toastOptions,G=!j&&f.isUseIotSDK,[q,N]=c.useState(!1),[$,K]=c.useState(0),[X,R]=c.useState(!1);c.useEffect(()=>{!j&&f.webClientIotVersionFromIotConnector===""&&(async()=>await f.setWebClientIotVersionFromIotConnector())()},[]),c.useEffect(()=>{if(j){const{ipcRenderer:o}=window.require("electron");return o.send("getOpenAtLogin"),o.on("getOpenAtLogin",(_,h)=>{R(h)}),()=>{o.removeAllListeners("getOpenAtLogin")}}},[]);const Z=async()=>{if(!f.isUseIotSDK){y(!0),T(1);return}if(r(!0),n.getCurrentDevice().deviceType.connect!=="usb"){d.error(t.升级模式只能在有线模式下进行,p),r(!1);return}const o=n.getCurrentDevice().deviceType.id;if(o===void 0){d.error(t.获取不到版本,p),r(!1);return}const _=await A.getFwVersion(o);if(_.errCode!==0){d.info(t.当前设备固件为最新无需升级,p),r(!1);return}const h=_.data;if(j){const v=O;if(U(h.lowest_app_version_str,v)){d.error(t.当前固件版本过低,p),r(!1);return}}const m=h.version_str.match(/[^_]+/gi);if(m===null||m.length===0){d.error(t.获取不到版本,p),r(!1);return}const a=await A.downloadAllDevUpgradeFile(h);if(a===void 0||a.fw===void 0){d.error(t.获取不到版本,p),r(!1);return}const S=(v,l,V)=>{const H=(re=>re.match(/\d+/g)?.join("")||"")(v),D=n.getCurrentDevice().deviceType,ee=D.type==="dongle"&&(D.version.usb??0)>200,te=D.type==="dongle"&&(D.version.rf??0)>200;return(ee||te)&&(V===0||V===1)?parseInt(H,10)>(l||0):parseInt(H,16)>(l||0)},w=n.getCurrentDevice().deviceType.version,b=[];for(let v=0;v<m.length;v++)if(v===0)S(m[v],w.usb,0)&&b.push({method:"usb",file:a.fw});else{const l=m[v];l.includes("rfv")&&a.fwRF!==void 0&&S(l,w.rf,1)&&b.push({method:"rf",file:a.fwRF}),l.includes("nordicv")&&a.fwNordic!==void 0&&S(l,w.nordic)&&b.push({method:"nordic",file:a.fwNordic}),l.includes("mledv")&&a.fwMled!==void 0&&S(l,w.mled)&&b.push({method:"mled",file:a.fwMled}),l.includes("oledv")&&a.fwOled!==void 0&&S(l,w.oled)&&b.push({method:"oled",file:a.fwOled}),l.includes("flashv")&&a.fwFlash!==void 0&&S(l,w.flash)&&b.push({method:"flash",file:a.fwFlash})}if(b.length===0){d.info(t.当前设备固件为最新无需升级,p),r(!1);return}n.getCurrentDevice().设备升级.需要升级的列表=b,n.isShowFirmwareUpgradePage=!0,r(!1)},J=async()=>{const o=f.webClientIotVersionFromIotConnector;await f.getServerIotVersion().then(_=>{if(_===void 0){d.error(t.获取不到版本,p);return}const h=Number(o.replace("v","")),m=Number(_.replace("v",""));if(h>=m){d.info(t.当前IOT版本为最新无需升级,p);return}if(h<m){n.showDownloadIotPrompt=!0,n.iotPromptType="版本低";return}})},Q=async()=>{if(!j)return;const{app:o}=window.require("@electron/remote"),_=o.getAppPath(),h=ie.getPlatform();if(h==="mac"&&!_.includes("/Applications/")){d.error(t.驱动未拖到Applications目录下无法进行更新,p);return}const m=h==="mac"?"mac":"win",a=await A.getAppVersion(oe.currentCompany);if(a.errCode!==0){d.info(t.驱动已经是最新版本无需更新,p);return}if(U(a.data.lowest_version_str,O)){d.warn(t.当前驱动过低无法进行更新,p);return}if(!U(a.data.version_str,O)){d.info(t.当前驱动版本为最新无需升级,p);return}const S=a.data.file_path,w=await A.getIotVersion(m);let b;if(w.errCode===0){const l=m==="win"?xe:ue,V=w.data.iot_driver_version_str.match(/\d+/g)?.join("")||"";Number(V)>Number(l)&&(b={path:w.data.file_path,serverVersion:w.data.iot_driver_version_str})}if(N(!0),sessionStorage.setItem("appUpPath",S),!await A.upgradeSoftware(m,S,b,l=>{K(l)})){d.error(t.升级失败无法获取升级数据,p);return}d.success(t.驱动升级成功将自动重启,p),N(!1),await ne(1e3*3),o.relaunch(),o.quit()},Y=o=>{if(!j)return;R(o);const{ipcRenderer:_}=window.require("electron");_.send("setOpenAtLogin",o)},P=o=>{j&&(o?localStorage.setItem("isAutoHide","true"):localStorage.removeItem("isAutoHide"))};return c.useEffect(()=>{x(f.getFirmwareVersionDisplayStringFromDevice())},[n.getCurrentDevice().deviceType.id]),c.useEffect(()=>{k(f.webClientIotVersionDisplayString)},[f.webClientIotVersionDisplayString]),c.useEffect(()=>()=>{n.isShowFirmwareUpgradePage&&(n.isShowFirmwareUpgradePage=!1)},[]),c.useEffect(()=>{n.getCurrentDevice().设备升级.升级事件==="none_调用结束"&&n.getCurrentDevice().设备升级.state.progress>0&&n.getCurrentDevice().设备升级.state.errMsg===""?n.isShowFirmwareUpgradeSuccessDialogBeforeWelcomePage=!0:n.getCurrentDevice().设备升级.state.errMsg!==""&&(n.isShowFirmwareUpgradeSuccessDialogBeforeWelcomePage=!1,d.error(t.固件升级失败+" ("+t.错误码+": "+n.getCurrentDevice().设备升级.state.errMsg+")",p))},[n.getCurrentDevice().设备升级.升级事件]),e.jsxs(e.Fragment,{children:[e.jsxs(i,{type:"上下",w:"full",h:"full",style:{flex:"1 1 auto"},children:[e.jsxs(i,{type:"左右___主轴居中",w:j?1200:600,style:{flex:"1 1 0%",gap:"36px",padding:"36px"},children:[e.jsxs(i,{type:"上下",h:"full",style:{flex:"1 1 739px",background:"#FFFFFF",borderRadius:12},children:[e.jsx(i,{type:"左右___主轴居中",w:"full",h:77,style:{background:"linear-gradient(0deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), #3E3E3E",borderRadius:"12px 12px 0px 0px"},children:e.jsx(s,{type:"正文内容_黑底白字",style:{color:"#FFFFFF",fontSize:20,fontWeight:500},text:t.更新})}),e.jsxs(i,{type:"上下___交叉轴居左",w:"full",h:"full",style:{flex:"0 1 0%",padding:"0 43px",justifyContent:"flex-start"},children:[j&&e.jsxs(i,{type:"左右",w:"full",style:{flex:"0 1 auto",minHeight:"64px",justifyContent:"space-between",borderBottom:"1px solid var(--color-background-unimportant)",gap:"12px",padding:"12px 0"},children:[e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto"},children:e.jsx(s,{type:"正文内容",style:{fontSize:18,padding:"0 10px",wordBreak:"break-all",textAlign:"center"},text:t.驱动版本,width:150,wrap:!0})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"0 0 200px"},children:e.jsx(s,{type:"辅助内容",text:"V"+O+"_IOTV"+f.electronClientIotVersion,style:{padding:"0 10px",wordBreak:"break-all",textAlign:"center"},wrap:!0,width:180})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto",padding:"0 10px"},children:e.jsx(I,{w:180,text:t.检查更新,onClick:Q})})]}),e.jsxs(i,{type:"左右",w:"full",style:{flex:"0 1 auto",minHeight:"64px",justifyContent:"space-between",borderBottom:"1px solid var(--color-background-unimportant)",gap:"12px",padding:"12px 0"},children:[e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto"},children:e.jsx(s,{type:"正文内容",style:{fontSize:18,padding:"0 10px",wordBreak:"break-all",textAlign:"center"},text:t.固件版本,width:150,wrap:!0})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"0 0 200px"},children:e.jsx(s,{type:"辅助内容",style:{padding:"0 10px",wordBreak:"break-all",textAlign:"center"},wrap:!0,text:C,width:180})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto",padding:"0 10px"},children:e.jsx(I,{w:180,text:F?t.获取中:t.固件升级,onClick:Z,disabled:F})})]}),G&&e.jsxs(i,{type:"左右",w:"full",style:{flex:"0 1 auto",minHeight:"64px",justifyContent:"space-between",borderBottom:"1px solid var(--color-background-unimportant)",gap:"12px",padding:"12px 0"},children:[e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto"},children:e.jsx(s,{type:"正文内容",style:{fontSize:18,padding:"0 10px",wordBreak:"break-all",textAlign:"center"},text:t.IOT版本,width:150,wrap:!0})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"0 0 200px"},children:e.jsx(s,{type:"辅助内容",text:u,style:{padding:"0 10px",wordBreak:"break-all",textAlign:"center"},wrap:!0,width:180})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto",padding:"0 10px"},children:e.jsx(I,{w:180,text:t.检查更新,onClick:J,hidden:j})})]})]})]}),j&&e.jsxs(i,{type:"上下",h:"full",w:"40%",style:{flex:"1 1 500px",background:"#FFFFFF",borderRadius:12},children:[e.jsx(i,{type:"左右___主轴居中",w:"full",h:77,style:{background:"linear-gradient(0deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), #3E3E3E",borderRadius:"12px 12px 0px 0px"},children:e.jsx(s,{type:"正文内容_黑底白字",style:{color:"#FFFFFF",fontSize:20,fontWeight:500},text:t.启动选项})}),e.jsxs(i,{type:"上下___交叉轴居左",w:"full",h:"full",style:{flex:"0 1 0%",padding:"0 43px",justifyContent:"flex-start"},children:[e.jsxs(i,{type:"左右",w:"full",style:{flex:"0 1 auto",minHeight:"64px",justifyContent:"space-between",borderBottom:"1px solid var(--color-background-unimportant)",gap:"12px",padding:"12px 0"},children:[e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto",justifyContent:"flex-start"},children:e.jsx(s,{type:"正文内容",style:{fontSize:18,padding:"0 10px",wordBreak:"break-all",textAlign:"left"},text:t.开机启动,wrap:!0})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"0 0 auto",padding:"0 10px"},children:e.jsx(M,{value:X,onChange:Y,style:{marginLeft:"auto"}})})]}),e.jsxs(i,{type:"左右",w:"full",style:{flex:"0 1 auto",minHeight:"64px",justifyContent:"space-between",borderBottom:"1px solid var(--color-background-unimportant)",gap:"12px",padding:"12px 0"},children:[e.jsx(i,{type:"左右___主轴居中",style:{flex:"1 1 auto",justifyContent:"flex-start"},children:e.jsx(s,{type:"正文内容",style:{fontSize:18,padding:"0 10px",wordBreak:"break-word",textAlign:"left"},text:t.关闭时最小化到托盘不退出程序,wrap:!0})}),e.jsx(i,{type:"左右___主轴居中",style:{flex:"0 0 auto",padding:"0 10px"},children:e.jsx(M,{value:localStorage.getItem("isAutoHide")==="true",onChange:P,style:{marginLeft:"auto"}})})]})]})]})]}),n.isShowFirmwareUpgradePage&&e.jsx(ge,{}),z&&e.jsx(be,{currentPage:g,totalPages:E,onClose:()=>y(!1),onNextPage:()=>T(o=>Math.min(o+1,E)),onPrevPage:()=>T(o=>Math.max(o-1,1)),onStartInstall:()=>{f.showDownloadIotPrompt=!0}}),q&&e.jsxs(i,{type:"上下",w:"full",h:"full",style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.3)",zIndex:9999,justifyContent:"center",alignItems:"center",gap:"15px",cursor:"wait"},children:[e.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"5px solid #f3f3f3",borderTop:"5px solid #3498db",borderRadius:"50%",animation:"spinAnimation_2 1s linear infinite",transform:"scale(2)"}}),e.jsx(s,{type:"正文内容_黑底白字",text:`${Math.floor($*100)}%`,style:{fontSize:30}}),e.jsx(s,{type:"正文内容_黑底白字",text:t.驱动升级进度条文本,style:{fontSize:30}})]})]}),!1]})},be=({currentPage:t,totalPages:C,onClose:x,onNextPage:u,onPrevPage:k,onStartInstall:F})=>{W();const r=L();c.useEffect(()=>{const g=T=>{switch(T.key){case"Escape":x();break;case"ArrowRight":t<C&&u();break;case"ArrowLeft":t>1&&k();break;case"Enter":t===C?F():u();break}};return window.addEventListener("keydown",g),()=>{window.removeEventListener("keydown",g)}},[t,C,x,u,k,F]);const y=(()=>{switch(t){case 1:return{title:r.未检测到IOT,description:r.IOT安装说明,instruction:r.在下载驱动支持弹窗中点击下载对应操作系统的文件,imageStyle:{backgroundColor:"#f9f9f9",border:"1px solid #e8e8e8"},showImage:!0,imageSrc:fe};case 2:return{title:r.未检测到IOT,description:r.IOT安装说明,instruction:r.下载完成后可以看到应用程序iot_vXXXexe点击打开文件进行安装,imageStyle:{backgroundColor:"#f9f9f9",border:"1px solid #e8e8e8"},showImage:!0,imageSrc:ce};case 3:return{title:r.未检测到IOT,description:r.IOT安装说明,instruction:r.点击Next进行下一步,imageStyle:{backgroundColor:"#f9f9f9",border:"1px solid #e8e8e8"},showImage:!0,imageSrc:de};case 4:return{title:r.未检测到IOT,description:r.IOT安装说明,instruction:r.点击Install进行安装,imageStyle:{backgroundColor:"#f9f9f9",border:"1px solid #e8e8e8"},showImage:!0,imageSrc:pe};case 5:return{title:r.未检测到IOT,description:r.IOT安装说明,instruction:r.点击Finish完成安装,imageStyle:{backgroundColor:"#f9f9f9",border:"1px solid #e8e8e8"},showImage:!0,imageSrc:le};case 6:return{title:r.未检测到IOT,description:r.IOT安装说明,instruction:r.完成以后刷新网页即可进入驱动,imageStyle:{backgroundColor:"#f9f9f9",border:"1px solid #e8e8e8"},showImage:!0,imageSrc:ae};case 7:return{title:r.未检测到IOT,description:r.IOT安装说明,instruction:r.安装时报错缺失VCRUNTIME140dll,imageStyle:{backgroundColor:"#f9f9f9",border:"1px solid #e8e8e8"},showImage:!0,imageSrc:se};default:return{title:"",description:"",instruction:"",imageStyle:{},showImage:!1,imageSrc:""}}})();return e.jsx(me,{type:"左右___主轴居中",w:"full",h:"full",style:{position:"fixed",top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,display:"flex",justifyContent:"center",alignItems:"center",padding:"20px",animationName:"fadeIn",animationDuration:"0.3s",animationTimingFunction:"ease-in-out"},onClick:x,children:e.jsxs(ye,{type:"上下",w:"950px",h:"700px",style:{maxWidth:"90vw",maxHeight:"90vh",minHeight:"400px",backgroundColor:"#FFFFFF",borderRadius:"16px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",overflow:"hidden",position:"relative",animationName:"scaleIn",animationDuration:"0.3s",animationTimingFunction:"ease-in-out"},onClick:g=>{g.stopPropagation()},children:[e.jsx(i,{type:"左右___主轴居中",w:30,h:30,style:{position:"absolute",top:"10px",right:"10px",borderRadius:"15px",cursor:"pointer",zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.05)",transition:"background-color 0.2s"},onMouseEnter:g=>{g.currentTarget&&(g.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)")},onMouseLeave:g=>{g.currentTarget&&(g.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.05)")},onClick:x,children:e.jsx(s,{type:"正文内容",text:"×",style:{fontSize:"24px",fontWeight:"bold",color:"#333"}})}),e.jsxs(i,{type:"上下",w:"full",style:{padding:"35px 40px",flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(i,{type:"上下",w:"full",style:{marginBottom:"20px"},children:[e.jsx(s,{type:"一级标题栏_高亮",text:y.title,style:{fontSize:"clamp(16px, 2vw, 18px)",fontWeight:"bold",color:"#333",marginBottom:"10px",lineHeight:1.4},wrap:!0}),e.jsx(s,{type:"正文内容",text:y.description,style:{fontSize:"clamp(14px, 1.8vw, 16px)",color:"#666",lineHeight:1.4}})]}),e.jsxs(we,{type:"上下",w:"full",style:{flex:1,justifyContent:"flex-start",alignItems:"center",padding:"10px 0"},children:[e.jsx(s,{type:"正文内容",text:y.instruction,style:{fontSize:"clamp(14px, 1.8vw, 16px)",color:"#333",marginBottom:"20px",alignSelf:"flex-start",lineHeight:1.5},wrap:!0}),e.jsx(i,{type:"左右___主轴居中",w:"full",h:"390px",style:{flex:"0 0 auto",backgroundColor:"#f9f9f9",borderRadius:"12px",marginBottom:"20px",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",transition:"all 0.3s ease",padding:"20px",boxShadow:"inset 0 0 10px rgba(0, 0, 0, 0.03)",...y.imageStyle},children:y.showImage?e.jsxs(i,{type:"上下",w:"full",h:"full",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx(he,{src:y.imageSrc,alt:`IOT安装指引步骤${t}截图`,style:{maxWidth:"95%",maxHeight:t===7?"70%":"95%",objectFit:"contain",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",marginBottom:t===7?"20px":"0"}},y.imageSrc),t===7&&e.jsxs(i,{type:"上下",w:"full",style:{display:"flex",flexDirection:"column",gap:"15px",padding:"0 20px"},children:[e.jsx(s,{type:"正文内容",text:r.下载运行库,style:{fontSize:"16px",fontWeight:"bold",color:"#333",alignSelf:"center",marginBottom:"5px"}}),e.jsxs(i,{type:"左右",w:"full",style:{justifyContent:"center",gap:"20px"},children:[e.jsx(I,{text:r.VC_redistx86exe32位,onClick:()=>{window.open(f.vcredistx86DownloadUrl)},hidden:!1,style:{minWidth:"200px"}}),e.jsx(I,{text:r.VC_redistx64exe64位,onClick:()=>{window.open(f.vcredistx64DownloadUrl)},hidden:!1,style:{minWidth:"200px"}})]})]})]}):e.jsxs(i,{type:"上下",style:{textAlign:"center",padding:"20px"},children:[e.jsx(s,{type:"正文内容",text:`步骤 ${t}`,style:{fontSize:"clamp(16px, 2vw, 20px)",fontWeight:"bold",color:"#333",marginBottom:"10px"}}),e.jsx(s,{type:"正文内容",text:y.instruction,style:{fontSize:"clamp(14px, 1.8vw, 16px)",color:"#666"},wrap:!0})]})})]},t),e.jsxs(i,{type:"左右",w:"full",style:{justifyContent:"space-between",alignItems:"center",padding:"15px 0 5px",marginTop:"auto",borderTop:"1px solid #f0f0f0",paddingTop:"20px"},children:[e.jsx(s,{type:"正文内容",text:`${t}/${C}`,style:{fontSize:"clamp(14px, 1.8vw, 16px)",color:"#666",fontWeight:"500"}}),e.jsx(i,{type:"左右",style:{gap:"10px"},children:t===C?e.jsxs(e.Fragment,{children:[e.jsx(I,{text:r.上一页,onClick:k,hidden:!1}),e.jsx(I,{text:r.开始安装IOT,onClick:F,hidden:!1})]}):t>1?e.jsxs(e.Fragment,{children:[e.jsx(I,{text:r.上一页,onClick:k,hidden:!1}),e.jsx(I,{text:r.下一页,onClick:u,hidden:!1})]}):e.jsx(I,{text:r.下一页,onClick:u,hidden:!1})})]})]})]})})};export{ke as Page_更多页};
