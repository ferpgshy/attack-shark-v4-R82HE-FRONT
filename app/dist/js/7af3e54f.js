import{ad as U,ae as S,af as R,ag as m,ah as _,ai as c,aj as B,ak as M,al as b,N as D,am as O,an as N}from"./index.b078bf5f.js";class L extends U{type="mouse";Get_获取所有按键=129;Get_获取当前profile=130;Get_获取指定宏=131;Get_获取去抖时间=132;Get_获取滚轮按键抬起时间=133;Get_获取24G睡眠时间=134;Get_获取蓝牙睡眠时间=135;Get_获取回报率=136;Get_获取压枪宏=137;Get_获取电量=138;Get_获取鼠标版本和ID=143;Get_获取SENSORDPI参数=144;Get_获取SNEDOR静默高度=145;Get_获取SNEDOR直线修复=146;Get_获取SNEDOR纹波修复=147;Get_获取SNEDORMOTION同步=148;Get_获取所有参数0=159;Get_设置SNEDORFPS20000=149;Get_CountDown=139;Get_鼠标灯效参数=151;Set_设置指定按键=0;Set_设置所有按键=1;Set_设置当前profile=2;Set_设置指定宏=3;Set_设置去抖时间=4;Set_设置滚轮按键抬起时间=5;Set_设置24G睡眠时间=6;Set_设置蓝牙睡眠时间=7;Set_设置回报率=8;Set_设置压枪宏=9;Set_设置鼠标复位=14;Set_设置SENSORDPI参数=16;Set_设置SNEDOR静默高度=17;Set_设置SNEDOR直线修复=18;Set_设置SNEDOR纹波修复=19;Set_设置SNEDORMOTION同步=20;Set_设置所有参数0=31;Set_设置SNEDORFPS20000=21;Set_CountDown=11;Set_鼠标灯效参数=23;defaultMatrix=[1,0,240,0,1,0,241,0,1,0,242,0,1,0,244,0,1,0,243,0,20,0,0,0,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,249,1,1,0,249,255,1,0,245,1,1,0,245,255];findIndexInDefaultMatrix=t=>{const e=Object.values(S);let i;e.includes(t)?i=R[t]:i=m.hidToMatrix(t);for(let n=0;n<this.defaultMatrix.length;n+=4)if(_(i,this.defaultMatrix.slice(n,n+4)))return n/4};configsToMatrix=(t,e)=>{const i=JSON.parse(JSON.stringify(e));for(let n of t){const s=this.findIndexInDefaultMatrix(n.original);if(s===void 0)continue;const r=m.configToMatrix(n);i[s*4+0]=r[0],i[s*4+1]=r[1],i[s*4+2]=r[2],i[s*4+3]=r[3]}return i};_encodedReportRate=t=>{switch(t){case 8e3:return 129;case 4e3:return 130;case 2e3:return 132;case 1e3:return 1;case 500:return 2;case 250:return 4;case 125:return 8}};_decodedReportRate=t=>{switch(t){case 129:return 8e3;case 130:return 4e3;case 132:return 2e3;case 1:return 1e3;case 2:return 500;case 4:return 250;case 8:return 125;default:return}};setKeyConfigSimple=async(t,e,i)=>{const n=this.findIndexInDefaultMatrix(t.original);if(n===void 0)return!1;const s=m.configToMatrix(t),r=new Uint8Array(64);r[0]=this.Set_设置指定按键,r[1]=n,r[8]=s[0],r[9]=s[1],r[10]=s[2],r[11]=s[3];const a=await this.sendMsg(r,c.Bit7);return a&&await this.vendorSleep(),a};setKeyConfig=async(t,e,i)=>{const n=this.configsToMatrix(t,this.defaultMatrix);Math.ceil(n.length/56);const s=new Uint8Array(8);s[0]=this.Set_设置所有按键,s[1]=e;for(let r=0;r<2;r++){s[2]=r;let a=n.slice(r*56,(r+1)*56);if(a.length<56&&(a=[...a,...new Uint8Array(56-a.length)]),!await this.sendMsg(new Uint8Array([...s,...a]),c.Bit7))return!1}return await this.vendorSleep(),!0};_getKeyMatrix=async t=>{const e=new Uint8Array(8);e[0]=this.Get_获取所有按键,e[1]=t,e[2]=1;const i=await this.commonMsg(e,c.Bit7);if(i!==void 0)return[...i]};getKeyConfig=async(t,e)=>{const i=await this._getKeyMatrix(t);return i===void 0?[]:m.matrixToConfigs(this.defaultMatrix,i)};setCurrentProfile=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置当前profile,t??0]),c.Bit7);return e&&await this.vendorSleep(),e};getCurrentProfile=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取当前profile]),c.Bit7);if(t!==void 0)return t[1]};_setMacro=async(t,e)=>{const i=new Uint8Array(8);i[0]=this.Set_设置指定宏,i[1]=e;let n=0;for(let s=0;s<5;s++)t.slice(s*56,(s+1)*56).some(a=>a!==0)&&n++;for(let s=0;s<n;s++){i[2]=s,i[3]=56,i[4]=s===n-1?1:0;let r=[...t.slice(s*56,(s+1)*56)];if(r.length<56&&(r=[...r,...new Uint8Array(56-r.length)]),!await this.sendMsg(new Uint8Array([...i,...r]),c.Bit7))return!1}return await this.vendorSleep(),!0};setMacro=async(t,e)=>{const i=t.macro,n=new Uint8Array(256);let s=0;n.set([t.repeatCount&255,t.repeatCount>>8],0),s+=2;for(let r=0;r<i.length;r+=2){const a=i.slice(r,r+2),o=a[0],l=a[1];if(o.type==="delay"||l.type!=="delay")return!1;const u=B.macroEventToByte(o,l);n.set(u,s),s+=u.length}return await this._setMacro([...n],e)};buffToMacroEvents=t=>{const e=[],i=new DataView(t.buffer).getUint16(0,!0);let n=2,s=t.slice(n,n+4);for(n+=4;n<t.length;){if(s[0]===249){const r=new Int8Array(s.buffer);e.push({type:"mouse_move",dx:r[2],dy:r[3]});let a=0;if(s[1]!==0)a=s[1]>>1;else{const o=t.slice(n,n+2);n+=2,a=new DataView(o.buffer).getUint16(0,!0)}e.push({type:"delay",value:a})}else{if(s[0]<=239&&s[0]>=4)e.push({type:"keyboard",action:s[1]<=127?"up":"down",value:s[0]});else{let a;switch(s[0]){case 240:a=S.Left;break;case 241:a=S.Right;break;case 242:a=S.Middle;break;case 243:a=S.Back;break;case 244:a=S.Forward;break}a!==void 0&&e.push({type:"mouse_button",action:s[1]<=127?"up":"down",value:a})}let r=0;s[1]&127?(r=s[1]&127,n-=2):r=new DataView(s.buffer).getUint16(2,!0),e.push({type:"delay",value:r})}if(s=t.slice(n,n+4),_([...s],[0,0,0,0]))break;n+=4}return{macroEvents:e.filter(r=>!(r.type==="delay"&&r.value===0)),repeatCount:i}};getMacro=async t=>{let e=new Uint8Array(0);const i=new Uint8Array(64);i[0]=this.Get_获取指定宏,i[1]=t;for(let n=0;n<4;n++){i[2]=n;const s=await this.commonMsg(i,c.Bit7);if(s===void 0)return;if(e=new Uint8Array([...e,...s]),G([...s]))break}return this.buffToMacroEvents(e)};setDeBounce=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置去抖时间,t]),c.Bit7);return e&&await this.vendorSleep(),e};getDeBounce=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取去抖时间]),c.Bit7);if(t!==void 0)return t[1]};setScrollUpTime=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置滚轮按键抬起时间,t]),c.Bit7);return e&&await this.vendorSleep(),e};getScrollUpTime=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取滚轮按键抬起时间]),c.Bit7);if(t!==void 0)return t[1]};set24GSleepTime=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置24G睡眠时间,t&255,t>>8]),c.Bit7);return e&&await this.vendorSleep(),e};get24GSleepTime=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取24G睡眠时间]),c.Bit7);return t===void 0?void 0:t[1]|t[2]<<8};setBtSleepTime=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置蓝牙睡眠时间,t&255,t>>8]),c.Bit7);return e&&await this.vendorSleep(),e};getBtSleepTime=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取蓝牙睡眠时间]),c.Bit7);return t===void 0?void 0:t[1]|t[2]<<8};setReportRate=async t=>{const e=this._encodedReportRate(t),i=await this.sendMsg(new Uint8Array([this.Set_设置回报率,e]),c.Bit7);return i&&await this.vendorSleep(),i};getReportRate=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取回报率]),c.Bit7);return t===void 0?void 0:this._decodedReportRate(t[1])};buffToBulletValue=t=>{const e=[];let i=0,n=new Uint8Array(t.slice(i,i+3));for(i+=3;i<t.length&&(_([...n],[0,0,0])||e.push({delay:n[0],x:n[1],y:n[2]}),n=new Uint8Array(t.slice(i,i+3)),!_([...n],[0,0,0]));)i+=3;return e};_setGun=async(t,e)=>{const i=new Uint8Array(8);i[0]=this.Set_设置压枪宏,i[1]=e;const n=Math.ceil(t.length/56);let s=1;for(let o=0;o<n;o++)t.slice(o*56,56+o*56).findIndex(f=>f!==0)!==-1&&(s=o+1);const r=[...t].slice((s-1)*56,(s-1)*56+56);let a=0;r.map((o,l)=>{o!==0&&(a=l+1)});for(let o=0;o<s;o++){i[2]=o,o===s-1&&(i[4]=1);let l=[...t].slice(o*56,56+o*56);l.length<56&&(l=l.concat(new Array(56-l.length).fill(0)));const u=Math.ceil(a/3)*3;i[3]=s>1&&o<s-1?56:o===0?u:u+1;const f=new Uint8Array([...i,...l]);if(!await this.sendMsg(f,c.Bit7))return!1}return await this.vendorSleep(),!0};setGun=async(t,e)=>{const i=new Uint8Array(256);let n=0;for(let s=0;s<t.length;s++){const r=t[s];i[n]=r.delay,n++,i[n]=r.x,n++,i[n]=r.y,n++}return await this._setGun(i,e)};getGun=async t=>{const e=new Uint8Array(64);e[0]=this.Get_获取压枪宏,e[1]=t;let i=new Uint8Array;for(let n=0;n<4;n++){e[2]=n;const s=await this.commonMsg(e,c.Bit7);if(s===void 0)return;i=new Uint8Array([...i,...s])}return this.buffToBulletValue(i)};reset=async(t=!0)=>{if(t){const e=await this.sendMsg(new Uint8Array([this.Set_设置鼠标复位]),c.Bit7);return e&&await this.vendorSleep(300),e}return!0};getUSBVersion=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取鼠标版本和ID]),c.Bit7);if(t!==void 0)return t[5]|t[6]<<8};setDPI=async(t,e,i)=>{const n=new Uint8Array(64);n[0]=this.Set_设置SENSORDPI参数,n[1]=t,n[2]=e;const s=i.length;n[3]=s;for(let a=0;a<s;a++){const o=i[a].x;n[8+a*2]=o&255,n[9+a*2]=o>>8;const l=i[a].y;n[24+a*2]=l&255,n[25+a*2]=l>>8;const u=i[a].rgb,f=M.numToRgb(u);n[40+a*3]=f.r,n[41+a*3]=f.g,n[42+a*3]=f.b}const r=await this.sendMsg(n,c.Bit7);return r&&await this.vendorSleep(),r};getDPI=async(t=0)=>{const e=await this.commonMsg(new Uint8Array([this.Get_获取SENSORDPI参数,t]),c.Bit7);if(e===void 0)return;const i=e[2],n=8,s=[];for(let r=0;r<n;r++){const a=e[8+r*2]|e[9+r*2]<<8,o=e[24+r*2]|e[25+r*2]<<8,l=e[40+r*3]<<16|e[41+r*3]<<8|e[42+r*3];s.push({x:a,y:o,rgb:l})}return{current:i,dpis:s}};setSilentHeight=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置SNEDOR静默高度,t]),c.Bit7);return e&&await this.vendorSleep(),e};getSilentHeight=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取SNEDOR静默高度]),c.Bit7);if(t!==void 0)return t[1]};setLineRepair=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置SNEDOR直线修复,t?1:0]),c.Bit7);return e&&await this.vendorSleep(),e};getLineRepair=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取SNEDOR直线修复]),c.Bit7);if(t!==void 0)return t[1]===1};setWaveRepair=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置SNEDOR纹波修复,t?1:0]),c.Bit7);return e&&await this.vendorSleep(),e};getWaveRepair=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取SNEDOR纹波修复]),c.Bit7);if(t!==void 0)return t[1]===1};setMotionSync=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置SNEDORMOTION同步,t?1:0]),c.Bit7);return e&&await this.vendorSleep(),e};getMotionSync=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取SNEDORMOTION同步]),c.Bit7);if(t!==void 0)return t[1]===1};setAllParams0=async(t,e,i,n,s,r,a,o,l,u,f)=>{const h=new Uint8Array(64);h[0]=this.Set_设置所有参数0,h[8]=t,h[9]=e,h[10]=i,h[11]=n&255,h[12]=n>>8,h[13]=s&255,h[14]=s>>8,h[15]=this._encodedReportRate(r),h[16]=a,h[17]=o?1:0,h[18]=l?1:0,h[19]=u?1:0;for(let g=0;g<8;g++)h[20+g]=this._encodedReportRate(f[g]);const y=await this.sendMsg(h,c.Bit7);return y&&await this.vendorSleep(),y};getAllParams0=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_获取所有参数0]),c.Bit7);if(t===void 0)return;const e=t[8],i=t[9],n=t[10],s=t[11]|t[12]<<8,r=t[13]|t[14]<<8,a=this._decodedReportRate(t[15])??125,o=t[16],l=t[17]===1,u=t[18]===1,f=t[19]===1,h=[];for(let y=0;y<8;y++){const g=this._decodedReportRate(t[20+y])??125;h.push(g)}return{profile:e,debounce:i,scrollUpTime:n,sleepTime_24:s,sleepTime_bt:r,currentReportRate:a,silentHeight:o,lineRepair:l,waveRepair:u,motionSync:f,listReportRate:h}};BOOT_INFOS=[{vid:12625,pid:20539},{vid:12625,pid:20548}];setSNEDORFPS20000=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_设置SNEDORFPS20000,t?1:0]),c.Bit7);return e&&await this.vendorSleep(),e};getSNEDORFPS20000=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_设置SNEDORFPS20000]),c.Bit7);if(t!==void 0)return t[1]===1};setCountDown=async t=>{const e=await this.sendMsg(new Uint8Array([this.Set_CountDown,t]),c.Bit7);return e&&await this.vendorSleep(),e};getCountDown=async()=>{const t=await this.commonMsg(new Uint8Array([this.Get_CountDown]),c.Bit7);if(t!==void 0)return t[1]};MAXSPEED=4;NORMAL=7;DAZZLE=8;COMMONCOLOR={0:16711680,1:16744703,2:16776960,3:65280,4:65535,5:255,6:16711935};setMouseLightParam=async(t,e)=>{const i=new Uint8Array(64);i[0]=this.Set_鼠标灯效参数,i[7]=255-i[0],i[8]=t?0:1;let n=0;const r=e.dazzle?this.DAZZLE:this.NORMAL;let a=e.option<<4|r;switch(e.type){case"LightOff":n=0;break;case"LightAlwaysOn":n=1;break;case"LightBreath":n=2;break;case"LightNeon":n=3;break;case"LightWave":n=4;break;case"LightSnake":n=5;break}if(i[9]=n,i[10]=this.MAXSPEED-e.speed,i[11]=e.bright,i[12]=a,"rgb"in e&&e.rgb!==void 0){let l=e.rgb;l===16777215&&(l=16449530);const u=M.numToRgb(l);i[13]=u.r,i[14]=u.g,i[15]=u.b}e.type==="LightUserPicture"&&(i[13]=0,i[14]=200,i[15]=200);const o=await this.sendMsg(i,c.Bit7);return await this.vendorSleep(),!!o};getMouseLightParam=async()=>{const t=new Uint8Array(64);t[0]=this.Get_鼠标灯效参数;const e=await this.commonMsg(t,c.Bit7);if(e===void 0)return;const i=e[1]===0,n=e[2],s=this.MAXSPEED-e[3],r=e[4],a=e[5];let o=M.rgbToNum(e[6],e[7],e[8]);const l=a>>4,u=a&15,f=d=>{if(d===this.DAZZLE||d===this.NORMAL)return;const v=this.COMMONCOLOR[d];v!==void 0&&(o=v)},h=u===this.DAZZLE,y=u===0;o===16449530&&(o=16777215);const w={0:{type:"LightOff",option:0},1:{type:"LightAlwaysOn",option:0},2:{type:"LightBreath",option:0},3:{type:"LightNeon",option:l},4:{type:"LightWave",option:l},5:{type:"LightSnake",option:l}}[n];if(w!==void 0)return f(u),{open:i,type:w.type,option:l,bright:r,speed:s,rgb:o,dazzle:w.type==="LightMusicFollow3"||w.type==="LightMusicFollow2"?y:h}};boot_usb=async()=>{if(this.BOOT_INFOS.some(i=>i.vid===this.deviceType.vid&&i.pid===this.deviceType.pid))return this.deviceType.devAddr.toString();await this.sendMsg(new Uint8Array([127,85,170,85,170]),c.Bit7),await b(1e3*1);let t=0,e;for(;e===void 0&&t<100;)await b(500),e=D.devlistList.find(i=>i.oneofDev.oneofKind==="dev"&&i.oneofDev.dev.devType===O.YZWBoot),t++;if(!(e===void 0||e.oneofDev.oneofKind!=="dev"))return e.oneofDev.dev.path};upgrade=async(t,e)=>{e(0);const i=await this.boot_usb();if(i===void 0)return!1;const n=t.slice(20480),s=64,r=Math.ceil(n.length/s),a=new Uint8Array(2);a[0]=r&255,a[1]=r>>8;const o=new Uint8Array(4);o[0]=n.length&255,o[1]=(n.length&65280)>>8,o[2]=(n.length&16711680)>>16,o[3]=(n.length&4278190080)>>24;const l=[186,192];a.map(d=>l.push(d)),o.slice(0,3).map(d=>l.push(d));let u,f=0;for(;u===void 0&&f<10;)u=await this.commonMsgByPath(new Uint8Array(l),c.None,i),f++,await b(50);if(u===void 0)return!1;for(let d=0;d<r;d++){const v=d*s>n.length?s-(d*s-n.length):s,A=n.slice(d*s,d*s+v);if(!await this.sendMsgByPath(A,c.None,i))return!1;e(d/r)}const h=N([...n]),y=new Uint8Array(4);y[0]=h&255,y[1]=(h&65280)>>8,y[2]=(h&16711680)>>16,y[3]=(h&4278190080)>>24;const g=[186,194];a.map(d=>g.push(d)),y.map(d=>g.push(d)),o.map(d=>g.push(d));const w=await this.commonMsgByPath(new Uint8Array(g),c.None,i,50,10);return w!==void 0&&w[4]===85};mledUpgrade=async(t,e)=>!1;rfUpgrade=async(t,e)=>!1;oledUpgrade=async(t,e)=>!1;flashUpgrade=async(t,e)=>!1;getRFVersion=async()=>{};getMledVersion=async()=>{};getOledVersion=async()=>{};getDeviceIsBoot=async()=>!1;setLightSetting=async t=>!0;getLightSetting=async()=>{};setSideLightSetting(t){throw new Error("Method not implemented.")}getSideLightSetting(){throw new Error("Method not implemented.")}}const G=p=>{for(let t=0;t<=p.length-4;t++)if(p[t]===0&&p[t+1]===0&&p[t+2]===0&&p[t+3]===0)return!0;return!1};export{L as CommonMSCH585};
