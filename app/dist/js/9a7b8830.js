import{j as e,V as s,u as K,a as z,c as h,d as t,b as N,K as $,r as i,e as k,a1 as Z,B as ee,y as R,F as ae,Q as U,aS as Y,G as ne,a4 as O,a5 as T,I as V,aT as M,H as B,M as ie,g as oe,aU as re,aV as le,aI as W,P as H,灯 as w}from"./index.b078bf5f.js";import{L as te}from"./82287d97.js";import{a as se,C as ce}from"./d7c9df92.js";import{Menu_LightSettingLayerDropDown as ue}from"./22aa6283.js";import{SaveToMyWorksDialog as de}from"./1e24668b.js";import{R as G}from"./18d64e70.js";import{F as ge}from"./f3820c06.js";import{u as pe,D as fe,a as he}from"./e46f8f92.js";import{S as ye}from"./9cc765b4.js";import{P as xe}from"./6420baa3.js";import"./3ce44458.js";import"./eb259a23.js";import"./532dcef2.js";const J=o=>e.jsx(s,{type:"上下",w:"full",h:o.h}),Q=()=>{K();const o=z(),n=h.getCurrentDevice(),d=t.isUseIotSDK,a=n.其他设置.省电模式是否开启,l=N($.LightEffects),C=Object.keys(n.light.data),j=[...C.filter(x=>x&&x!=="LightUserPicture"&&x!=="LightMusicFollow2"&&x!=="LightScreenColor")];Array.from(["LightUserPicture","LightMusicFollow2","LightScreenColor"]).forEach(x=>{C.includes(x)&&j.push(x)});const m=!t.isUseIotSDK&&(n.light.lightType==="LightMusicFollow2"||n.light.lightType==="LightScreenColor")?n.deviceType?.lightLayout?.types[0]?.type:n.light.lightType,[D,S]=i.useState(m);i.useEffect(()=>{if(!d&&(n.light.lightType==="LightMusicFollow2"||n.light.lightType==="LightScreenColor")){n.light.lightType=n.deviceType?.lightLayout?.types[0]?.type;return}},[d]),i.useEffect(()=>{S(n.light.lightType)},[n.light.lightType]);const[c,I]=i.useState({has_color:n.light.data[m]?.has_color??!1,color_type:n.light.data[m]?.color_type??"单色",color_value:t.getCurrentDevice()?.light.data[m]?.color_value??0,速度_max:n.light.data[m]?.速度_max??0,速度_value:n.light.data[m]?.速度_value??0,亮度_max:n.light.data[m]?.亮度_max??0,亮度_value:n.light.data[m]?.亮度_value??0,option_arr:n.light.data[m]?.option_arr??[],option_value:n.light.data[m]?.option_value??0});i.useEffect(()=>{if(!n)return;const x=n.light.data[n.light.lightType];x&&I(x)},[n.light.data[D],D]);const[v,b]=i.useState(!1),E=()=>{t.getCurrentDevice().deviceType.isBoot||(localStorage.setItem(ae.WebLoaclKey.IOTSwitch,"true"),location.reload())};return e.jsxs(e.Fragment,{children:[e.jsxs(s,{type:"上下",w:"full",h:"full",style:{},children:[e.jsx(s,{type:"左右___主轴居中",children:e.jsxs(s,{type:"上下",children:[e.jsx(s,{h:20}),e.jsx(s,{type:"左右",w:"full",h:"full",style:{backgroundColor:"#F5F5F5"},children:l})]})}),e.jsx(s,{w:70}),e.jsxs(s,{type:"左右",w:"full",h:"full",style:{padding:"20px",overflow:"auto"},children:[e.jsxs(s,{type:"上下",w:"full",h:"full",style:{flex:2},children:[e.jsx(s,{type:"上下___交叉轴居左",w:"full",h:40,style:{borderBottom:"1px solid rgba(0,0,0,0.4)"},children:e.jsx(k,{type:"小标题",text:o.灯效})}),e.jsx(s,{w:"full",h:10}),e.jsxs(s,{type:"上下",w:"full",h:"full",style:{borderRight:"1px solid rgba(0,0,0,0.4)",overflow:"auto"},children:[e.jsx(Z,{children:j.map((x,P)=>e.jsx(ee,{disabled:a,text:o[x],isCurrent:D===x,onClick:()=>{if(a){R.error(o.省电模式下无法设置灯效||"省电模式下无法设置灯效",h.toastOptions);return}if(!d&&(x==="LightMusicFollow2"||x==="LightScreenColor")){b(!0);return}n.light.lightType=x},w:120,h:40,style:{display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"2px",gap:"5px",margin:"10px"}},x))}),!d&&e.jsx(k,{type:"提示文本",text:o.音乐律动和光影只能在IOT模式下运行||"音乐律动和光影只能在IOT模式下运行"})]})]}),e.jsxs(s,{type:"上下",w:"full",h:"full",style:{flex:1},children:[e.jsx(s,{type:"上下___交叉轴居左",w:"full",h:40,style:{borderBottom:"1px solid rgba(0,0,0,0.4)"},children:e.jsx(k,{type:"小标题",text:o.灯光编辑})}),e.jsxs(s,{type:"上下",w:"full",h:"full",style:{gap:"10px",padding:"10px 20px",overflow:"auto"},children:[e.jsx(k,{type:"小标题",text:o.颜色}),e.jsx(se,{currentLightData:c,type:"light"}),e.jsx(te,{type:"light"})]})]})]})]}),v&&e.jsx(me,{onClose:()=>b(!1),onTurnOnIot:E})]})},me=({onClose:o,onTurnOnIot:n})=>{K();const d=z();return e.jsx(s,{type:"左右___主轴居中",w:"full",h:"full",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:o,children:e.jsx(s,{type:"上下",w:"470px",style:{backgroundColor:"#3E3E3E",borderRadius:"12px",padding:"24px",position:"relative",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",animationName:"scaleIn",animationDuration:"0.3s",animationTimingFunction:"ease-out"},onClick:a=>{a.stopPropagation()},children:e.jsxs(s,{type:"上下",w:"422px",style:{minHeight:"205px"},children:[e.jsxs(s,{type:"左右",w:"full",style:{zIndex:10},children:[e.jsx(s,{type:"左右",w:"full",h:"full"}),e.jsx(s,{type:"左右___主轴居中",w:"24px",h:"full",children:e.jsx(k,{type:"正文内容",text:"×",style:{fontSize:"16px",fontWeight:"bold",color:"white",cursor:"pointer"},onClick:o})})]}),e.jsxs(s,{type:"上下",w:"full",h:"76",style:{padding:"0 22px"},children:[e.jsx(s,{type:"左右___主轴居中",w:"378px",children:e.jsx(k,{type:"一级标题栏_高亮",text:d.需要启用iot驱动,style:{color:"var(--高亮2, #74EBD5)",fontSize:20,fontFamily:"var(--font-family-regular)",fontWeight:"500",wordWrap:"break-word",whiteSpace:"pre-wrap"},wrap:!0})}),e.jsx(J,{h:24}),e.jsx(s,{type:"上下",w:"378px",children:e.jsx(k,{type:"正文内容",text:d.此功能需要启用iot驱动后使用请点击下方按钮启用,style:{color:"var(--字体, #EEEEEE)",fontSize:16,fontFamily:"var(--font-family-regular)",fontWeight:"400",wordWrap:"break-word",whiteSpace:"pre-wrap"},wrap:!0})})]}),e.jsx(J,{h:60}),e.jsx(s,{type:"左右___主轴居中",w:"full",children:e.jsx(s,{style:{width:"100%",height:"100%",paddingLeft:31.5,paddingRight:31.5,paddingTop:8,paddingBottom:8,background:"linear-gradient(90deg, #74EBD5 0%, #9FACE6 100%)",borderRadius:6,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",gap:10,display:"inline-flex",cursor:"pointer"},onClick:n,children:e.jsx(s,{style:{justifyContent:"center",alignItems:"center",gap:10,display:"inline-flex"},children:e.jsx(k,{type:"正文内容",text:d.启用iot驱动||"启用IOT驱动",style:{color:"#3E3E3E",fontSize:20,fontFamily:"Source Han Sans SC",fontWeight:"400",wordWrap:"break-word"}})})})})]})})})},we=()=>{const o=t.getCurrentDevice().其他设置.省电模式是否开启;i.useEffect(()=>{if(!t.isUseIotSDK)return;(async()=>{const f=await O.getAllItems(T.DBPATH.LIGHT,T.DBPATH.LIGHT_IMAGE_BUFFER);t.allPicsInDb=f})()},[]);const[n,d]=i.useState("50"),[a,l]=i.useState(!1),[C,j]=i.useState(!1),m=i.useRef(null),D=i.useRef(null),S=z(),c=t.state_lightCustomizationPage,I=t.getCurrentDevice(),v=t.eventStarted;i.useEffect(()=>{t.getCurrentDevice().灯效编辑.读取自定义层==="none_调用结束"&&v&&(t.eventStarted=!1,t.updateKeyboardColorsFromDJ(),R.success(S.读取成功,h.toastOptions))},[t.getCurrentDevice().灯效编辑.读取自定义层]),i.useEffect(()=>{t.getCurrentDevice().灯效编辑.写入自定义层==="none_调用结束"&&v&&(t.eventStarted=!1,R.success(S.写入成功,h.toastOptions))},[t.getCurrentDevice().灯效编辑.写入自定义层]),i.useEffect(()=>{t.getCurrentDevice().灯效编辑.写入动态灯效==="none_调用结束"&&v&&(t.eventStarted=!1,R.success(S.写入成功,h.toastOptions))},[t.getCurrentDevice().灯效编辑.写入动态灯效]);const[b,E]=i.useState(!1),[x,P]=i.useState("staticLightEffect");return e.jsxs(s,{type:"上下",w:"full",h:"full",style:{gap:"25px",position:"relative"},children:[t.supportDynamicLightEffects&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{type:"左右___主轴居中",w:"full",style:{padding:"0 0 20px 0",flexWrap:"wrap",gap:"10px"},children:[e.jsx(s,{style:{fontFamily:"var(--font-family-regular)",fontSize:"1rem",lineHeight:"1.5rem",color:"#3E3E3E",minWidth:"80px"},children:S.所有帧率}),e.jsxs(s,{type:"左右___主轴居中",w:"10vw",style:{position:"relative",flex:"1 1 auto",minWidth:"0"},children:[e.jsx("input",{type:"text",inputMode:"numeric",style:{width:"80%",height:"36px",borderRadius:"12px",border:"1px solid #E0E0E0",backgroundColor:"#FFFFFF",fontFamily:"Inter",fontSize:"14px",color:"#525252",paddingRight:"30px",paddingLeft:"12px",textAlign:"center",outline:"none",transition:"border-color 0.2s ease"},value:n,onChange:g=>{try{let f=g.target.value;if(f===""){d("");return}const L=f.replace(/[^0-9]/g,"");if(L===""){d("");return}let u=L;u.length>1&&(u=u.replace(/^0+/,"")||"0");const r=parseInt(u,10);if(isNaN(r)){d("");return}const p=Math.max(0,Math.min(255,r));d(p.toString())}catch{d("0")}},onBlur:()=>{try{let g=n.toString();(g===""||g===null||g===void 0)&&(g="0"),g.length>1&&(g=g.replace(/^0+/,"")||"0");const f=parseInt(g,10),L=isNaN(f)?0:Math.max(0,Math.min(255,f));d(L.toString()),c&&typeof c.frameDelay<"u"&&(c.frameDelay=L)}catch{d("0"),c&&typeof c.frameDelay<"u"&&(c.frameDelay=0)}},onKeyDown:g=>{try{if(g.key==="Enter"){let f=n.toString();(f===""||f===null||f===void 0)&&(f="0"),f.length>1&&(f=f.replace(/^0+/,"")||"0");const L=parseInt(f,10),u=isNaN(L)?0:Math.max(0,Math.min(255,L));d(u.toString()),c&&typeof c.frameDelay<"u"&&(c.frameDelay=u),g.currentTarget.blur()}if(g.key==="ArrowUp"){g.preventDefault();const f=parseInt(n.toString(),10),L=isNaN(f)?0:f,u=Math.min(255,L+1);d(u.toString()),c&&typeof c.frameDelay<"u"&&(c.frameDelay=u)}if(g.key==="ArrowDown"){g.preventDefault();const f=parseInt(n.toString(),10),L=isNaN(f)?0:f,u=Math.max(0,L-1);d(u.toString()),c&&typeof c.frameDelay<"u"&&(c.frameDelay=u)}}catch{d("0"),c&&typeof c.frameDelay<"u"&&(c.frameDelay=0)}},onFocus:g=>{try{g.target.style.borderColor="#007AFF"}catch{}},onBlurCapture:g=>{try{g.target.style.borderColor="#E0E0E0"}catch{}},placeholder:"0-255"}),e.jsx("span",{style:{position:"absolute",right:"20%",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",fontFamily:"var(--font-family-regular)",fontSize:"14px",color:"#525252"},children:"cs"})]})]}),e.jsx(s,{type:"左右",w:"full",children:e.jsx(U,{text:S.写入动态灯效,style:{width:"100%",padding:"10px"},disabled:v||c.totalFrames.length<2||I.deviceType?.type==="keyboard"&&I.deviceType.connect==="24g",onClick:()=>{t.state_lightCustomizationPage.writeDynamicLightEffects(),t.eventStarted=!0}})})]}),e.jsxs(s,{type:"左右",w:"full",style:{gap:`${window.innerWidth<=1280?0:10}px`},children:[e.jsx(U,{style:{width:"100%",padding:"10px"},text:S.写入自定义层,disabled:v&&c.getWriteCustomizationLayerEvent()!=="none_调用结束"||o,onClick:()=>{if(o){R.error(S.省电模式下无法设置灯效||"省电模式下无法设置灯效",h.toastOptions);return}c.writeSelectedCustomizationLayer(),t.eventStarted=!0}}),e.jsx(s,{divRef:m,children:e.jsx(Y,{text:c.selectedCustomizationLayerToWrite.toString(),disabled:o,onClick:()=>{if(o){R.error(S.省电模式下无法设置灯效||"省电模式下无法设置灯效",h.toastOptions);return}l(!a),j(!1)}})})]}),a&&e.jsx(X,{buttonRef:m,onMouseLeave:()=>{l(!1)},onSelect:g=>{c.selectedCustomizationLayerToWrite=g,l(!1)}}),e.jsxs(s,{type:"左右",w:"full",style:{gap:`${window.innerWidth<=1280?0:10}px`},children:[e.jsx(U,{style:{width:"100%",padding:"10px"},text:S.读取自定义层,disabled:v&&c.getReadCustomizationLayerEvent()!=="none_调用结束"||o,onClick:()=>{if(o){R.error(S.省电模式下无法设置灯效||"省电模式下无法设置灯效",h.toastOptions);return}c.readSeletedCustomizationLayer(),t.eventStarted=!0}}),e.jsx(s,{divRef:D,children:e.jsx(Y,{text:c.selectedCustomizationLayerToRead.toString(),disabled:o,onClick:()=>{if(o){R.error(S.省电模式下无法设置灯效||"省电模式下无法设置灯效",h.toastOptions);return}j(!C),l(!1)}})})]}),C&&e.jsx(X,{buttonRef:D,onMouseLeave:()=>{j(!1)},onSelect:g=>{c.selectedCustomizationLayerToRead=g,j(!1)}}),t.isUseIotSDK&&e.jsx(s,{type:"左右",w:"full",children:e.jsx(U,{text:S.保存静态灯效,style:{width:"100%",padding:"10px"},disabled:v,onClick:()=>{E(!0),P("staticLightEffect")}})}),t.isUseIotSDK&&t.supportDynamicLightEffects&&e.jsx(s,{type:"左右",w:"full",children:e.jsx(U,{text:S.保存动态灯效,style:{width:"100%",padding:"10px"},disabled:v||c.totalFrames.length<2,onClick:()=>{E(!0),P("dynamicLightEffect")}})}),b&&e.jsx(de,{type:x,visible:b,onClose:()=>E(!1),onSave:async g=>{E(!1),x==="staticLightEffect"?await t.state_lightCustomizationPage.handleSaveLightEffect(g,"static"):await t.state_lightCustomizationPage.handleSaveLightEffect(g,"dynamic")}})]})},X=o=>{const d=t.state_lightCustomizationPage.getMaxCustomizationLayer(),a=ne();return i.useEffect(()=>{if(o.buttonRef.current&&a.current){const C=o.buttonRef.current.getBoundingClientRect();a.current.style.position="fixed",a.current.style.top=`${C.bottom+window.scrollY+10}px`,a.current.style.left=`${C.left+window.scrollX}px`,a.current.style.zIndex="9999"}},[o.buttonRef.current]),i.useEffect(()=>{const l=()=>{o.onMouseLeave?.(),a.current?.removeEventListener("mouseleave",l)},C=()=>{a.current?.addEventListener("mouseleave",l)};return a.current?.addEventListener("mouseenter",C),()=>{a.current?.removeEventListener("mouseenter",C),a.current?.removeEventListener("mouseleave",l)}},[a.current]),e.jsx(s,{divRef:a,style:{position:"fixed"},children:e.jsx(ue,{maxLayer:d,options:Array.from({length:d},(l,C)=>({text:`${C+1}`,onClick:()=>{o.onSelect(C+1)}}))})})},Ce=o=>{K();const n=z(),d=t.state_lightCustomizationPage.isRandomColor,a=t.state_lightCustomizationPage,l=t;return i.useEffect(()=>{a.penColorPickerOn&&(a.prevPenColor=a.penColor)},[a.penColorPickerOn]),i.useEffect(()=>{d&&l.keyboardState.keys[l.当前选中按键_单键]&&(l.keyboardState.keys[l.当前选中按键_单键].keyColor=Math.floor(Math.random()*16777215))},[l.当前选中按键_单键]),e.jsx(s,{divRef:o.divRef,type:"上下",w:"full",h:"full",style:{gap:"10px"},children:e.jsxs(s,{type:"左右___主轴居中",w:"95%",style:{backgroundColor:"#F9F9F9",borderRadius:"12px",gap:"10px",padding:"1vh 2vw 1.5vh 2vw",flexWrap:"wrap"},children:[e.jsxs(s,{type:"左右___主轴居中",style:{gap:"1.5vw"},children:[e.jsxs(s,{style:{gap:"0.5vw"},children:[e.jsx(k,{type:"正文内容",text:n.画笔颜色}),e.jsx(ce,{color:a.penColor,onClick:()=>{t.state_lightCustomizationPage.isRandomColor=!1,a.penColorPickerOn=!1},onChange:C=>{a.penColor=C}})]}),e.jsxs(s,{style:{gap:"0.5vw"},children:[e.jsx(k,{type:"正文内容",text:n.取色器}),e.jsx(V,{type:"ColorPickerPen",onClick:()=>{t.state_lightCustomizationPage.isRandomColor=!1,a.penColorPickerOn=!a.penColorPickerOn},on:a.penColorPickerOn})]}),e.jsx(s,{w:0,h:50,style:{borderRight:"1px solid #E0E0E0"}}),e.jsx(G,{text:n.随机颜色,isSelected:d,onClick:()=>{t.state_lightCustomizationPage.isRandomColor=!d,a.penColorPickerOn=!1}}),e.jsx(s,{w:0,h:50,style:{borderRight:"1px solid #E0E0E0"}})]}),e.jsxs(s,{type:"左右",style:{gap:"10px",padding:"10px",justifyContent:"flex-start"},children:[e.jsx(M,{page:B.灯光设置页,backgroundColor:"#FFFFFF",type:"清空当前帧",isCurrent:!1,onClick:async()=>{await l.state_lightCustomizationPage.addUndoList(),await l.state_lightCustomizationPage.clearCurrentFrame(),await l.state_lightCustomizationPage.syncCurrentFrameToKeyboardColors()}}),t.supportDynamicLightEffects&&e.jsxs(e.Fragment,{children:[e.jsx(M,{page:B.灯光设置页,backgroundColor:"#FFFFFF",type:"加帧",isCurrent:!1,onClick:async()=>{await l.state_lightCustomizationPage.addUndoList(),await l.state_lightCustomizationPage.addFrame(),await l.state_lightCustomizationPage.syncCurrentFrameToKeyboardColors()}}),e.jsx(M,{page:B.灯光设置页,backgroundColor:"#FFFFFF",type:"减帧",isCurrent:!1,onClick:async()=>{await l.state_lightCustomizationPage.addUndoList(),await l.state_lightCustomizationPage.removeCurrentFrame(),await l.state_lightCustomizationPage.syncCurrentFrameToKeyboardColors()}}),e.jsx(M,{page:B.灯光设置页,backgroundColor:"#FFFFFF",type:"复制上一帧",isCurrent:!1,onClick:async()=>{await l.state_lightCustomizationPage.addUndoList(),await l.state_lightCustomizationPage.copyPreviousFrame(),await l.state_lightCustomizationPage.syncCurrentFrameToKeyboardColors()}}),e.jsx(M,{page:B.灯光设置页,backgroundColor:"#FFFFFF",type:"撤回",isCurrent:!1,onClick:async()=>{await l.state_lightCustomizationPage.undo(),await l.state_lightCustomizationPage.syncCurrentFrameToKeyboardColors()}}),e.jsx(M,{page:B.灯光设置页,backgroundColor:"#FFFFFF",type:"恢复",isCurrent:!1,onClick:async()=>{await l.state_lightCustomizationPage.redo(),await l.state_lightCustomizationPage.syncCurrentFrameToKeyboardColors()}}),e.jsx(M,{page:B.灯光设置页,backgroundColor:"#FFFFFF",type:"删除所有帧",isCurrent:!1,onClick:async()=>{await l.state_lightCustomizationPage.addUndoList(),await l.state_lightCustomizationPage.clearAllFrames(),await l.state_lightCustomizationPage.syncCurrentFrameToKeyboardColors()}})]})]})]})})},Se=o=>{K();const n=z(),d=h,a=d.state_lightCustomizationPage;i.useState(void 0);const[l,C]=i.useState([]);i.useState(null);const[j,m]=i.useState(e.jsx(ie,{})),[D,S]=i.useState(!1),[c,I]=i.useState(!1),[v,b]=i.useState(!1),[E,x]=i.useState(null),P=i.useRef(!1),g=i.useRef(null),f=N($.LightCustomization);i.useEffect(()=>{(async()=>{t.shouldUpdateKeyboardColors&&(await a.readSeletedCustomizationLayer(),t.shouldUpdateKeyboardColors=!1)})()},[]),i.useEffect(()=>{if(j){const r=document.querySelector(".lightSettingsKeyboardSvg");r&&(t.state_lightCustomizationPage.keyboardSvg=r)}},[j]),i.useEffect(()=>{if(!t.isUseIotSDK)return;(async()=>{C(await O.getAllItems(T.DBPATH.LIGHT,T.DBPATH.LIGHT_IMAGE_BUFFER))})()},[]),i.useEffect(()=>{const r=async _=>{if(document.querySelector(".lightSettingsKeyboardSvg")?.contains(_.target)){await a.addUndoList(),a.totalFrames.length===0&&await a.addFrame(),(c||v)&&(await a.addFrame(),await a.syncKeyboardColorsToCurrentFrame()),S(!1);const F=t.当前选中按键_单键;x(F),g.current=F}},p=async _=>{document.querySelector(".lightSettingsKeyboardSvg")?.contains(_.target)&&S(!0)},y=async _=>{if(!(!(c||v)||!document.querySelector(".lightSettingsKeyboardSvg")?.contains(_.target)||!t.当前选中按键_单键||t.当前选中按键_单键===g.current||P.current)){P.current=!0;try{const F=t.当前选中按键_单键;x(F),g.current=F,await a.addFrame(),c&&(await a.clearCurrentFrame(),await a.syncCurrentFrameToKeyboardColors()),F&&d.keyboardState.keys[F]&&(d.keyboardState.keys[F].keyColor=a.isRandomColor?Math.floor(Math.random()*16777215):a.penColor),await a.syncKeyboardColorsToCurrentFrame()}catch{}finally{P.current=!1}}};return document.addEventListener("mousedown",r),document.addEventListener("mouseup",p),document.addEventListener("mousemove",y),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("mouseup",p),document.removeEventListener("mousemove",y)}},[c,v,t.当前选中按键_单键,g.current,P.current,a.totalFrames.length]),i.useEffect(()=>{c||(P.current=!1,g.current=null,x(null))},[c]),i.useEffect(()=>{D&&(async()=>await a.syncKeyboardColorsToCurrentFrame())()},[D]),i.useEffect(()=>{(async()=>{a.isPlayingPreview&&await a.syncCurrentFrameToKeyboardColors()})()},[a.currentIndex,a.isPlayingPreview]);const L=i.useRef(null),u=i.useRef(null);return e.jsxs(s,{type:"左右",w:"full",h:"full",style:{padding:"0 20px",backgroundColor:"#FFFFFF",gap:"10px",borderRadius:"0 0 12px 12px",justifyContent:"space-around"},children:[e.jsxs(s,{type:"上下",h:"full",style:{gap:"10px"},children:[e.jsx(s,{type:"左右___主轴居中",h:400,style:{borderRadius:"12px"},children:f}),t.supportDynamicLightEffects&&e.jsxs(s,{divRef:u,type:"左右___主轴居中",w:"full",h:120,style:{gap:"15px",alignItems:"center"},children:[e.jsx(ge,{maxWidth:840,frameObjectType:"lightCustomization"}),a.totalFrames.length>0&&e.jsx(s,{type:"左右___主轴居中",w:50,h:50,style:{borderRadius:"50%",backgroundColor:"#74EBD5",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(116, 235, 213, 0.3)",flexShrink:0},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#5DD4C1",r.currentTarget.style.transform="scale(1.05)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#74EBD5",r.currentTarget.style.transform="scale(1)"},onClick:async()=>{t.state_lightCustomizationPage.isPlayingPreview?t.state_lightCustomizationPage.stopPreviewLightEffectAnimation():await t.state_lightCustomizationPage.previewLightEffectAnimation()},children:t.state_lightCustomizationPage.isPlayingPreview?e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",fill:"white",rx:"1"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",fill:"white",rx:"1"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8 5V19L19 12L8 5Z",fill:"white",stroke:"white",strokeWidth:"2",strokeLinejoin:"round"})})})]}),t.supportDynamicLightEffects&&e.jsxs(s,{w:"95%",type:"上下___交叉轴居左",children:[e.jsx(s,{type:"上下___交叉轴居左",w:"full",style:{padding:"13px",borderBottom:"1px solid var(--color-background-unimportant)"},children:e.jsx(k,{type:"小标题",text:n.编辑||"编辑"})}),e.jsxs(s,{w:"full",h:55,type:"左右",style:{justifyContent:"flex-start",gap:"10px",padding:"10px 5px"},children:[e.jsx(G,{text:n.自动生成帧动画,isSelected:c,onClick:()=>{b(!1),I(!c)}}),e.jsx(G,{text:n.自动补帧,isSelected:v,onClick:()=>{I(!1),b(!v)}}),e.jsx(s,{h:"90%",style:{borderRight:"1px solid var(--color-background-unimportant)"}}),e.jsx(G,{text:n.隐藏帧率,isSelected:t.state_lightCustomizationPage.hideFrameDelay,onClick:()=>{t.state_lightCustomizationPage.hideFrameDelay=!t.state_lightCustomizationPage.hideFrameDelay}})]})]}),e.jsx(Ce,{divRef:L})]}),e.jsxs(s,{type:"上下",h:"full",style:{alignItems:"center"},children:[e.jsx(oe,{hideShadow:!0,text:n.写入设备,isCurrent:!0,onClick:()=>{}}),e.jsx(s,{type:"上下",w:"full",h:608,style:{backgroundColor:"#F9F9F9",borderRadius:"12px",padding:"20px"},children:e.jsx(we,{})})]})]})},be=()=>{K();const o=z(),[n,d]=i.useState(1),a=6,[l,C]=i.useState(!1);i.useState([]),i.useEffect(()=>{if(!t.isUseIotSDK)return;(async()=>{const p=await O.getAllItems(T.DBPATH.LIGHT,T.DBPATH.LIGHT_IMAGE_BUFFER);t.allPicsInDb=p})(),(async()=>{await t.state_lightCustomizationPage.clearAllFrames()})()},[t.isUseIotSDK]),i.useEffect(()=>{t.getCurrentDevice().灯效编辑.写入自定义层==="none_调用结束"&&l&&(C(!1),R.success(o.写入成功||"写入成功",t.toastOptions))},[t.getCurrentDevice().灯效编辑.写入自定义层]);const{buttonRefs:j,dropdownState:m,setDropdownState:D,handleDropdownSelect:S}=pe(),c="data:image/gif;base64,",I="data:image/png;base64,",[v,b]=i.useState(""),[E,x]=i.useState(""),P=u=>u.includes(W.keyboard_light_gif)?c:(u.includes(W.keyboard_light_png),I),g=u=>{u.currentTarget.value.length>20&&H.next({type:"error",message:o.名称不能超过20个字符||"名称不能超过20个字符"}),x(u.currentTarget.value.slice(0,20))},f=async(u,r,p=!1)=>{const y=t.state_lightCustomizationPage,_=r??E;if(_.trim()===""||_===v){H.next({type:"error",message:o.名称不能为空||"名称不能为空"}),y.isRenaming=!1;return}y.isRenaming=!1;const F=t.allPicsInDb.findIndex(A=>A.id===u.id);if(F!==-1){const A={...u};A.title=_,await O.deleteItem(u,T.DBPATH.LIGHT,T.DBPATH.LIGHT_IMAGE_BUFFER),await O.saveItemToDb(A,T.DBPATH.LIGHT,T.DBPATH.LIGHT_IMAGE_BUFFER);const q=[...t.allPicsInDb];q[F]=A,t.allPicsInDb=q,p||H.next({type:"success",message:o.重命名成功||"重命名成功"})}},L=[{key:"data",title:o.灯光||"灯光",width:"170px",render:(u,r)=>{if(r.data===void 0)return null;let p="";const _=Buffer.from(re.inflateRaw(r.data)).toString("utf8").split(le.jsonImageSourceSeparator);_.length>1?p=_[1]??"":p=_[0]??"";const F=P(r.screen_type)+p;return e.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12},children:e.jsx("img",{style:{display:"block",width:"120px",height:"57px",objectFit:"contain"},src:F})})}},{key:"title",title:o.灯效名称||"灯效名称",width:"1fr",render:(u,r)=>{const p=t.state_lightCustomizationPage;if(p.isRenaming&&p.currentItemId===r.id.toString())return e.jsx("input",{id:"inputField",value:E,onInput:y=>{g(y)},onKeyDown:async y=>{y.key==="Enter"&&await f(r)},onFocus:y=>{x(""),y.target.style.borderColor="#1890ff",y.target.style.boxShadow="0 0 0 2px rgba(24, 144, 255, 0.2)"},onBlur:y=>{f(r),y.target.style.borderColor="#d9d9d9",y.target.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"},style:{width:"50%",padding:"8px 12px",borderRadius:"4px",border:"1px solid #d9d9d9",fontSize:"14px",outline:"none",transition:"all 0.3s",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},autoFocus:!0});{const y=r.title;return e.jsx("div",{onClick:()=>{p.isRenaming=!0,p.currentItemId=r.id?.toString()??"",x("")},style:{cursor:"pointer",fontSize:"14px",outline:"none",transition:"all 0.3s",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:y,children:y})}}},{key:"write",title:o.写入||"写入",width:"80px",render:(u,r)=>e.jsx(s,{w:30,h:30,style:{cursor:"pointer",margin:"0 auto"},children:e.jsx(V,{type:"写入",onClick:async()=>{if(r.data===void 0)return null;let p="static";switch(r.screen_type){case W.keyboard_light_png:p="static";break;case W.keyboard_light_gif:p="dynamic";break;default:p="static";break}await t.handleWriteLightEffect(p,r.data)}})})},{key:"delete",title:o.删除||"删除",width:"80px",render:(u,r)=>e.jsx(s,{w:30,h:30,style:{cursor:"pointer",margin:"0 auto"},children:e.jsx(V,{type:"删除",onClick:async()=>{if(r.data===void 0)return null;if(await O.deleteItem(r,T.DBPATH.LIGHT,T.DBPATH.LIGHT_IMAGE_BUFFER)){const p=[...t.allPicsInDb],y=p.findIndex(_=>_.id===r.id);y!==-1&&p.splice(y,1),t.allPicsInDb=p,H.next({type:"success",message:o.删除当前作品成功||"删除当前作品成功"})}else H.next({type:"error",message:o.删除当前作品失败||"删除当前作品失败"})}})})},{key:"operation",title:o.操作||"操作",width:"80px",render:(u,r)=>e.jsxs(s,{w:30,h:30,style:{cursor:"pointer",margin:"0 auto",position:"relative"},children:[e.jsx(V,{type:"操作",onClick:()=>{const p=window.event;p&&p.stopPropagation();const y=j.current.get(r.id);if(y){const _=y.getBoundingClientRect();m.isOpen&&m.itemId===r.id?.toString()?D(F=>({...F,isOpen:!1})):D({isOpen:!0,position:{x:_.left-45,y:_.bottom+2},itemId:r.id?.toString()??""})}}}),e.jsx("div",{ref:p=>{p?j.current.set(r.id,p):j.current.delete(r.id)},style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none"}})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(fe,{columns:L,dataSource:t.allPicsInDb,pageSize:a,onPageChange:d,style:{padding:"20px",flex:"1 1 auto"},headerStyle:{display:"flex",alignItems:"center",justifyContent:"center"}}),e.jsx(he,{isOpen:m.isOpen,onClose:()=>D(u=>({...u,isOpen:!1})),position:m.position,onSelect:u=>S(m.itemId??"",u),menuItems:t.companyConfig.newSingleDriver?["rename","edit"]:["rename","edit","share"]}),e.jsx(ye,{show:t.showShareModal,type:"light",name:t.allPicsInDb.find(u=>u.id===m.itemId)?.title??"",onCancel:()=>{t.showShareModal=!1},onConfirm:async u=>{const r=t.allPicsInDb.find(y=>y.id===m.itemId),p=r?.title??"";if(r){r.title=u.name??r.title,r.describe=u.description??r.describe??"";const y=u.name??r.title,_=!0;await f(r,y,_),t.allPicsInDb=[...t.allPicsInDb],await t.handleShareLocalImageLikeItem(m.itemId??""),await f(r,p,_)}t.showShareModal=!1},disableButtons:t.isWaitingServerResponse})]})},_e=()=>{K();const o=z(),n=h.getCurrentDevice(),[d,a]=i.useState(!1),l=n.其他设置.省电模式是否开启,C=N($.LightEffects);i.useEffect(()=>{a(t.isUseIotSDK)},[t.isUseIotSDK]);const j=Object.keys(n.sideLight.data),[m,D]=i.useState("LightOff");i.useEffect(()=>{D(n.sideLight.lightType)},[n.sideLight.lightType]);const S=new Set(["LightWave","LightSnake","LightOff","LightAlwaysOn","LightBreath","LightNeon"]),c=b=>S.has(b)?`side${b}`:b,[I,v]=i.useState({has_color:!1,color_type:"单色",color_value:t.getCurrentDevice()?.sideLight.data[t.getCurrentDevice()?.sideLight.lightType]?.color_value??0,速度_max:0,速度_value:0,亮度_max:0,亮度_value:0,option_arr:[],option_value:0});return i.useEffect(()=>{if(!n)return;const b=n.sideLight.data[n.sideLight.lightType];b&&v(b)},[n.sideLight.data[m],m]),i.useEffect(()=>{h.current灯光设置页SubpageIndex=w.灯带},[]),e.jsxs(s,{type:"上下",w:"full",h:"full",style:{},children:[e.jsx(s,{type:"左右___主轴居中",children:e.jsxs(s,{type:"上下",children:[e.jsx(s,{h:20}),e.jsx(s,{type:"左右",w:"full",h:"full",style:{backgroundColor:"#F5F5F5"},children:C})]})}),e.jsx(s,{w:70}),e.jsxs(s,{type:"左右",w:"full",h:"full",style:{padding:"20px",overflow:"auto"},children:[e.jsxs(s,{type:"上下",w:"full",h:"full",style:{flex:2},children:[e.jsx(s,{type:"上下___交叉轴居左",w:"full",h:40,style:{borderBottom:"1px solid rgba(0,0,0,0.4)"},children:e.jsx(k,{type:"小标题",text:o.灯效})}),e.jsx(s,{w:"full",h:10}),e.jsxs(s,{type:"上下",w:"full",h:"full",style:{borderRight:"1px solid rgba(0,0,0,0.4)",overflow:"auto"},children:[e.jsx(Z,{children:j.map((b,E)=>e.jsx(ee,{disabled:!d&&b==="LightMusicFollow2"||l,text:o[c(b)],isCurrent:m===b,onClick:()=>{if(l){R.error(o.省电模式下无法设置灯效||"省电模式下无法设置灯效",h.toastOptions);return}n.sideLight.lightType=b},w:120,h:40,style:{margin:"10px",display:"block"}},E))}),!d&&e.jsx(k,{type:"提示文本",text:o.音乐律动只能在IOT模式下运行})]})]}),e.jsxs(s,{type:"上下",w:"full",h:"full",style:{flex:1},children:[e.jsx(s,{type:"上下___交叉轴居左",w:"full",h:40,style:{borderBottom:"1px solid rgba(0,0,0,0.4)"},children:e.jsx(k,{type:"小标题",text:o.灯光编辑})}),e.jsxs(s,{type:"上下",w:"full",h:"full",style:{gap:"10px",padding:"10px 20px"},children:[e.jsx(k,{type:"小标题",text:o.颜色}),e.jsx(se,{currentLightData:I,type:"sideLight"}),e.jsx(te,{type:"sideLight"})]})]})]})]})},Be=()=>{K();const o=z(),n=i.useMemo(()=>{if(h.getCurrentDevice().deviceType.type=="mouse"&&h.getCurrentDevice().deviceType.lightLayout)return[{key:w.灯光,title:o.灯光}];const l=[];return h.getCurrentDevice().deviceType.sideLightLayout?l.push({key:w.灯光,title:o.灯光},{key:w.灯光编辑,title:o.灯光编辑},{key:w.灯带,title:o.灯带}):l.push({key:w.灯光,title:o.灯光},{key:w.灯光编辑,title:o.灯光编辑}),h.isUseIotSDK&&l.push({key:w.我的作品,title:o.我的作品}),l},[h.getCurrentDevice().deviceType.id,h.languageCode,h.isUseIotSDK]),d=l=>{switch(l){case w.灯光:h.current灯光设置页SubpageIndex=w.灯光;break;case w.灯光编辑:h.current灯光设置页SubpageIndex=w.灯光编辑;break;case w.我的作品:h.current灯光设置页SubpageIndex=w.我的作品;break;case w.灯带:h.current灯光设置页SubpageIndex=w.灯带;break;default:h.current灯光设置页SubpageIndex=w.灯光;break}};i.useEffect(()=>{h.debug&&(h.current灯光设置页SubpageIndex=w.灯光编辑)},[h.debug]);const a=()=>{switch(h.current灯光设置页SubpageIndex){case w.灯光:return e.jsx(Q,{});case w.灯光编辑:return e.jsx(Se,{});case w.灯带:return e.jsx(_e,{});case w.我的作品:return e.jsx(be,{});default:return e.jsx(Q,{})}};return i.useEffect(()=>()=>{h.current灯光设置页SubpageIndex=w.灯光},[]),e.jsx(e.Fragment,{children:e.jsx(xe,{tabs:n,currentTab:h.current灯光设置页SubpageIndex,onTabChange:d,children:a()})})};export{Be as Page_灯光设置页};
