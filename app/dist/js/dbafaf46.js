import{d as t,a as ae,键 as N,aa as M,ac as le,a8 as U,u as ie,G as de,ao as ye,ap as j,a9 as E,j as $,V as re,r as te,b5 as fe,aq as ue}from"./index.b078bf5f.js";import{u as _e}from"./3ce44458.js";const xe=e=>{const o=e.ui,l=e.keyCode,y=e.keysToExclude,a=e.excludeConditions,s=e.excludeEffectType,c=e.isKnobRect??!1;return _e.hydrateKeyBox({ui:o,keyCode:l,isKnobRect:c,onHover:(u,m)=>{try{if(!u||s&&s==="hover"||y&&y.has(u)&&a&&a()||t.state_行程设置.is滚动行程滚轮)return;const S=new Set(Object.keys(t.keyboardState.keys)),d=t.keyboardState,n=ae();if(!u)return;const i=u;if(!i)return;const b=t.getIs改键(i),C=t.checkIsSystemKey(i),R=t.shouldShowDisabledStatus(i),T=t.getIs高级键改键(i);if(c&&t.current键盘设置页SubpageIndex===N.高级设置||c&&t.current键盘设置页SubpageIndex===N.磁轴设置||!S.has(i))return;const L=d.keys[i];L&&(L.isHover=m);const g=t.isFnLayer,_=t.getCurrentDevice(),v=g?_.KB改键设置.所有Fn改键信息:_.KB改键设置.所有改键信息,f=g?t.板载_fn层:t.板载,x=v.find(r=>r.profile===f&&r.sonProfile===t.getCurrentSonProfile()&&r.isFn===g),P=M.htmlCodeMapHIDCode(i),K=x?.configs?.find(r=>(r.type==="combo"||r.type==="ConfigFunction"||r.type==="forbidden"||r.type==="ConfigMacro"||r.type==="ConfigUnknown"||r.type==="ConfigMT"||r.type==="ConfigMouse")&&r.original===P&&r.index===t.getKeyIndex(i)),D=t.高级键_当前绑定项?.find(r=>r.originalKeys.includes(i));if(m){d.keys[i].isHover=m;let r="",I=t.keyCodeToDisplayText[i]||i;if(D&&!g){let k=D.type;switch(k){case"MDS":r="MDS: "+D.originalKeys.filter(w=>w!==i)?.map(w=>t.keyCodeToDisplayText[w]);break;case"SnapKey":r="SnapKey: "+D.originalKeys.filter(w=>w!==i)?.map(w=>t.keyCodeToDisplayText[w]);break;case"DKS":r=n.tipText_动态键程;break;case"MT":r=n.tipText_按住单击;break;case"TGL":r=n.tipText_切换开关;break;default:r=k}}else if(K)switch(K.type){case"ConfigMT":r=n.tipText_按住单击||"";break;case"forbidden":r=t.isFnLayer?"":n.已禁用;break;case"combo":const k=[];if(K.skey){const p=M.hidCodeMapHtmlCode(K.skey);p&&k.push(p)}if(K.key){const p=M.hidCodeMapHtmlCode(K.key);p&&k.push(p)}if(K.key2){const p=M.hidCodeMapHtmlCode(K.key2);p&&k.push(p)}const w=k.map(p=>t.keyCodeToDisplayText[p]);t.isFnLayer&&B.add(M.htmlCodeMapHIDCode(i)||null),r=w.join(" + ");break;case"ConfigFunction":const W=x?.configs?.find(p=>p.type==="ConfigFunction"&&p.original===P);if(W){const p=W?.key;r=n[p]||p,t.isFnLayer&&B.add(M.htmlCodeMapHIDCode(i)||null)}break;case"ConfigMouse":const X=x?.configs?.find(p=>p.type==="ConfigMouse"&&p.original===P);r=n[le[X?.key]]||"",t.isFnLayer&&B.add(M.htmlCodeMapHIDCode(i)||null);break;case"ConfigMacro":r=n.宏,t.isFnLayer&&B.add(M.htmlCodeMapHIDCode(i)||null);break;case"ConfigUnknown":r=n.系统按键;break}else if(t.getCurrentDevice()?.磁轴?.WASDSwap===!0&&!t.isFnLayer){const k={KeyW:"ArrowUp",KeyA:"ArrowLeft",KeyS:"ArrowDown",KeyD:"ArrowRight"},w={ArrowUp:"KeyW",ArrowLeft:"KeyA",ArrowDown:"KeyS",ArrowRight:"KeyD"};new Set(["KeyW","KeyA","KeyS","KeyD"]).has(i)&&(r=n.快捷改键+"("+t.keyCodeToDisplayText[k[i]]+")"||""),new Set(["ArrowUp","ArrowLeft","ArrowDown","ArrowRight"]).has(i)&&(r=n.快捷改键+"("+t.keyCodeToDisplayText[w[i]]+")"||"")}if(t.isFnLayer&&i==="Fn"&&(r=n.系统按键),t.isFnLayer&&_.deviceType.other?.forceSystemKeyCodes?.includes(i)&&(r=n.系统按键),r){let k=null;R?k=o.status.disabled.root:b||T?k=o.status.changed.root:C&&(k=o.status.systemKey.root),k&&se.show(i,I,r,k)}}else se.hide();B.clear()}catch{}},onSelect:(u,m)=>{if(!u)return;const S=t.getCurrentDevice().deviceType?.version?.rf??t.getCurrentDevice().deviceType?.version?.usb;if(t.current键盘设置页SubpageIndex===N.磁轴设置&&S&&S<768&&t.getCurrentDevice().磁轴.磁轴键盘模式!="custom"||s&&s==="current"||y&&y.has(u)&&a&&a())return;const d=()=>t.按键选择方式!=="单选",n=t,i=new Set(Object.keys(t.keyboardState.keys));if(!u)return;const b=u;if(b&&!(c&&t.current键盘设置页SubpageIndex===N.高级设置||c&&t.current键盘设置页SubpageIndex===N.磁轴设置)&&!t.state_行程设置.is滚动行程滚轮&&m){const C=t.keyboardState.keys[b];if(!i.has(b)||!C)return;if(C.isSelected){if(C.isSelected=!1,n.当前选中按键_单键===b&&(n.当前选中按键_单键=null),d()){const T=n.当前选中按键_多键.indexOf(b);T>-1&&n.当前选中按键_多键.splice(T,1)}else n.当前选中按键_多键.length=0;n.改键_显示高亮=!1}else C.isSelected=!0,n.当前选中按键_单键=b,d()?n.当前选中按键_多键.includes(b)||n.当前选中按键_多键.push(b):(n.当前选中按键_多键.length=0,Object.keys(t.keyboardState.keys).forEach(T=>{T!==b&&(t.keyboardState.keys[T].isSelected=!1)}),n.改键_显示高亮=!0,n.取消高亮_高级键_首页_选择按键())}}})},B=new Set,se={tipElement:null,init(){if(!this.tipElement){this.tipElement=document.createElement("div"),this.tipElement.id="key-binding-tip",this.tipElement.style.position="absolute",this.tipElement.style.backgroundColor="#74EBD5",this.tipElement.style.color="#3E3E3E",this.tipElement.style.padding="8px",this.tipElement.style.borderRadius="4px",this.tipElement.style.zIndex="1000",this.tipElement.style.minWidth="80px",this.tipElement.style.textAlign="center";const e=document.createElement("div");e.style.position="absolute",e.style.left="50%",e.style.bottom="-6px",e.style.transform="translateX(-50%)",e.style.width="0",e.style.height="0",e.style.borderLeft="6px solid transparent",e.style.borderRight="6px solid transparent",e.style.borderTop="6px solid #74EBD5",this.tipElement.appendChild(e),document.body.appendChild(this.tipElement)}return this.tipElement},show(e,o,l,y){const a=this.init(),s=a.lastChild;a.innerHTML="",s&&a.appendChild(s);const c=document.createElement("div");if(B?.has(M.htmlCodeMapHIDCode(e)||null)){const d=document.createElement("span");d.textContent="Fn",d.style.color="#FF0000",c.appendChild(d);const n=document.createElement("span");n.textContent=" + "+o,n.style.color="#3E3E3E",c.appendChild(n)}else c.textContent=o,c.style.color="#3E3E3E";c.style.marginBottom="4px",c.style.fontSize="14px";const h=document.createElement("div");h.style.height="1px",h.style.backgroundColor="rgba(255,255,255,0.3)",h.style.margin="4px 0";const u=document.createElement("div");u.textContent=l,u.style.marginTop="4px",u.style.fontSize="14px",a.insertBefore(u,s),a.insertBefore(h,u),a.insertBefore(c,h),a.style.display="block";const m=y.getBoundingClientRect(),S=a.getBoundingClientRect();a.style.left=`${m.left+(m.width-S.width)/2}px`,a.style.top=`${m.top-S.height-8}px`},hide(){this.tipElement&&(this.tipElement.style.display="none")}},pe={KeyBox_KeyMappings_RT:{type:"svg",str:await U(()=>import("./2a8cd9c4.js"),[],import.meta.url).then(e=>e.default),id:{default:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtPress:"text",text_travelLift:"text",text_rtLift:"text"},invalid:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtLift:"text",text_rtPress:"text",text_travelLift:"text"},systemKey:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtLift:"text",text_rtPress:"text",text_travelLift:"text"},hovered:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtLift:"text",text_rtPress:"text",text_travelLift:"text"},selected_hovered:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtLift:"text",text_rtPress:"text",text_travelLift:"text"},disabled:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtLift:"text",text_rtPress:"text",text_travelLift:"text"},selected:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtLift:"text",text_rtPress:"text",text_travelLift:"text"},changed:{g_baseRect_and_keyCodeText:"g",text_keyCode:"text",rect_border:"rect",g_switchPath_and_switchNumberText:"g",text_switchNumber:"text",text_travelPress:"text",text_rtLift:"text",text_rtPress:"text",text_travelLift:"text"}}}},he={KnobRectLeft_KeyMappings_RT:{type:"svg",str:await U(()=>import("./e6513e97.js"),[],import.meta.url).then(e=>e.default),id:{selected_hovered:{knobRect:"g"},changed:{knobRect:"g"},disabled:{knobRect:"g"},default:{knobRect:"g"},selected:{knobRect:"rect"},hovered:{knobRect:"g"},invalid:{knobRect:"g"},systemKey:{knobRect:"g"}}}},be={KnobRectRight_KeyMappings_RT:{type:"svg",str:await U(()=>import("./4ae0bd8e.js"),[],import.meta.url).then(e=>e.default),id:{selected_hovered:{knobRect:"g"},changed:{knobRect:"g"},disabled:{knobRect:"g"},default:{knobRect:"g"},selected:{knobRect:"rect"},hovered:{knobRect:"g"},invalid:{knobRect:"g"},systemKey:{knobRect:"g"}}}},ge={KnobRectMiddle_KeyMappings_RT:{type:"svg",str:await U(()=>import("./5ca434dd.js"),[],import.meta.url).then(e=>e.default),id:{selected_hovered:{knobRect:"g"},changed:{knobRect:"g"},disabled:{knobRect:"g"},default:{knobRect:"g"},selected:{knobRect:"rect"},hovered:{knobRect:"g"},invalid:{knobRect:"g"},systemKey:{knobRect:"g"}}}},F=(e,o,l)=>{e.forEach(y=>{y.setAttribute("width",o.toString()),l!==void 0&&y.setAttribute("height",l.toString())})},ke=(e,o,l)=>{if(!e)return;const y=e.querySelector("tspan");if(!y)return;const a=y.getBBox().width,s=Number(y.getAttribute("font-size")||12),c=o/2-a/2,h=l/2+s/2;y.setAttribute("x",c.toString()),y.setAttribute("y",h.toString())},me=(e,o,l)=>{e.setAttribute("width",(o+1*2+.85).toString()),e.setAttribute("height",(l+1*2+.85).toString())},Ke=(e,o,l)=>{"text_travelLift"in e.id&&E.svg_setTransformXY(e.id.text_travelLift,o,l),"text_travelPress"in e.id&&E.svg_setTransformY(e.id.text_travelPress,l),"text_rtPress"in e.id&&E.svg_setTransformXY(e.id.text_rtPress,o,l),"text_rtLift"in e.id&&E.svg_setTransformX(e.id.text_rtLift,o)},Se=(e,o)=>{const a=8*(4/(o+2));"text_travelLift"in e.id&&e.id.text_travelLift.setAttribute("font-size",a.toString()),"text_travelPress"in e.id&&e.id.text_travelPress.setAttribute("font-size",a.toString()),"text_rtPress"in e.id&&e.id.text_rtPress.setAttribute("font-size",a.toString()),"text_rtLift"in e.id&&e.id.text_rtLift.setAttribute("font-size",a.toString())},ve=e=>o=>{const{isInvalidKey:l,isDisabled:y,isChanged:a,isSystemKey:s,isSelected:c,isHovered:h,isFnLayer:u,isForceSystemKey:m}=e;return!u&&m||l?o.invalid:y?o.disabled:a?o.changed:s?o.systemKey:c&&h?o.selected_hovered:c?o.selected:h?o.hovered:o.default},we=(e,o)=>{const{switchNumber:l,switchColor:y,travelPress:a,travelLift:s,rtPress:c,rtLift:h,travelPrecision:u,showTravelPressValue:m,showRTPressValue:S,showTravelLiftValue:d,showRTLiftValue:n,isKnobRectLeftKey:i,isKnobRectMiddleKey:b,isKnobRectRightKey:C}=o;if(i||b||C)return;E.setText(e.id.text_switchNumber,l?.toString()??""),E.setFill(e.id.g_switchPath_and_switchNumberText?.querySelector("path"),y??"none");const R=u||2;E.setText(e.id.text_travelPress,a?.toFixed(R).toString()||"0"),E.setText(e.id.text_travelLift,s?.toFixed(R).toString()||"0"),E.setText(e.id.text_rtPress,c?.toFixed(R).toString()||"0"),E.setText(e.id.text_rtLift,h?.toFixed(R).toString()||"0"),e.id.text_travelPress.style.visibility=m?"visible":"hidden",e.id.text_rtPress.style.visibility=S?"visible":"hidden",e.id.text_travelLift.style.visibility=d?"visible":"hidden",e.id.text_rtLift.style.visibility=n?"visible":"hidden"},Ce=e=>{ie();const o=de(),{isFnLayer:l,keyCode:y,keyCodeDisplayText:a,w:s,h:c,x:h,y:u,isDisabled:m=!1,onClick:S,style:d,isKnobRectLeftKey:n,isKnobRectMiddleKey:i,isKnobRectRightKey:b,travelPrecision:C,type:R,isForceSystemKey:T}=e,L=(n||i||b)??!1;return ye({ref:o,onInit:g=>{let _;R==="knob"?n?_=j(he).KnobRectLeft_KeyMappings_RT(g).map(f=>{if(s){const x=f.root.querySelectorAll("rect");F(x,s)}if(c){const x=f.root.querySelectorAll("rect");F(x,s,c)}return f}):i?_=j(ge).KnobRectMiddle_KeyMappings_RT(g).map(f=>{if(s){const x=f.id.knobRect.querySelectorAll("rect");F(x,s)}if(c){const x=f.id.knobRect.querySelectorAll("rect");F(x,s,c)}return f}):b&&(_=j(be).KnobRectRight_KeyMappings_RT(g).map(f=>{if(s){const x=f.id.knobRect.querySelectorAll("rect");F(x,s)}if(c){const x=f.id.knobRect.querySelectorAll("rect");F(x,s,c)}return f})):_=j(pe).KeyBox_KeyMappings_RT(g).map(f=>{E.setText(f.id.text_keyCode,a);const x=f.id.g_baseRect_and_keyCodeText,P=x.querySelector("rect"),K=Number(P?.getAttribute("width")||0),A=Number(P?.getAttribute("height")||0);let D=0,r=0;if(s){const I=x.querySelectorAll("rect");F(I,s),D=s-K}if(c){const I=x.querySelectorAll("rect");F(I,s||K,c),r=c-A}return ke(f.id.text_keyCode,s||K,c||A),"rect_border"in f.id&&me(f.id.rect_border,s||K,c||A),Ke(f,D,r),Se(f,C??2),f});const v=xe({ui:_,keyCode:y,isKnobRect:L,keysToExclude:new Set(L?[y]:[]),excludeConditions:()=>l??!1});return _&&L&&e.isNonModifiableKnobKey&&(_.root.style.pointerEvents="none",_.root.style.cursor="not-allowed"),_&&l&&L&&_&&(_.root.style.pointerEvents="none",_.root.style.cursor="not-allowed"),_&&T&&!l&&(_.root.style.pointerEvents="none",_.root.style.cursor="not-allowed"),{ui:_,cleanup:v}},onRefresh:({ui:g,cleanup:_})=>{if(!g)return;g.hideAll();const v=g.show(ve(e));we(v,e)},onCleanup:({cleanup:g})=>{g?.()}}),$.jsx(re,{type:"左右___主轴居中",divRef:o,onClick:S||void 0,style:{pointerEvents:l&&L?"none":"auto",cursor:l&&L?"not-allowed":"pointer",position:"absolute",left:h+"px",top:u+"px",...d}})},Re=()=>{const[e,o]=te.useState(t.keyboardState);return te.useEffect(()=>{t.createKeyboardStateAsync().then(l=>{t.keyboardState=l,o(l)})},[]),e},Ee=e=>{ie();const{layout:o,width:l,height:y}=e,a=Object.keys(o),s=t,c=Re(),h=s.currentDevice,u=s.travelPrecision,m=a.map(S=>{const d=S,n=!fe.includes(d),i=o[d],b=Number(i.x)||0,C=Number(i.y)||0,R=Number(i.width)||0,T=Number(i.height)||0,L=i.type,g=i.displayText?.[0]||d,_=e.type==="keyMappingsRt"&&s.shouldSwitchBeDisplayed,v=h.磁轴.所有按键.find(q=>q.按键===d);let f,x,P,K;_&&(f=v?.轴体??"高特",x=ue(t.轴体颜色字典[f]??16771625),P=t.supportedSwitchTypes.findIndex(q=>q===f),K=P!==void 0?P+1:void 0);const A=d,D=v?.行程设置?.type==="行程设置"?v?.行程设置?.行程按下:0,r=v?.行程设置?.type==="行程设置"?v?.行程设置?.行程抬起:0,I=v?.rt按下||0,k=v?.rt抬起||0,w=v?.RT||!1,W=c?.keys[d]?.isSelected,X=c?.keys[d]?.isHover,p=s.checkIsSystemKey(A),oe=s.getIs高级键改键(A),ne=s.shouldShowChangedStatus(A),ce=s.shouldShowDisabledStatus(A);let V=!1,H=!1,z=!1,O=!1;s.current键盘设置页SubpageIndex!==N.磁轴设置||oe?(V=!1,H=!1,z=!1,O=!1):w?(V=!0,H=!1,z=!0,O=!0):(V=!0,H=!0,z=!1,O=!1);let Y,J,Q=!1,Z=!1,ee=!1;const G=s.knobKeyCodes;if(G&&(Y=G.find(q=>q.startsWith(d))??void 0,J=d.split("_")[1]?Number(d.split("_")[1])-1:0,Y))switch(G.indexOf(Y)%3){case 0:Q=!0;break;case 1:Z=!0;break;case 2:ee=!0;break}return $.jsx(Ce,{isFnLayer:s.isFnLayer??!1,type:L,knobIndex:J??0,isKnobRectLeftKey:Q,isKnobRectMiddleKey:Z,isKnobRectRightKey:ee,keyCode:d,keyCodeDisplayText:g,w:R,h:T,x:b,y:C,switchNumber:K,switchColor:x,travelPress:D,travelLift:r,rtPress:I,rtLift:k,travelPrecision:u,showTravelPressValue:V,showTravelLiftValue:H,showRTPressValue:z,showRTLiftValue:O,isInvalidKey:n,isSelected:W,isHovered:X,isChanged:ne,isDisabled:ce,isSystemKey:p,isForceSystemKey:h.deviceType.other?.forceSystemKeyCodes?.includes(d),isNonModifiableKnobKey:h.deviceType.other?.nonModifiableKnobKeyCodes?.includes(d)},d)});return $.jsx(re,{type:"左右___主轴居中",w:l,h:y,style:{position:"relative"},children:m})};export{Ee as KeyMappingsRtKeyboard};
