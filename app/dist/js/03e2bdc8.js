import{u as R,a as B,r as f,d as e,P as d,j as a,a4 as m,a5 as l,V as C,I as D,i as P}from"./index.b078bf5f.js";import{u as T,D as j,a as O}from"./e46f8f92.js";import{S as W}from"./9cc765b4.js";import"./eb259a23.js";const U=()=>{R();const c=B(),[A,_]=f.useState(1),b=6;f.useState(!1);const{buttonRefs:x,dropdownState:g,setDropdownState:I,handleDropdownSelect:S}=T(),[h,L]=f.useState(""),[p,y]=f.useState(""),[w,F]=f.useState(""),N=f.useMemo(()=>e.allConfigsInDb.sort((i,t)=>i.create_at-t.create_at),[e.allConfigsInDb]);f.useEffect(()=>{if(!e.isUseIotSDK)return;const i=e.getCurrentDevice().deviceType.type==="mouse",t=i?"config_mouse":"config";(async()=>{const s=e.getCurrentCompany?.()??"",o=(await m.getAllItems(l.DBPATH.CONFIG_NEW,l.DBPATH.CONFIG_NEW_BUFFER)).filter(u=>(P?u?.company===s:!0)&&(i?u.screen_type.toLowerCase()===t:u.screen_type.toLowerCase().includes(t)&&u.screen_type.toLowerCase()!=="config_mouse"));e.allConfigsInDb=o})()},[e.isUseIotSDK]);const E=i=>{if(i.currentTarget.value.length>20){d.next({type:"error",message:c.名称不能超过20个字符||"名称不能超过20个字符"});return}y(i.currentTarget.value.slice(0,20))};f.useEffect(()=>{(e.getCurrentDevice().按键修改动作?.type==="fn配置修改"||e.getCurrentDevice().按键修改动作?.type==="配置修改")&&(e.isWriteConfigStarted=!0)},[e.getCurrentDevice().按键修改动作]),f.useEffect(()=>{e.isWriteConfigStarted&&e.getCurrentDevice().按键修改动作===void 0&&(d.next({type:"success",message:c.写入成功||"写入成功"}),e.isWriteConfigStarted=!1)},[e.isWriteConfigStarted,e.getCurrentDevice().按键修改动作]);const v=[{key:"title",title:c.配置名称||"配置名称",width:"4fr",render:(i,t)=>{const n=e.state_localConfigPage;if(n.isRenaming&&n.currentItemId===t.id?.toString())return a.jsx("input",{id:"inputField",value:p,onInput:s=>{E(s)},onKeyDown:s=>{if(s.key==="Enter"){if(p.trim()===""){d.next({type:"error",message:c.名称不能为空||"名称不能为空"}),n.isRenaming=!1;return}if(p===h){n.isRenaming=!1;return}n.isRenaming=!1;const r=e.allConfigsInDb.findIndex(o=>o.id===t.id);if(r===-1){n.isRenaming=!1;return}if(r!==-1){const o={...t};o.title=p,m.deleteItem(t,l.DBPATH.CONFIG_NEW,l.DBPATH.CONFIG_NEW_BUFFER),m.saveItemToDb(o,l.DBPATH.CONFIG_NEW,l.DBPATH.CONFIG_NEW_BUFFER);const u=[...e.allConfigsInDb];u[r]=o,e.allConfigsInDb=u,d.next({type:"success",message:c.重命名成功||"重命名成功"})}}},onFocus:s=>{y(""),s.target.style.borderColor="#1890ff",s.target.style.boxShadow="0 0 0 2px rgba(24, 144, 255, 0.2)"},onBlur:s=>{if(p.trim()===""||p===h){e.state_localConfigPage.isRenaming=!1;return}s.target.style.borderColor="#d9d9d9",s.target.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)",n.isRenaming=!1;const r=e.allConfigsInDb.findIndex(o=>o.id===t.id);if(r!==-1){const o={...t};o.title=p,m.deleteItem(t,l.DBPATH.CONFIG_NEW,l.DBPATH.CONFIG_NEW_BUFFER),m.saveItemToDb(o,l.DBPATH.CONFIG_NEW,l.DBPATH.CONFIG_NEW_BUFFER);const u=[...e.allConfigsInDb];u[r]=o,e.allConfigsInDb=u,d.next({type:"success",message:c.重命名成功||"重命名成功"})}},style:{width:"50%",padding:"8px 12px",borderRadius:"4px",border:"1px solid #d9d9d9",fontSize:"14px",outline:"none",transition:"all 0.3s",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},autoFocus:!0});{const s=t.title;return a.jsx("div",{onClick:()=>{n.isRenaming=!0,n.currentItemId=t.id,y("")},style:{cursor:"pointer",fontSize:"14px",outline:"none",transition:"all 0.3s"},children:s})}}},{key:"write",title:c.写入||"写入",width:"1fr",render:(i,t)=>a.jsx(C,{w:30,h:30,style:{cursor:"pointer",margin:"0 auto"},children:a.jsx(D,{type:"写入",onClick:async()=>{await e.handleWriteConfig(t.id)}})})},{key:"delete",title:c.删除,width:"1fr",render:(i,t)=>a.jsx(C,{w:30,h:30,style:{cursor:"pointer",margin:"0 auto"},children:a.jsx(D,{type:"删除",onClick:async()=>{if(await m.deleteItem(t,l.DBPATH.CONFIG_NEW,l.DBPATH.CONFIG_NEW_BUFFER)){const n=[...e.allConfigsInDb],s=n.findIndex(r=>r.id===t.id);s!==-1&&n.splice(s,1),e.allConfigsInDb=n,d.next({type:"success",message:c.删除当前作品成功})}else d.next({type:"error",message:c.删除当前作品失败})}})})},{key:"operation",title:c.操作,width:"1fr",render:(i,t)=>a.jsxs(C,{w:30,h:30,style:{cursor:"pointer",margin:"0 auto",position:"relative"},children:[a.jsx(D,{type:"操作",onClick:()=>{const n=window.event;n&&n.stopPropagation(),F(t.title);const s=x.current.get(t.id);if(s){const r=s.getBoundingClientRect();g.isOpen&&g.itemId===t.id?I(o=>({...o,isOpen:!1})):I({isOpen:!0,position:{x:r.left-45,y:r.bottom+2},itemId:t.id})}}}),a.jsx("div",{ref:n=>{n?x.current.set(t.id,n):x.current.delete(t.id)},style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none"}})]})}];return a.jsxs(C,{type:"左右___主轴居中",w:"95%",h:"95%",style:{backgroundColor:"#FFFFFF",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1)",borderRadius:"12px",width:"clamp(650px, 90%, 1465px)",height:"clamp(400px, 95%, 843px)",flex:"1 1 0%",alignItems:"center",justifyContent:"center",margin:"0 25px"},children:[a.jsx(j,{columns:v,dataSource:N,pageSize:b,onPageChange:_,style:{padding:"20px",flex:"1 1 auto"},headerStyle:{display:"flex",alignItems:"center",justifyContent:"center"}}),a.jsx(O,{isOpen:g.isOpen,onClose:()=>I(i=>({...i,isOpen:!1})),position:g.position,onSelect:async i=>{S(g.itemId,i)},menuItems:e.companyConfig.newSingleDriver?["rename"]:["rename","share"]}),a.jsx(W,{show:e.showShareModal,type:"config",name:w,onCancel:()=>{e.showShareModal=!1},onConfirm:async i=>{e.showShareModal=!1,await e.handleShareConfig(w??"",i.description??"",g.itemId??"")},disableButtons:e.isWaitingServerResponse})]})};export{U as Page_LocalConfigs_本地配置};
