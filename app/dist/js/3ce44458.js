import{a9 as R,d as r,灯 as H,a as N,键 as A,aa as x,c as K,ab as D,ac as j}from"./index.b078bf5f.js";const F=new class{openColorPicker=e=>{const n=document.createElement("input");n.type="color",n.value=e.value,n.style.opacity="0",n.style.pointerEvents="none",n.style.margin="0px",n.style.padding="0px",n.style.width="0px",n.style.height="0px",e.position&&(n.style.position="absolute",e.position.top&&(n.style.top=e.position.top),e.position.left&&(n.style.left=e.position.left),e.position.right&&(n.style.right=e.position.right),e.position.bottom&&(n.style.bottom=e.position.bottom)),n.oninput=i=>{const c=i.target.value,l=parseInt(c.slice(1),16);e.onChange(l)},e.div?(e.div.innerHTML="",e.div.style.position="relative",e.div.appendChild(n)):document.body.appendChild(n),requestAnimationFrame(()=>n.click())};hydrateKeyboard=e=>{const n=document.createDocumentFragment(),i=[],c=this.getDefRects(e.ui),l=e.knobKeyCodes?e.knobKeyCodes:[],a=Object.values(F.getDefRects(e.ui)).map(o=>o.getAttribute("transform")??"translate(0 0)"),g=a.map(o=>o?.match(/translate\((\d+)/)?.[1]).sort((o,t)=>Number(o)-Number(t)),u=a.map(o=>o?.match(/translate\(\d+ (\d+)/)?.[1]??0).sort((o,t)=>Number(o)-Number(t)),h=o=>{const t=l.indexOf(o);return g[t]},y=o=>{const t=l.indexOf(o);return u[t]};return Object.keys(e.ui?.status?.default?.id??{}).forEach(o=>{const t=o;if(e.keysToExclude&&e.keysToExclude.has(String(t)))return;const d=e.ui.status?.default?.id[t]?.getBBox();let C=!1,S=null,B=null,v=null,w=null,E=null;if(l.includes(String(t))){C=!0,S=c.shift(),B=S?.getBBox()?.width,v=S?.getBBox()?.height,w=h(t);for(let f=0;f<g?.length;f++)if(g[f]===t){w=g[f];break}E=y(t);for(let f=0;f<u?.length;f++)if(u[f]===t){E=u[f];break}}else C=!1;const M=R.svg_create_element("rect",{x:String(C?w:d?.x??0),y:String(C?E:d?.y??0),width:String(C?B:d?.width??0),height:String(C?v:d?.height??0),fill:"transparent"});n.appendChild(M),M.style.cursor="pointer",i.push(M),this.#e(M,t,e.onHover,e.onCurrent)}),e.ui.root.appendChild(n),()=>{i.forEach(o=>{const t=o.cloneNode(!0);o.parentNode?.replaceChild(t,o),t.remove()})}};hydrateKeyBox=e=>{const n=document.createDocumentFragment();let i=null;try{let c;if("g_baseRect_and_keyCodeText"in e.ui?.status?.default?.id&&e.ui?.status?.default?.id.g_baseRect_and_keyCodeText&&(c=(e.ui?.status?.default?.id.g_baseRect_and_keyCodeText).getBBox()),e.isKnobRect&&(c=F.getDefRects(e.ui)[0]?.getBBox()),!c)throw new Error("keyBoundingBox is null");if(i=R.svg_create_element("rect",{x:String(c?.x??0),y:String(c?.y??0),width:String(c?.width??0),height:String(c?.height??0),fill:"transparent"}),!i)throw new Error("rect is null");return n.appendChild(i),i.style.cursor="pointer",this.#e(i,e.keyCode,e.onHover,e.onSelect),e.ui.root.appendChild(n),()=>{if(i){const l=i.cloneNode(!0);i.parentNode?.replaceChild(l,i),l.remove(),i=null}}}catch{return()=>{i&&(i.remove(),i=null)}}};#e=(e,n,i,c)=>{try{if(!e)throw new Error("element is null");e.addEventListener("mouseenter",()=>i(n,!0)),e.addEventListener("mouseleave",()=>i(n,!1)),e.addEventListener("mousedown",l=>{l.buttons===1?c(n,!0):c(n,!1)}),e.addEventListener("mouseover",l=>{l.buttons===1&&c(n,!0)})}catch{return}};updateKeyboard=(e,n)=>{Object.keys(e?.status?.default?.id??{}).forEach(i=>{n(i)})};getClipPathId=(e,n)=>{const i=n.root.querySelector("defs")?.querySelector("clipPath");return i&&i.getAttribute("id")||""};getDefRects=e=>{const n=e.root.querySelector("defs");return n?Array.from(n.querySelectorAll("rect")).map(c=>c):[]};addColorBrushEffects=(e,n,i)=>r.current灯光设置页SubpageIndex===H.灯光||r.current灯光设置页SubpageIndex===H.灯带||!r.state_lightCustomizationPage||!r.keyboardState.keys?void 0:F.hydrateKeyboard({ui:e,knobKeyCodes:r.getCurrentDevice()?.deviceType.other?.knobKeyCodes??[],onHover:(a,g)=>{if(n&&n.has(a)&&i&&i())return;const u=r.keyboardState.keys[a];u&&(u.isHover=g,r.state_lightCustomizationPage.penColorPickerOn)},onCurrent:(a,g)=>{if(!(n&&n.has(a)&&i&&i())&&g){const u=r.state_lightCustomizationPage,h=r.keyboardState.keys[a];h&&(h.isSelected=!0,u.penColorPickerOn?(r.state_lightCustomizationPage.penColor=h.keyColor,u.penColorPickerOn=!1):h.keyColor=u.penColor,r.当前选中按键_单键=a,r.当前选中按键_多键.includes(a)||r.当前选中按键_多键.push(a))}}});addKeySelectionAndMappingEffects=(e,n,i,c,l)=>{const k=new Set;F.hydrateKeyboard({ui:e,knobKeyCodes:l??[],keysToExclude:n??new Set,onHover:(a,g)=>{if(!a||c&&c==="hover"||n&&n.has(a)&&i&&i()||r.state_行程设置.is滚动行程滚轮)return;const u=new Set(r.getCurrentDevice()?.deviceType.other?.knobKeyCodes??[]),h=new Set(Object.keys(r.keyboardState.keys)),y=r.keyboardState,o=N();if(!a)return;const t=a;if(!t)return;const d=r.isFnLayer;if(u.has(t)&&r.current键盘设置页SubpageIndex===A.高级设置||u.has(t)&&r.current键盘设置页SubpageIndex===A.磁轴设置||u.has(t)&&d||!h.has(t))return;const C=y.keys[t];C&&(C.isHover=g);const S=r.getCurrentDevice(),B=d?S.KB改键设置.所有Fn改键信息:S.KB改键设置.所有改键信息,v=d?r.板载_fn层:r.板载,w=B.find(s=>s.profile===v&&s.sonProfile===r.getCurrentSonProfile()&&s.isFn===d),E=x.htmlCodeMapHIDCode(t),M=r.getKeyIndex(t),f=w?.configs?.find(s=>(s.type==="combo"||s.type==="ConfigFunction"||s.type==="forbidden"||s.type==="ConfigMacro"||s.type==="ConfigUnknown"||s.type==="ConfigMT"||s.type==="ConfigSnap"||s.type==="ConfigMDS"||s.type==="ConfigMouse")&&s.original===E&&s.index===M),I=K.高级键_当前绑定项?.find(s=>s.originalKeys.includes(t));if(g){y.keys[t].isHover=g;let s="",P=D[t]||t;if(I&&!d){let m=I.type;switch(m){case"SnapKey":s="SnapKey: "+I.originalKeys.filter(_=>_!==t)?.map(_=>D[_]);break;case"DKS":s=o.tipText_动态键程||"";break;case"MT":s=o.tipText_按住单击||"";break;case"TGL":s=o.tipText_切换开关||"";break;default:s=m}}else if(f)switch(f.type){case"ConfigMT":s=o.tipText_按住单击||"";break;case"ConfigSnap":{const T=w?.configs?.filter(b=>b.type==="ConfigSnap"&&b.number===f.number)?.filter(b=>b.original!==E).map(b=>D[x.hidCodeMapHtmlCode(b.keyCode)]).filter(Boolean)||[];s="SnapKey: "+(T.length>0?T.join(" "):"");break}case"ConfigMDS":{const T=w?.configs?.filter(b=>b.type==="ConfigMDS"&&b.number===f.number)?.filter(b=>b.original!==E).map(b=>D[x.hidCodeMapHtmlCode(b.keyCode??0)]).filter(Boolean)||[];s="MDS: "+(T.length>0?T.join(" "):"");break}case"forbidden":s=K.isFnLayer?"":o.已禁用||"";break;case"combo":const m=[];if(f.skey){const p=x.hidCodeMapHtmlCode(f.skey);p&&m.push(p)}if(f.key){const p=x.hidCodeMapHtmlCode(f.key);p&&m.push(p)}if(f.key2){const p=x.hidCodeMapHtmlCode(f.key2);p&&m.push(p)}const _=m.map(p=>D[p]);K.isFnLayer&&k.add(x.htmlCodeMapHIDCode(t)||null),s=_.join(" + ");break;case"ConfigFunction":const L=w?.configs?.find(p=>p.type==="ConfigFunction"&&p.original===E);if(L){const p=L?.key;s=o[p]||p,K.isFnLayer&&k.add(x.htmlCodeMapHIDCode(t)||null)}break;case"ConfigMouse":const O=w?.configs?.find(p=>p.type==="ConfigMouse"&&p.original===E);s=o[j[O?.key]]||"",K.isFnLayer&&k.add(x.htmlCodeMapHIDCode(t)||null);break;case"ConfigMacro":s=o.宏||"",K.isFnLayer&&k.add(x.htmlCodeMapHIDCode(t)||null);break;case"ConfigUnknown":s=o.系统按键||"";break}else if(K.getCurrentDevice()?.磁轴?.WASDSwap===!0&&!K.isFnLayer){const m={KeyW:"ArrowUp",KeyA:"ArrowLeft",KeyS:"ArrowDown",KeyD:"ArrowRight"},_={ArrowUp:"KeyW",ArrowLeft:"KeyA",ArrowDown:"KeyS",ArrowRight:"KeyD"};new Set(["KeyW","KeyA","KeyS","KeyD"]).has(t)&&(s=o.快捷改键+"("+D[m[t]]+")"||""),new Set(["ArrowUp","ArrowLeft","ArrowDown","ArrowRight"]).has(t)&&(s=o.快捷改键+"("+D[_[t]]+")"||"")}if(K.isFnLayer&&t==="Fn"&&(s=o.系统按键||""),s){let m=null;Object.values(e.status).forEach(_=>{_.id[t].style.display!=="none"&&(m=_.id[t])}),m&&this.KeyTip.show(P,s,m,k)}}else this.KeyTip.hide();k.clear()},onCurrent:(a,g)=>{if(!a)return;const u=r.getCurrentDevice().deviceType?.version?.rf??r.getCurrentDevice().deviceType?.version?.usb;if(r.current键盘设置页SubpageIndex===A.磁轴设置&&u&&u<768&&r.getCurrentDevice().磁轴.磁轴键盘模式!="custom"||c&&c==="current"||n&&n.has(a)&&i&&i())return;const h=()=>K.按键选择方式!=="单选",y=K,o=new Set(r.getCurrentDevice()?.deviceType.other?.knobKeyCodes??[]),t=new Set(Object.keys(r.keyboardState.keys));if(!a)return;const d=a;if(!d)return;const C=r.isFnLayer;if(!(o.has(d)&&r.current键盘设置页SubpageIndex===A.高级设置||o.has(d)&&r.current键盘设置页SubpageIndex===A.磁轴设置||o.has(d)&&C)&&!r.state_行程设置.is滚动行程滚轮&&g){const S=r.keyboardState.keys[d];if(!t.has(d)||!S)return;if(S.isSelected){if(S.isSelected=!1,y.当前选中按键_单键===d&&(y.当前选中按键_单键=null),h()){const v=y.当前选中按键_多键.indexOf(d);v>-1&&y.当前选中按键_多键.splice(v,1)}else y.当前选中按键_多键.length=0;y.改键_显示高亮=!1}else S.isSelected=!0,y.当前选中按键_单键=d,h()?y.当前选中按键_多键.includes(d)||y.当前选中按键_多键.push(d):(y.当前选中按键_多键.length=0,Object.keys(r.keyboardState.keys).forEach(v=>{v!==d&&(r.keyboardState.keys[v].isSelected=!1)}),y.改键_显示高亮=!0,y.取消高亮_高级键_首页_选择按键())}}})};KeyTip={tipElement:null,init(){if(!this.tipElement){this.tipElement=document.createElement("div"),this.tipElement.id="key-binding-tip",this.tipElement.style.position="absolute",this.tipElement.style.backgroundColor="#74EBD5",this.tipElement.style.color="#3E3E3E",this.tipElement.style.padding="8px",this.tipElement.style.borderRadius="4px",this.tipElement.style.zIndex="1000",this.tipElement.style.minWidth="80px",this.tipElement.style.textAlign="center";const e=document.createElement("div");e.style.position="absolute",e.style.left="50%",e.style.bottom="-6px",e.style.transform="translateX(-50%)",e.style.width="0",e.style.height="0",e.style.borderLeft="6px solid transparent",e.style.borderRight="6px solid transparent",e.style.borderTop="6px solid #74EBD5",this.tipElement.appendChild(e),document.body.appendChild(this.tipElement)}return this.tipElement},show(e,n,i,c){const l=this.init(),k=l.lastChild;l.innerHTML="",k&&l.appendChild(k);const a=document.createElement("div"),g=i.id.slice(1);if(c?.has(x.htmlCodeMapHIDCode(g)||null)){const t=document.createElement("span");t.textContent="Fn",t.style.color="#FF0000",a.appendChild(t);const d=document.createElement("span");d.textContent=" + "+e,d.style.color="#3E3E3E",a.appendChild(d)}else a.textContent=e,a.style.color="#3E3E3E";a.style.marginBottom="4px",a.style.fontSize="14px";const u=document.createElement("div");u.style.height="1px",u.style.backgroundColor="rgba(255,255,255,0.3)",u.style.margin="4px 0";const h=document.createElement("div");h.textContent=n,h.style.marginTop="4px",h.style.fontSize="14px",l.insertBefore(h,k),l.insertBefore(u,h),l.insertBefore(a,u),l.style.display="block";const y=i.getBoundingClientRect(),o=l.getBoundingClientRect();l.style.left=`${y.left+(y.width-o.width)/2}px`,l.style.top=`${y.top-o.height-8}px`},hide(){this.tipElement&&(this.tipElement.style.display="none")}}};export{F as u};
