import{r as f,j as t,V as y,u as B,a as W,G as K,d as o,aH as O,e as T,社 as q,M as N,a3 as Q,H as D,c as w,y as F,P as _,aI as M,a5 as R,a4 as $,aJ as X,aD as Y,aK as ee}from"./index.b078bf5f.js";class te extends f.Component{state={hasError:!1};static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){this.props.onError&&this.props.onError(n,a)}handleRetry=()=>{this.setState({hasError:!1,error:void 0}),this.props.onRetry&&this.props.onRetry()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:t.jsxs(y,{type:"上下",w:"full",h:"full",style:{justifyContent:"center",alignItems:"center",padding:"40px",gap:"24px"},children:[t.jsxs("svg",{width:"160",height:"160",viewBox:"0 0 160 160",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.3333 26.6667C13.3333 20.1334 18.4666 14.6667 25.3333 14.6667H134.667C141.533 14.6667 146.667 20.1334 146.667 26.6667V133.333C146.667 139.867 141.533 145.333 134.667 145.333H25.3333C18.4666 145.333 13.3333 139.867 13.3333 133.333V26.6667ZM25.3333 26.6667V46.6667H134.667V26.6667H25.3333ZM25.3333 58.6667V78.6667H58.6666V58.6667H25.3333ZM70.6666 58.6667V78.6667H104V58.6667H70.6666ZM116 58.6667V78.6667H134.667V58.6667H116ZM25.3333 90.6667V110.667H58.6666V90.6667H25.3333ZM70.6666 90.6667V110.667H104V90.6667H70.6666ZM116 90.6667V110.667H134.667V90.6667H116ZM25.3333 122.667V133.333H134.667V122.667H25.3333Z",fill:"#E74C3C"}),t.jsx("path",{d:"M80 60L100 100L60 100L80 60Z",fill:"#FFF"}),t.jsx("circle",{cx:"80",cy:"85",r:"3",fill:"#E74C3C"}),t.jsx("rect",{x:"77",y:"70",width:"6",height:"10",fill:"#E74C3C"})]}),t.jsxs(y,{type:"上下",style:{alignItems:"center",gap:"8px"},children:[t.jsx("div",{style:{color:"var(--主色字, #606060)",fontSize:20,fontFamily:"PingFang SC",fontWeight:"600",textAlign:"center"},children:"数据表格加载失败"}),t.jsx("div",{style:{color:"var(--不重要字, #D5D5D5)",fontSize:14,fontFamily:"PingFang SC",fontWeight:"400",textAlign:"center",maxWidth:"400px",lineHeight:"1.5"},children:"数据源可能存在问题或格式不正确，请检查数据格式是否符合要求"})]}),this.props.onRetry&&t.jsx("button",{onClick:this.handleRetry,style:{padding:"12px 24px",backgroundColor:"var(--color-highlight-2)",color:"#FFFFFF",border:"none",borderRadius:"6px",fontSize:14,fontFamily:"PingFang SC",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--color-highlight-2-hover, #007AFF)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--color-highlight-2)"},children:"重新加载数据"}),!1]}):this.props.children}}const re=(l={})=>{const[n,a]=f.useState({hasError:!1}),b=f.useCallback(()=>{a({hasError:!1,error:void 0})},[]),c=f.useCallback(s=>{a({hasError:!0,error:s}),l.onError&&l.onError(s)},[l.onError]),p=f.useCallback((s,u)=>(...v)=>{try{return s(...v)}catch(x){return c(x),u}},[c]),C=f.useCallback((s,u)=>async(...v)=>{try{return await s(...v)}catch(x){return c(x),u}},[c]);return{hasError:n.hasError,error:n.error,handleError:c,resetError:b,safeExecute:p,safeExecuteAsync:C}},ne=(l,n)=>{if(!Array.isArray(l))throw new Error(`DataTable: dataSource 必须是数组，当前类型为: ${typeof l}`);n.forEach((a,b)=>{if(!a||typeof a.key!="string"||a.key.trim()==="")throw new Error(`DataTable: column[${b}] 必须有有效的 key 属性`);if(a.title&&typeof a.title!="string")throw new Error(`DataTable: column[${b}].title 必须是字符串类型`);if(a.render&&typeof a.render!="function")throw new Error(`DataTable: column[${b}].render 必须是函数类型`)}),l.length>0&&l.forEach((a,b)=>{if(a==null)throw new Error(`DataTable: dataSource[${b}] 不能为 null 或 undefined`);if(typeof a!="object")throw new Error(`DataTable: dataSource[${b}] 必须是对象，当前类型为: ${typeof a}`);n.filter(p=>!p.render).filter(p=>!(p.key in a)).map(p=>p.key).length>0})},ae=({columns:l,dataSource:n,pageSize:a=6,style:b,headerStyle:c,rowStyle:p,onPageChange:C,totalPagesFromServer:s,currentPageFromServer:u,onRetry:v})=>{B();const x=W(),{safeExecute:h}=re({onError:e=>{}});f.useMemo(()=>{try{ne(n,l)}catch(e){throw e}},[n,l]);const[d,k]=f.useState(u||1),[j,E]=f.useState(""),[I,V]=f.useState(0),[A,Z]=f.useState(0),H=K();f.useEffect(()=>{u&&k(u)},[u]),f.useEffect(()=>{H.current&&(V(H.current.clientWidth),Z(H.current.clientHeight))},[H.current?.clientWidth,H.current?.clientHeight]);const r=f.useMemo(()=>s||Math.ceil(n.length/a),[s,n.length,a]);f.useEffect(()=>{r<d&&r>0&&k(r)},[r,d]);const P=()=>{if(u)return n;const e=(d-1)*a,i=e+a;return n.slice(e,i)},S=h(()=>{const e=parseInt(j);e&&e>0&&e<=r&&(k(e),E(""),C?.(e))}),L=h(e=>{if(!Number.isInteger(e)||e<=0)throw new Error(`无效的页码: ${e}`);if(e>r)throw new Error(`页码 ${e} 超出最大页数 ${r}`);k(e),C?.(e)}),G=()=>{if(r<=9)return Array.from({length:r},(m,J)=>({type:"page",page:J+1}));const e=[];let i=Math.max(1,d-2),g=Math.min(r,d+2);d<=5?(i=1,g=Math.min(r,7)):d>=r-4&&(i=Math.max(1,r-6),g=r),i>1&&(e.push({type:"page",page:1}),i>2&&e.push({type:"ellipsis",range:[2,i-1]}));for(let m=i;m<=g;m++)e.push({type:"page",page:m});return g<r&&(g<r-1&&e.push({type:"ellipsis",range:[g+1,r-1]}),e.push({type:"page",page:r})),e},U=e=>{const i=Math.floor((e[0]+e[1])/2);L(i)},z=(e,i,g)=>{try{return e.render?e.render(i,g):i}catch{return t.jsx(N,{})}};return t.jsxs(y,{type:"上下",w:"full",h:"full",children:[n.length===0&&!o.isWaitingServerResponse?t.jsxs(y,{type:"上下",w:"full",h:"full",style:{justifyContent:"center",alignItems:"center"},children:[t.jsx("svg",{width:"190",height:"189",viewBox:"0 0 190 189",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.63087 4.18C2.5005 2.89342 3.67227 1.83965 5.04359 1.11093C6.41491 0.382207 7.94396 0.00076585 9.49687 7.45845e-07H113.997C115.895 0.00120228 117.75 0.571092 119.321 1.63617C120.892 2.70125 122.109 4.21267 122.813 5.9755L129.947 23.7975L133.177 7.638C133.608 5.4836 134.772 3.54506 136.471 2.15241C138.17 0.759769 140.3 -0.000869465 142.497 7.45845e-07H180.497C181.902 0.000849148 183.289 0.313313 184.559 0.914884C185.828 1.51645 186.949 2.39215 187.839 3.47889C188.73 4.56562 189.368 5.83634 189.708 7.19949C190.049 8.56264 190.082 9.98429 189.807 11.362L180.497 57.95V133C180.497 138.039 178.495 142.872 174.932 146.435C171.369 149.998 166.536 152 161.497 152H37.9969C32.9578 152 28.125 149.998 24.5618 146.435C20.9987 142.872 18.9969 138.039 18.9969 133V58.8335L0.680872 13.015C0.103765 11.5739 -0.111394 10.0133 0.0542189 8.4698C0.219832 6.92629 0.761169 5.44688 1.63087 4.161V4.18ZM37.9969 66.5V133H123.497V66.5H37.9969ZM142.497 66.5V133H161.497V66.5H142.497ZM163.207 47.5L168.907 19H150.287L144.587 47.5H163.207ZM118.965 47.5L107.565 19H23.5284L34.9284 47.5H118.965ZM85.4969 114C85.4969 111.48 86.4978 109.064 88.2794 107.282C90.061 105.501 92.4773 104.5 94.9969 104.5H104.497C107.016 104.5 109.433 105.501 111.214 107.282C112.996 109.064 113.997 111.48 113.997 114C113.997 116.52 112.996 118.936 111.214 120.718C109.433 122.499 107.016 123.5 104.497 123.5H94.9969C92.4773 123.5 90.061 122.499 88.2794 120.718C86.4978 118.936 85.4969 116.52 85.4969 114Z",fill:"#D5D5D5"})}),t.jsx("div",{style:{color:"var(--不重要字, #D5D5D5)",fontSize:24,fontFamily:"PingFang SC",fontWeight:"500",wordWrap:"break-word"},children:x.暂无数据||"暂无数据"})]}):t.jsx(y,{type:"上下",w:"full",h:"full",style:{gap:"12px",...b},children:t.jsxs(t.Fragment,{children:[t.jsx(y,{type:"左右",w:I,h:28,style:{display:"flex",alignItems:"center",justifyContent:"center",...c},children:t.jsx(O,{columns:l,style:{padding:"0 10px"},children:l.map(e=>t.jsx(y,{h:28,style:{textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(T,{type:"小标题",text:e.title??""})},e.key))})}),t.jsxs(y,{divRef:H,type:"上下",w:"full",h:"full",style:{flex:"1 1 0%",gap:12,overflow:"auto",justifyContent:"flex-start",position:"relative"},children:[P().map((e,i)=>t.jsx(O,{columns:l,style:{maxHeight:a===6?88:48,alignItems:"center",backgroundColor:"var(--color-background)",borderRadius:"12px",...p},children:l.map(g=>t.jsx(y,{style:{textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center"},children:z(g,e[g.key],e)},g.key))},i)),o.isWaitingServerResponse&&o.current社区分享SubpageIndex!=q.动画分享&&t.jsxs(y,{type:"上下",w:"full",h:"full",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.3)",justifyContent:"center",alignItems:"center",gap:12,zIndex:1e3,borderRadius:"12px"},children:[t.jsx(N,{}),t.jsx(T,{type:"小标题",text:x.请稍候||"请稍候"})]})]})]})}),t.jsxs(y,{type:"左右",w:"90%",h:60,style:{flex:"0 0 0%",justifyContent:"center",alignItems:"center",gap:"10px",padding:"10px 0",visibility:n.length>0?"visible":"hidden"},children:[t.jsx("button",{disabled:d===1,style:{boxShadow:"none",border:"none",backgroundColor:"var(--color-background)",borderRadius:"6px",width:"40px",height:"40px",minWidth:"20px",minHeight:"20px",display:"flex",alignItems:"center",justifyContent:"center",cursor:d===1?"not-allowed":"pointer"},onMouseDown:()=>{d!==1&&L(d-1)},onMouseEnter:e=>{const i=e.currentTarget;i.style.backgroundColor="var(--color-background-hover)"},onMouseLeave:e=>{const i=e.currentTarget;i.style.backgroundColor="var(--color-background)"},children:t.jsx("svg",{width:"7",height:"10",viewBox:"0 0 7 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.13381 0.580827C6.36815 0.815237 6.4998 1.13312 6.4998 1.46458C6.4998 1.79603 6.36815 2.11392 6.13381 2.34833L3.48257 4.99958L6.13381 7.65083C6.24995 7.76688 6.34209 7.90468 6.40498 8.05634C6.46786 8.20801 6.50026 8.37057 6.50032 8.53476C6.50038 8.69895 6.46809 8.86154 6.40532 9.01324C6.34254 9.16496 6.2505 9.30281 6.13444 9.41895C6.01838 9.53509 5.88059 9.62723 5.72892 9.69011C5.57726 9.753 5.41469 9.7854 5.25051 9.78546C5.08632 9.78551 4.92373 9.75323 4.77202 9.69045C4.62031 9.62768 4.48245 9.53563 4.36632 9.41958L0.831315 5.88333C0.596976 5.64892 0.465332 5.33103 0.465332 4.99958C0.465332 4.66812 0.596976 4.35024 0.831315 4.11583L4.36632 0.580827C4.60073 0.346488 4.91861 0.214844 5.25006 0.214844C5.58152 0.214844 5.89941 0.346488 6.13381 0.580827Z",fill:"#989898"})})}),t.jsx(y,{type:"左右",style:{alignItems:"center",gap:"10px"},children:G().map((e,i)=>t.jsx(Q.Fragment,{children:e.type==="page"?t.jsx(y,{w:40,h:40,style:{minWidth:20,minHeight:20,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:e.page===d?"var(--color-highlight-2)":"var(--color-background)",borderRadius:"6px",cursor:"pointer"},onMouseEnter:g=>{const m=g.currentTarget;m.style.backgroundColor="var(--color-background-hover)"},onMouseLeave:g=>{const m=g.currentTarget;e.page===d?m.style.backgroundColor="var(--color-highlight-2)":m.style.backgroundColor="var(--color-background)"},onMouseDown:()=>{e.page!==d&&L(e.page)},children:t.jsx(T,{type:"正文内容",text:e.page.toString()})}):t.jsx(y,{w:40,h:40,style:{minWidth:20,minHeight:20,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"var(--color-background)",borderRadius:"6px",cursor:"pointer"},onMouseEnter:g=>{const m=g.currentTarget;m.style.backgroundColor="var(--color-background-hover)"},onMouseLeave:g=>{const m=g.currentTarget;m.style.backgroundColor="var(--color-background)"},onMouseDown:()=>{e.range&&U(e.range)},children:t.jsx(T,{type:"正文内容",text:"..."})})},i))}),t.jsx("button",{disabled:d===r,style:{boxShadow:"none",border:"none",backgroundColor:"var(--color-background)",borderRadius:"6px",width:"40px",height:"40px",minWidth:"20px",minHeight:"20px",display:"flex",alignItems:"center",justifyContent:"center",cursor:d===r?"not-allowed":"pointer"},onMouseDown:()=>{d!==r&&L(d+1)},onMouseEnter:e=>{const i=e.currentTarget;i.style.backgroundColor="var(--color-background-hover)"},onMouseLeave:e=>{const i=e.currentTarget;i.style.backgroundColor="var(--color-background)"},children:t.jsx("svg",{width:"7",height:"10",viewBox:"0 0 7 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.866259 0.580827C0.63192 0.815237 0.500276 1.13312 0.500276 1.46458C0.500276 1.79603 0.63192 2.11392 0.866259 2.34833L3.51751 4.99958L0.866259 7.65083C0.631708 7.88521 0.499873 8.20317 0.499756 8.53476C0.499639 8.86635 0.631248 9.1844 0.865633 9.41895C1.10002 9.6535 1.41798 9.78534 1.74957 9.78546C2.08115 9.78557 2.39921 9.65396 2.63376 9.41958L6.17001 5.88333C6.40435 5.64892 6.53599 5.33103 6.53599 4.99958C6.53599 4.66812 6.40435 4.35024 6.17001 4.11583L2.63376 0.580827C2.39935 0.346488 2.08146 0.214844 1.75001 0.214844C1.41855 0.214844 1.10067 0.346488 0.866259 0.580827Z",fill:"#989898"})})}),t.jsxs(y,{type:"左右",style:{alignItems:"center",gap:"10px",marginLeft:"20px"},children:[t.jsx(T,{type:"正文内容",text:x.跳至}),t.jsx("input",{type:"text",inputMode:"numeric",value:j,onChange:e=>{const i=e.target.value;if(i===""){E("");return}const g=Number(i);Number.isNaN(g)||E(Math.max(1,Math.min(g,r)).toString())},style:{width:"40px",height:"40px",minWidth:"20px",minHeight:"20px",alignItems:"center",justifyContent:"center",textAlign:"center",border:"none",backgroundColor:"var(--color-background)",borderRadius:"6px"},onKeyDown:e=>e.key==="Enter"&&S(),onBlur:S}),t.jsx(T,{type:"正文内容",text:x.页})]})]})]})},se=l=>(B(),t.jsx(te,{onRetry:l.onRetry,onError:(n,a)=>{},children:t.jsx(ae,{...l})})),ie=({isOpen:l,onClose:n,position:a,onSelect:b,menuItems:c})=>{if(!l)return null;const p=W(),C=c||["download","share","report","rename","edit"],s=u=>{u.stopPropagation()};return t.jsx(y,{type:"上下",w:120,style:{position:"fixed",left:`${a.x}px`,top:`${a.y}px`,backgroundColor:"white",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",borderRadius:"4px",padding:"4px 0",zIndex:1e3,transform:"translateZ(0)"},onClick:s,"data-testid":"dropdown-menu",children:C.map(u=>t.jsx(y,{type:"左右",w:"full",style:{padding:"8px 16px",cursor:"pointer",transition:"all 0.2s ease",backgroundColor:"white"},onMouseEnter:v=>{const x=v.currentTarget;x.style.backgroundColor="var(--color-highlight-2)"},onMouseLeave:v=>{const x=v.currentTarget;x.style.backgroundColor="white"},onClick:v=>{v.stopPropagation(),b(u),n()},children:t.jsx("div",{style:{fontFamily:"var(--font-family-sc)",fontSize:"14px",lineHeight:"20px",color:"black"},children:p[u]})},u))})},le=()=>{B();const l=f.useRef(new Map),[n,a]=f.useState({isOpen:!1,position:{x:0,y:0}});return f.useEffect(()=>{const c=p=>{if(p.stopPropagation(),n.isOpen&&n.itemId){const C=p.target,s=l.current.get(n.itemId);(!s||!s.contains(C))&&!C.closest('[data-testid="dropdown-menu"]')&&a(u=>({...u,isOpen:!1}))}};return document.addEventListener("click",c),()=>{document.removeEventListener("click",c)}},[n.isOpen,n.itemId]),{buttonRefs:l,dropdownState:n,setDropdownState:a,handleDropdownSelect:async(c,p,C)=>{const s=W();if(c===void 0)return;const u=o.getCurrentDevice().deviceType.type==="dongle";if(o.currentHomePageIndex===D.屏幕设置页||u&&o.currentHomePageIndex===0)w.state_screenSettingsPage.currentItemId=c;else switch(o.currentHomePageIndex){case D.灯光设置页:w.state_lightCustomizationPage.currentItemId=c;break;case D.本地配置:w.state_localConfigPage.currentItemId=c;break}if(C)await C(p);else switch(p){case"download":if(!o.currentUser){_.next({type:"error",message:s.请登陆后再尝试||"请登陆后再尝试"});return}const x=o.state_communitySharingPage.sharedDataList;if(x.length===0){_.next({type:"error",message:s.下载失败||"下载失败"});return}const h=x.find(r=>r.image.bit_image.md5===c),d=x.findIndex(r=>r.image.bit_image.md5===c);if(h===void 0){_.next({type:"error",message:s.没有找到图片||"没有找到图片"});return}let k="screen",j,E;const I=h.image.bit_image.screen_type;if((I.includes(M.PNG)||I.includes(M.GIF))&&(k="screen",j=R.DBPATH.SCREEN,E=R.DBPATH.SCREEN_IMAGE_BUFFER),(I.includes(M.keyboard_light_gif)||I.includes(M.keyboard_light_svg)||I.includes(M.keyboard_light_png))&&(k="light",j=R.DBPATH.LIGHT,E=R.DBPATH.LIGHT_IMAGE_BUFFER),I.includes(M.config)&&(k="config",j=R.DBPATH.CONFIG_NEW,E=R.DBPATH.CONFIG_NEW_BUFFER),I.includes(M.macro)&&(k="macro",j=R.DBPATH.MACRO,E=R.DBPATH.MACRO_BUFFER),!j||!E){_.next({type:"error",message:s.下载失败||"下载失败"});return}const V=await $.getAllItems(j,E);let A;if(I.includes(M.config)&&(A=X(h.data),JSON.parse(A.toString())),V.some(r=>r.id===h?.image.bit_image.md5||Y(h?.data,r.data))){_.next({type:"info",message:k==="light"?s.灯效已存在||"灯效已存在":k==="screen"?s.图片已存在||"图片已存在":s.内容已存在||"内容已存在"});return}else{const r=await ee.addBitImageDownloadTime(h?.image.bit_image.id);if(r.errCode!==0){_.next({type:"error",message:s.下载失败+": "+(r.errMsg||"未知错误")});return}const P=[...x];P[d]&&(P[d].image.bit_image.download_times+=1),o.state_communitySharingPage.sharedDataList=P;const S={id:h.image.bit_image.md5,title:h.image.bit_image.title,describe:h.image.bit_image.description,screen_type:h.image.bit_image.screen_type,create_at:h.image.bit_image.create_at.secs_since_epoch,company:h.image.bit_image.company,data:h.data,width:h.image.bit_image.width,height:h.image.bit_image.height};await $.saveItemToDb(S,j,E)?(o.allPicsInDb.push(S),F.success(s["下载成功，请返回我的作品查看"]||"下载成功，请返回我的作品查看",w.toastOptions)):F.error(s.下载失败||"下载失败",w.toastOptions)}break;case"share":o.currentUser?o.showShareModal=!0:_.next({type:"info",message:s.请登陆后再尝试||"请登陆后再尝试"});break;case"rename":{const r=o.getCurrentDevice().deviceType.type==="dongle";o.currentHomePageIndex===D.屏幕设置页||r&&o.currentHomePageIndex===0?w.state_screenSettingsPage.isRenamingTitle=!0:o.currentHomePageIndex===D.灯光设置页?w.state_lightCustomizationPage.isRenaming=!0:o.currentHomePageIndex===D.本地配置&&(w.state_localConfigPage.isRenaming=!0);break}case"edit":{const r=o.getCurrentDevice().deviceType.type==="dongle";o.currentHomePageIndex===D.屏幕设置页||r&&o.currentHomePageIndex===0?await o.handleEditScreenWork(c):o.currentHomePageIndex===D.灯光设置页&&await o.handleEditLightWork(c);break}case"report":if(o.currentUser===null){F.info(s.请先登录||"请先登录",w.toastOptions);return}const H=o.state_communitySharingPage.sharedDataList.find(r=>r.image.bit_image.md5===c)?.image.bit_image.id;H?(o.state_communitySharingPage.reportItemId=H,o.state_communitySharingPage.isReportModalOpen=!0,a(r=>({...r,isOpen:!1}))):F.error(s.没有找到图片||"没有找到图片",w.toastOptions);break}if(o.getCurrentDevice().deviceType.type=="mouse")switch(w.state_localConfigPage.currentItemId=c,p){case"rename":w.state_localConfigPage.isRenaming=!0;break;case"share":o.currentUser?o.showShareModal=!0:_.next({type:"info",message:s.请登陆后再尝试||"请登陆后再尝试"});break}}}};export{se as D,ie as a,le as u};
