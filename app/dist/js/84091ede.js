import{u as B,G as z,ao as J,j as N,V as Q,c as e,ap as j,键 as O,a9 as c,aq as V}from"./index.b078bf5f.js";import{u as D}from"./3ce44458.js";import{_ as U}from"./0027593c.js";import{_ as W,a as X}from"./fd426ddc.js";const C=()=>{B();const G=z();return J({ref:G,onInit:K=>{e.keyboardState=e.createKeyboardState();const T=j(U).Keyboard_89_SG8967_KeyMappings(K),v=j(W).Keyboard_89_SG8967_RT_On(K),g=j(X).Keyboard_89_SG8967_RT_Off(K);T.root.appendChild(g.root),g.root.appendChild(v.root);const A=e.getCurrentDevice()?.deviceType.other?.knobKeyCodes??[];return D.addKeySelectionAndMappingEffects(T,void 0,void 0,void 0,A),D.addKeySelectionAndMappingEffects(g,void 0,void 0,void 0,A),D.addKeySelectionAndMappingEffects(v,void 0,void 0,void 0,A),g.root.querySelectorAll('[id^="Knob"]')?.forEach(a=>{a.remove()}),v.root.querySelectorAll('[id^="Knob"]')?.forEach(a=>{a.remove()}),{uiForRtOff:g,uiForRtOn:v,uiForKeyMappings:T}},onRefresh:({uiForRtOff:K,uiForRtOn:T,uiForKeyMappings:v})=>{const g=e.getCurrentDevice(),A=e.keyboardState.keys,f=T.status,p=K.status,a=v.status;D.updateKeyboard(v,t=>{const _=A[t];if(!_)return;const q=_.isHover,y=_.isSelected,x=e.getIs改键(t),u=e.getIs禁用(t),o=e.getIs高级键改键(t),s=new Set(e.getCurrentDevice()?.deviceType.other?.knobKeyCodes??[]);if(e.current键盘设置页SubpageIndex===O.磁轴设置&&!o||e.current键盘设置页SubpageIndex===O.高级设置&&s.has(t)){v.status.default.id[t]&&Object.values(a).forEach(S=>{S.id[t]&&(S.id[t].style.display="none")});return}const r=e.getCurrentDevice().磁轴.所有按键.find(l=>l.按键===t);r&&r.RT&&Object.values(a).forEach(S=>{S.id[t]&&(S.id[t].style.display="none")});const h=l=>{if(!l)return;!e.shouldSwitchBeDisplayed&&l.querySelectorAll("path")[0]&&l.querySelectorAll("text")[1]&&(l.querySelectorAll("path")[0].style.display="none",l.querySelectorAll("text")[1].style.display="none");const P=e.getCurrentDevice()?.磁轴.所有按键.find(R=>R.按键===t);if(!P)return;const M=P?.轴体||"高特",H=l.querySelectorAll("path")[0];H&&H.setAttribute("fill",V(e.轴体颜色字典[M]||16771625));const L=e.supportedSwitchTypes.findIndex(R=>R===M),I=l.querySelectorAll("text")[1];I&&(c.setText(I,String(L+1)),L+1>=10?I.setAttribute("dx","-0.5ch"):I.setAttribute("dx","0"))};Object.values(a).forEach(l=>{l.id[t]&&(l.id[t].style.display="none")});const m=y&&q,w=y&&!q,b=!y&&q,d=!y&&!q;let n;const E=e.系统按键;if(e.isFnLayer&&E.has(t)){c.show(a.systemKey.id[t]),h(a.systemKey.id[t]);return}m?n=a.current_hover:w?n=a.current:b?x||o?n=a.changed:u?n=e.isFnLayer?a.hover:a.forbidden:n=a.hover:d&&(x||o?n=a.changed:u?e.isFnLayer?n=a.default:n=a.forbidden:n=a.default),n&&(c.show(n.id[t]),h(n.id[t]))}),D.updateKeyboard(K,t=>{const _=A[t];if(!_)return;if(e.current键盘设置页SubpageIndex!==O.磁轴设置){K.status.default.id[t]&&Object.values(p).forEach(r=>{r.id[t]&&(r.id[t].style.display="none")});return}const y=e.getCurrentDevice().磁轴.所有按键.find(i=>i.按键===t);e.getIs改键(t),e.getIs禁用(t);const x=e.getIs高级键改键(t);if(e.getIsSwapKey(t),y){const{RT:i}=y;if(i||x){Object.values(p).forEach(r=>{r.id[t]&&(r.id[t].style.display="none")});return}}let u=_.isHover,o=_.isSelected;o&&(e.当前选中按键_单键=t,e.当前选中按键_多键.includes(t)||e.当前选中按键_多键.push(t));const s=i=>{if(!i)return;!e.shouldSwitchBeDisplayed&&i.querySelectorAll("path")[0]&&i.querySelectorAll("text")[1]&&(i.querySelectorAll("path")[0].style.display="none",i.querySelectorAll("text")[1].style.display="none");const h=g.磁轴.所有按键.find(n=>n.按键===t);if(!h)return;const m=h?.轴体||"高特",w=i.querySelectorAll("path")[0];w&&w.setAttribute("fill",V(e.轴体颜色字典[m]||16771625));const b=e.supportedSwitchTypes.findIndex(n=>n===m),d=i.querySelectorAll("text")[1];if(d&&(c.setText(d,String(b+1)),b+1>=10?d.setAttribute("dx","-0.5ch"):d.setAttribute("dx","0")),h&&h.行程设置.type==="行程设置"){let n=h.行程设置.行程按下,E=h.行程设置.行程抬起,l=i.querySelectorAll("text")[2],S=i.querySelectorAll("text")[3];l&&c.setText(l,n?.toFixed(e.travelPrecision)??"0.01"),S&&c.setText(S,E?.toFixed(e.travelPrecision)??"0.01")}};Object.values(p).forEach(i=>{i.id[t]&&(i.id[t].style.display="none")}),!o&&!u?(c.show(p.default.id[t]),s(p.default.id[t])):!o&&u?(c.show(p.hover.id[t]),s(p.hover.id[t])):o&&!u?(c.show(p.current.id[t]),s(p.current.id[t])):o&&u&&(c.show(p.current_hover.id[t]),s(p.current_hover.id[t]))}),D.updateKeyboard(T,t=>{const _=A[t];if(!_)return;if(e.current键盘设置页SubpageIndex!==O.磁轴设置){Object.values(f).forEach(s=>{s.id[t]&&(s.id[t].style.display="none")});return}const y=e.getCurrentDevice().磁轴.所有按键.find(s=>s.按键===t);if(y){const{RT:s}=y;e.getIs改键(t),e.getIs禁用(t);const i=e.getIs高级键改键(t);if(e.getIsSwapKey(t),!s||i){Object.values(f).forEach(r=>{r.id[t]&&(r.id[t].style.display="none")});return}}let x=_.isHover,u=_.isSelected;u&&(e.当前选中按键_单键=t,e.当前选中按键_多键.includes(t)||e.当前选中按键_多键.push(t));const o=s=>{if(!s)return;!e.shouldSwitchBeDisplayed&&s.querySelectorAll("path")[0]&&s.querySelectorAll("text")[1]&&(s.querySelectorAll("path")[0].style.display="none",s.querySelectorAll("text")[1].style.display="none");const r=g.磁轴.所有按键.find(d=>d.按键===t);if(!r)return;const h=r?.轴体||"高特",m=s.querySelectorAll("path")[0];m&&m.setAttribute("fill",V(e.轴体颜色字典[h]||16771625));const w=e.supportedSwitchTypes.findIndex(d=>d===h),b=s.querySelectorAll("text")[1];if(b&&(c.setText(b,String(w+1)),w+1>=10?b.setAttribute("dx","-0.5ch"):b.setAttribute("dx","0")),r&&r.行程设置.type==="行程设置"){let d=r.行程设置.行程按下,n=r.rt抬起,E=r.rt按下,l=s.querySelectorAll("text")[2],S=s.querySelectorAll("text")[3],F=s.querySelectorAll("text")[4];l&&c.setText(l,d.toFixed(e.travelPrecision)),S&&c.setText(S,E?.toFixed(e.travelPrecision)??"0.01"),F&&c.setText(F,n?.toFixed(e.travelPrecision)??"0.01")}};Object.values(f).forEach(s=>{s.id[t]&&(s.id[t].style.display="none")}),!u&&!x?(c.show(f.default.id[t]),o(f.default.id[t])):!u&&x?(c.show(f.hover.id[t]),o(f.hover.id[t])):u&&!x?(c.show(f.current.id[t]),o(f.current.id[t])):u&&x&&(c.show(f.current_hover.id[t]),o(f.current_hover.id[t]))})}}),N.jsx(Q,{divRef:G})};export{C as Keyboard_89_SG8967_v3_KeyMappings_RT};
